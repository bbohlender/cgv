(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[698],{5999:function(e,t,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/shape",function(){return r(8178)}])},8178:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return ge}});var n=r(5893),i=r(6260),a=r(6173),o=r(766);new a.Box3,new a.Vector3,new a.Vector3;const s=new a.Matrix4,c=new a.Vector3,u=new a.Euler;function l(e,t,r=s){return c.crossVectors(e,t),r.makeBasis(e,t,c)}function m(e,t,r,n=s){return n.makeTranslation(e,t,r)}function h(e,t,r,n=s){return n.makeRotationFromEuler(u.set(e,t,r))}function p(e,t,r,n=s){return n.makeScale(e,t,r)}function x(e){return t=>{switch(t){case y.Point:return new a.PointsMaterial({color:e});case y.Line:return new a.LineBasicMaterial({color:e});case y.Mesh:return new a.MeshPhongMaterial({color:e})}}}const f=new a.Matrix4,d=new a.Vector3;function w(e,t){return e.matrixAutoUpdate=!1,e.matrix=t,e}var y;!function(e){e[e.Point=0]="Point",e[e.Line=1]="Line",e[e.Mesh=2]="Mesh"}(y||(y={}));class g{constructor(){this.geometryCache=null,this.objectCache=null}getGeometry(){return null===this.geometryCache&&(this.geometryCache=this.computeGeometry()),this.geometryCache}getObject(){return null===this.objectCache&&(this.objectCache=this.computeObject3D()),this.objectCache}dispose(){var e;null===(e=this.geometryCache)||void 0===e||e.dispose()}multiplyMatrix(e){return this.changeMatrix(this.matrix.clone().multiply(e))}premultiplyMatrix(e){return this.changeMatrix(this.matrix.clone().premultiply(e))}}class v extends g{constructor(e,t){super(),this.matrix=e,this.materialGenerator=t}changeMaterialGenerator(e){return new v(this.matrix,e)}changeMatrix(e){return new v(e,this.materialGenerator)}multiplyMatrix(e){return new v(this.matrix.clone().multiply(e),this.materialGenerator)}getGeometrySize(e){e.set(0,0,0)}extrude(e){return new j(this.matrix,e,this.materialGenerator)}components(e){return"points"===e?[this.clone()]:[]}computeObject3D(){return w(new a.Points((new a.BufferGeometry).setFromPoints([new a.Vector3]),this.materialGenerator(y.Point)),this.matrix)}clone(){return new v(this.matrix,this.materialGenerator)}computeGeometry(){}}const b=new a.Vector3(0,1,0);class j extends g{constructor(e,t,r){super(),this.matrix=e,this.length=t,this.materialGenerator=r}changeMaterialGenerator(e){return new j(this.matrix,this.length,e)}changeMatrix(e){return new j(e,this.length,this.materialGenerator)}static fromPoints(e,t,r,n){e.multiply(m(t.x,0,t.y)),G.copy(r).sub(t);const i=G.length();return e.multiply(l(d.set(G.x,0,G.y).normalize(),b)),new j(e,i,n)}getGeometrySize(e){e.set(0,this.length,0)}clone(){return new j(this.matrix,this.length,this.materialGenerator)}extrude(e){return S.fromLengthAndHeight(this.matrix,this.length,e,!0,this.materialGenerator)}components(e){switch(e){case"faces":return[];case"lines":return[this.clone()];case"points":{const e=new v(this.matrix.clone().multiply(f.makeTranslation(this.length,0,0)),this.materialGenerator);return[new v(this.matrix,this.materialGenerator),e]}}}computeObject3D(){return w(new a.Line((new a.BufferGeometry).setFromPoints([new a.Vector3,new a.Vector3(this.length,0,0)]),this.materialGenerator(y.Line)),this.matrix)}computeGeometry(){}}const M=new a.Box2,G=new a.Vector2,V=new a.Matrix4;class S extends g{constructor(e,t,r){super(),this.matrix=e,this.shape=t,this.materialGenerator=r}changeMaterialGenerator(e){return new S(this.matrix,this.shape,e)}changeMatrix(e){return new S(e,this.shape,this.materialGenerator)}static fromLengthAndHeight(e,t,r,n,i){n&&e.multiply(f.makeRotationX(-Math.PI/2));const o=[new a.Vector2(t,0),new a.Vector2(t,r),new a.Vector2(0,r),new a.Vector2(0,0)],s=new a.Shape(o);return new S(e,s,i)}getGeometrySize(e){M.setFromPoints(this.shape.getPoints()).getSize(G),e.set(G.x,0,G.y)}computeGeometry(){const e=new a.ShapeBufferGeometry(this.shape);let t;for(let r=0;r<e.index.count;r+=3)t=e.index.getX(r),e.index.setX(r,e.index.getX(r+2)),e.index.setX(r+2,t);return e.rotateX(Math.PI/2),e}invert(){const e=this.matrix.clone();e.multiply(h(Math.PI,0,0));const t=this.shape.getPoints(5),r=this.shape.holes,n=new a.Shape(t.map((({x:e,y:t})=>new a.Vector2(e,-t))));return n.holes=r.map((e=>new a.Path(e.getPoints().map((({x:e,y:t})=>new a.Vector2(e,-t)))))),new S(e,n,this.materialGenerator)}extrude(e){V.copy(this.matrix).invert();const t=this.multiplyMatrix(V.multiply(m(0,e,0))),r=this.shape.extractPoints(5).shape;return new O(this.matrix,[...r.map(((t,n)=>{const i=r[(n+1)%r.length];d.set(i.x-t.x,0,i.y-t.y);const o=d.length(),s=m(t.x,0,t.y,new a.Matrix4);s.multiply(l(d.normalize(),b));const c=S.fromLengthAndHeight(s,o,e,!0,this.materialGenerator);return e<0?c.invert():c})),t])}components(e){switch(e){case"points":return this.shape.extractPoints(5).shape.map((e=>new v(this.matrix.clone().multiply(m(e.x,0,e.y)),this.materialGenerator)));case"lines":{const e=this.shape.extractPoints(5).shape;return e.map(((t,r)=>j.fromPoints(this.matrix.clone(),t,e[(r+1)%e.length],this.materialGenerator)))}case"faces":return[this]}}computeObject3D(){return w(new a.Mesh(this.getGeometry(),this.materialGenerator(y.Mesh)),this.matrix)}}const P=new a.Box3;class O extends g{constructor(e,t){super(),this.matrix=e,this.primitives=t}changeMaterialGenerator(e){return new O(this.matrix,this.primitives.map((t=>t.changeMaterialGenerator(e))))}get materialGenerator(){throw new Error("can't retrive material from combined primitive")}changeMatrix(e){return new O(e,this.primitives)}extrude(e){return new O(this.matrix,this.primitives.map((t=>t.extrude(e))))}components(e){return this.primitives.map((t=>t.components(e))).reduce(((e,t)=>e.concat(t))).map((e=>e.premultiplyMatrix(this.matrix)))}computeObject3D(){const e=w(new a.Object3D,this.matrix);return this.primitives.forEach((t=>e.add(t.getObject()))),e}getGeometrySize(e){P.makeEmpty(),this.primitives.forEach((e=>{e.getGeometrySize(d),d.applyMatrix4(e.matrix),P.expandByPoint(d)})),P.getSize(e)}computeGeometry(){const e=this.primitives.map((e=>{var t;return null===(t=e.getGeometry())||void 0===t?void 0:t.applyMatrix4(e.matrix)})).filter(T),t=(0,o.qf)(e);return e.forEach((e=>e.dispose())),t}}function T(e){return null!=e}r(1135);const z=new a.Vector3,A=new a.Vector3;new a.Matrix4;var C;!function(e){e[e.X=0]="X",e[e.Y=1]="Y",e[e.Z=2]="Z"}(C||(C={}));const E={[C.X]:"x",[C.Y]:"y",[C.Z]:"z"};function N(e,t){return e[E[t]]}function Q(e,t,r){e[E[t]]=r}const X=new a.Vector3;function L(e,t,r){e.getGeometrySize(X);let n=0;const i=[];for(A.set(0,0,0);N(X,t)>0;){const a=e.matrix.clone();a.multiply(m(A.x,A.y,A.z));const o=r(a,n,X.x,X.y,X.z);o.getGeometrySize(z),i.push(o),n++;const s=N(z,t);Q(X,t,N(X,t)-s),Q(A,t,N(A,t)+s)}return i}new a.Vector3;var k;!function(e){e[e.Float=0]="Float",e[e.Enum=1]="Enum",e[e.Int=2]="Int"}(k||(k={}));var I=r(7340),_=r(4917),B=r(8882),F=r.n(B),H=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function o(e){try{c(n.next(e))}catch(t){a(t)}}function s(e){try{c(n.throw(e))}catch(t){a(t)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(o,s)}c((n=n.apply(e,t||[])).next())}))};function Z(){return H(this,void 0,void 0,(function*(){const e=yield function(){return H(this,void 0,void 0,(function*(){const e=yield fetch("/cgv/22545.mvt"),t=yield e.arrayBuffer(),r=new _.VectorTile(new(F())(t));return Object.entries(r.layers).reduce(((e,[t,r])=>Object.assign(Object.assign({},e),{[t]:new Array(r.length).fill(null).map(((e,t)=>{const n=r.feature(t);return{properties:n.properties,geometry:n.loadGeometry()}}))})),{})}))}();return[function(e){return e.road.filter((e=>"street"===e.properties.class)).reduce(((e,t)=>e.concat(t.geometry.map((e=>[new O(new a.Matrix4,e.slice(0,-1).map(((t,r)=>{const n=e[(r+1)%e.length];return j.fromPoints(new a.Matrix4,new a.Vector2(t.x,t.y),new a.Vector2(n.x,n.y),Y)}))),D])))),[])}(e),function(e){return e.building.reduce(((e,t)=>e.concat(t.geometry.map((e=>[new S(new a.Matrix4,new a.Shape(e.map((({x:e,y:t})=>new a.Vector2(e,t)))),Y),U])))),[])}(e)]}))}const D={layer:(0,I.of)("road")},U={layer:(0,I.of)("building")},Y=x(new a.Color(16711680));var R=r(8816),$=r(598),q=r(1026),J=r(7032);const K=x(new a.Color(16711680));const W=new a.Vector3;const ee=new a.Vector3;function te(e){return Math.PI*e/180}function re(e,...t){const r=t.reduce(((t,r)=>[...t,...r.primitive.components(e).map((e=>({attributes:Object.assign({},r.attributes),primitive:e})))]),[]);return(0,I.of)(r)}function ne(e,t,r,n){const i=L(t.primitive,e,((i,a,o,s,c)=>{if(null==n||a<n){const n=e===C.X?Math.min(r,o):o,a=e===C.Z?Math.min(r,c):c;return S.fromLengthAndHeight(i,n,a,!1,t.primitive.materialGenerator)}return S.fromLengthAndHeight(i,o,c,!1,t.primitive.materialGenerator)})).map((e=>({attributes:Object.assign({},t.attributes),primitive:e})));return(0,I.of)(i)}function ie(e,t,...r){const n=L(t.primitive,e,((n,i,a,o,s)=>{const c=e===C.X&&null!=r[i]?Math.min(r[i],a):a,u=e===C.Z&&null!=r[i]?Math.min(r[i],s):s;return S.fromLengthAndHeight(n,c,u,!1,t.primitive.materialGenerator)})).map((e=>({attributes:Object.assign({},t.attributes),primitive:e})));return(0,I.of)(n)}const ae=Object.assign(Object.assign({},J.w),{translate:{execute:(0,i.QV)((function(e,t,r,n){return(0,I.of)([{attributes:Object.assign({},e.attributes),primitive:e.primitive.multiplyMatrix(m(t,r,n))}])})),includeThis:!0},scale:{execute:(0,i.QV)((function(e,t,r,n){return(0,I.of)([{attributes:Object.assign({},e.attributes),primitive:e.primitive.multiplyMatrix(p(t,r,n))}])})),includeThis:!0},rotate:{execute:(0,i.QV)((function(e,t,r,n){return(0,I.of)([{attributes:Object.assign({},e.attributes),primitive:e.primitive.multiplyMatrix(h(te(t),te(r),te(n)))}])})),includeThis:!0},extrude:{execute:(0,i.QV)((function(e,t){return(0,I.of)([{attributes:Object.assign({},e.attributes),primitive:e.primitive.extrude(t)}])})),includeThis:!0},splitX:{execute:(0,i.QV)(ne.bind(null,C.X)),includeThis:!0},splitZ:{execute:(0,i.QV)(ne.bind(null,C.Z)),includeThis:!0},multiSplitX:{execute:(0,i.QV)(ie.bind(null,C.X)),includeThis:!0},multiSplitZ:{execute:(0,i.QV)(ie.bind(null,C.Z)),includeThis:!0},toPoints:{execute:(0,i.QV)(re.bind(null,"points")),includeThis:!0},toLines:{execute:(0,i.QV)(re.bind(null,"lines")),includeThis:!0},toFaces:{execute:(0,i.QV)(re.bind(null,"faces")),includeThis:!0},color:{execute:(0,i.QV)((function(e,t){return(0,I.of)([{attributes:Object.assign({},e.attributes),primitive:e.primitive.changeMaterialGenerator(x(t))}])})),includeThis:!0},size:{execute:(0,i.QV)((function(e,t){return e.primitive.getGeometrySize(ee),(0,I.of)([ee[t]])})),includeThis:!0},mapbox:{execute:(0,i.QV)((function(){return(0,R.D)(Z()).pipe((0,$.U)((([e,t])=>[...e,...t].map((([e,t],r)=>({attributes:{},primitive:e}))))),(0,q.d)({bufferSize:1,refCount:!0}))})),includeThis:!1},point:{execute:(0,i.QV)((function(e,t,r){return(0,I.of)([{attributes:{},primitive:new v(m(e,t,r,new a.Matrix4),K)}])})),includeThis:!1},line:{execute:(0,i.QV)((function(...e){const[t,r]=e.map((e=>(W.setFromMatrixPosition(e.primitive.matrix),new a.Vector2(W.x,W.z))));return(0,I.of)([{attributes:{},primitive:j.fromPoints(new a.Matrix4,t,r,K)}])})),includeThis:!1},face:{execute:(0,i.QV)((function(...e){const t=e.map((e=>(W.setFromMatrixPosition(e.primitive.matrix),new a.Vector2(W.x,W.z))));return(0,I.of)([{attributes:{},primitive:new S(new a.Matrix4,new a.Shape(t),K)}])})),includeThis:!1}});var oe=r(6195);var se=r(9008),ce=r(7294),ue=r(406),le=r(6447);function me(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function he(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,i,a=[],o=!0,s=!1;try{for(r=r.call(e);!(o=(n=r.next()).done)&&(a.push(n.value),!t||a.length!==t);o=!0);}catch(c){s=!0,i=c}finally{try{o||null==r.return||r.return()}finally{if(s)throw i}}return a}}(e,t)||function(e,t){if(!e)return;if("string"===typeof e)return me(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(r);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return me(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function pe(e){var t=e.matrix,r=(0,ce.useState)([void 0,void 0]),i=he(r[0],2),o=i[0],s=i[1],c=r[1];return(0,ce.useEffect)((function(){if(null!=t){var e=t.pipe((0,oe.M1)((()=>new a.Object3D),void 0,((e,t,r)=>{const n=t.raw.primitive.getObject();e.children.splice(r,0,n),n.parent=e}),((e,t)=>{e.remove(e.children[t])}))).subscribe({next:function(e){return c([e,void 0])},error:function(e){console.error(e),c([void 0,e.message])}});return function(){return e.unsubscribe()}}}),[t]),(0,n.jsxs)("div",{style:{whiteSpace:"pre-line"},className:"flex-basis-0 d-flex flex-column flex-grow-1 bg-white h3 mb-0",children:[(0,n.jsx)("div",{className:"flex-basis-0 flex-grow-1 overflow-hidden position-relative",children:(0,n.jsxs)(le.Xz,{children:[(0,n.jsx)(ue.o,{}),(0,n.jsx)("gridHelper",{}),(0,n.jsx)("pointLight",{position:[3,3,3]}),(0,n.jsx)("ambientLight",{}),(0,n.jsx)("group",{scale:.01,children:null!=o&&(0,n.jsx)("primitive",{object:o})})]})}),(0,n.jsx)("div",{className:"overflow-auto mb-0 border-top flex-basis-0 h5 bg-light flex-grow-1",style:{whiteSpace:"pre-line",maxHeight:300,height:300},children:null==s?null==t?(0,n.jsx)("div",{className:"text-primary p-3",children:"waiting ..."}):(0,n.jsx)("div",{className:"text-success p-3",children:"ok"}):(0,n.jsx)("div",{className:"text-danger p-3",children:s})})]})}var xe=r(3579);function fe(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function de(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,i,a=[],o=!0,s=!1;try{for(r=r.call(e);!(o=(n=r.next()).done)&&(a.push(n.value),!t||a.length!==t);o=!0);}catch(c){s=!0,i=c}finally{try{o||null==r.return||r.return()}finally{if(s)throw i}}return a}}(e,t)||function(e,t){if(!e)return;if("string"===typeof e)return fe(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(r);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return fe(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var we=x(new a.Color(16711680)),ye=(0,I.of)({attributes:{},primitive:new v(new a.Matrix4,we)}).pipe((0,i.Tn)());function ge(){var e=(0,ce.useState)(""),t=e[0],r=e[1],a=de(function(e,t,r){return(0,ce.useMemo)((function(){try{var n=(0,i.Qc)(e);return[t.pipe((0,i.Ii)(n,r)),void 0]}catch(s){return[void 0,JSON.stringify(s.message)]}}),[e,t])}(t,ye,ae),2),o=a[0],s=a[1];return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(se.default,{children:[(0,n.jsx)("title",{children:"CGV | Editor"}),(0,n.jsx)("meta",{name:"description",content:""}),(0,n.jsx)("meta",{name:"viewport",content:"initial-scale=1.0, width=device-width"})]}),(0,n.jsxs)("div",{className:"d-flex responsive-flex-direction",style:{width:"100vw",height:"100vh"},children:[(0,n.jsx)(pe,{matrix:o}),(0,n.jsxs)("div",{className:"d-flex flex-column flex-basis-0 flex-grow-1",children:[(0,n.jsx)(xe.H,{text:t,setText:r}),(0,n.jsx)("div",{className:"overflow-auto p-3 flex-basis-0 h3 mb-0 bg-black flex-grow-1",style:{whiteSpace:"pre-line",maxHeight:300},children:null==s?null==o?(0,n.jsx)("span",{className:"text-primary",children:"loading ..."}):(0,n.jsx)("span",{className:"text-success",children:"ok"}):(0,n.jsx)("span",{className:"text-danger",children:s})})]})]})]})}}},function(e){e.O(0,[429,726,226,489,774,888,179],(function(){return t=5999,e(e.s=t);var t}));var t=e.O();_N_E=t}]);