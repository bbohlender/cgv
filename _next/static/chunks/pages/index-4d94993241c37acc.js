(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[405],{5301:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return n(9689)}])},9689:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return Ac}});var r=n(5893),o=n(6173);new o.Box3,new o.Vector3,new o.Vector3;const i=new o.Matrix4,a=new o.Vector3,l=new o.Euler;function s(e,t,n,r=i){return r.makeTranslation(e,t,n)}function c(e,t,n,r=i){return r.makeRotationFromEuler(l.set(e,t,n))}function u(e,t,n,r=i){return r.makeScale(e,t,n)}function p(e,t){let n=0;const r=Math.random()*t;for(let o=0;o<e.length;o++)if(n+=e[o],r<=n)return o;return e.length-1}function f(e,t){var n;const r=e.reduce(((e,t)=>e+t),0),o=[];for(let i=0;i<t;i++){const t=p(e,r);o[t]=(null!==(n=o[t])&&void 0!==n?n:0)+1}return o}function m(e,t,n){return n.a.fromBufferAttribute(t,3*e),n.b.fromBufferAttribute(t,3*e+1),n.c.fromBufferAttribute(t,3*e+2),n}function d(e,t){let n=Math.random(),r=Math.random();return n+r>1&&(n=1-n,r=1-r),t.set(0,0,0).addScaledVector(e.a,n).addScaledVector(e.b,r).addScaledVector(e.c,1-(n+r)),t}const h=new o.Triangle;function y(e,t){null!=e.index&&(e=e.toNonIndexed());const n=e.getAttribute("position"),r=f(new Array(n.count/3).fill(null).map(((e,t)=>m(t,n,h).getArea())),t),i=[];for(let a=0;a<r.length;a++){const e=r[a];if(null!=e){m(a,n,h);for(let t=0;t<e;t++)i.push(d(h,new o.Vector3))}}return i}var v=n(766);const g=.001;function b(e,t){return Math.abs(e-t)<g}const x=["if","switch","random","operation"],w=[["parallel"],["sequential"],["or"],["and"],["not"],["equal","unequal"],["smaller","smallerEqual","greater","greaterEqual"],["add","subtract"],["multiply","divide","modulo"],["invert"],["getVariable","setVariable","if","switch","random","symbol","operation","this","raw","return","null"]].reduce(((e,t,n)=>(t.forEach((t=>e[t]=n)),e)),{});function j(e,t){return!x.includes(e.type)&&(n=t,w[e.type]>w[n.type]);var n}var S=n(5201),O=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var o=0;for(r=Object.getOwnPropertySymbols(e);o<r.length;o++)t.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(e,r[o])&&(n[r[o]]=e[r[o]])}return n};function M(e,[t,...n]){let r=function(e,t){const n=K(e,t);return null==n?void 0:t[n].step}(t,e);if(null==r)return;const o=[e,r];for(const i of n){if(null==r.children)return;r=r.children[i],o.push(r)}return o}function P(e,t,n,r){if(0===n){const n=e[0];return void function(e,t,n){const r=K(e,t);null!=r&&(t[r].step=n)}(n,t[0],A(r,n))}const o=t[n],i=e[n];o.children[i]=A(r,...e.slice(0,n+1))}function E(e,t){if(t<0)throw new Error(`can't retrieve step at path index ${t}`);return e[t+1]}function N(e){var{path:t,children:n}=e,r=O(e,["path","children"]);return null==n?r:Object.assign(Object.assign({},r),{children:n.map((e=>N(e)))})}function A(e,...t){if(null==e)throw new Error("can't make undefined hierarchical");const n=e;if(Object.isFrozen(n))return(0,S.ZP)(n,(e=>A(e,...t)));if(null==n.path)n.path=t;else{n.path.length=t.length;for(let e=0;e<t.length;e++)n.path[e]=t[e]}if(null!=e.children)for(let r=0;r<e.children.length;r++)e.children[r]=A(e.children[r],...t,r);return n}function k(e){if(null==e)throw new Error("can't make undefined hierarchical");if(Object.isFrozen(e))return(0,S.ZP)(e,(e=>k(e)));for(const t of e)t.step=A(t.step,t.name);return e}function C(e){const t=new Map;for(const r of e)J(r.step,(e=>{if("symbol"!==e.type)return;let n=t.get(r.name);null==n&&(n=[],t.set(r.name,n)),n.push(e.identifier)}));const n={};for(const[r]of t)n[r]=Array.from(new Set(V(r,t)));return n}function V(e,t,n=new Set){n.add(e);const r=t.get(e);return null==r?[]:r.filter((e=>!n.has(e))).reduce(((e,r)=>e.concat(V(r,t,n))),r)}function z(e,t,n){const r=e.filter((e=>T(n,e.name)));if(null==t)return(0,S.vV)(r);const o=new Set(r.reduce(((e,r)=>{const o=t[r.name];return null==o?e:e.concat(o.filter((e=>!T(n,e))))}),[]));return(0,S.vV)(r.concat(e.filter((e=>o.has(e.name)))))}function T(e,t){return t.endsWith(`@${e}`)}function L(e,t){if(null==t)throw new Error("unable to globalize noun with undefined description name");return e.includes("@")?e:`${e}@${t}`}function D(e,t){return t=null!==t&&void 0!==t?t:Q(e),e.endsWith(`@${t}`)?e.slice(0,-t.length-1):e}function I(e,t,n,...r){return(0,S.ZP)(t,(t=>(B(t,n,e),A(t,...r))))}function B(e,t,n){if("symbol"!==e.type){if(null!=e.children)for(const r of e.children)B(r,t,n)}else e.identifier=n(e.identifier,t)}const q=I.bind(null,L);I.bind(null,D);function G(e,t,n){return(0,S.vV)(t.map((t=>{const r=e(t.name,n);return{name:r,step:I(e,t.step,n,r)}})))}const R=G.bind(null,L),Z=G.bind(null,D);function Q(e){const t=e.split("@");if(2!==t.length)throw new Error(`"${e}" expected to have exactly one "@"`);return t[1]}function $(e,t){const n="string"===typeof t?t:"symbol"===t.type?t.identifier:void 0;if(null!=n)return D(n,e)}function X(e,t){const n="string"===typeof t?t:"symbol"===t.type?t.identifier:void 0;if(null!=n)return L(n,e)}function F(e,t,n){var r;return[e,...null!==(r=n[e])&&void 0!==r?r:[]].map((e=>{const n=t.find((({name:t})=>t===e));if(null==n)throw new Error(`unknown noun "${e}"`);return n}))}var Y;function U(e,t){const n=Math.min(e.length,t.length);for(let r=0;r<n;r++)if(e[r]!=t[r])return Y.None;return e.length<t.length?Y.Successor:e.length===t.length?Y.Equal:Y.Predecessor}function W(e,t){if(null==e||null==t)return!1;if(e==t)return!0;if(e.length!=t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!=t[n])return!1;return!0}function H(e,t){if(t.type!=e)throw new Error(`expected step "${t}" to have type "${e}"`);return t}function _(e){return null!=e}function K(e,t){const n=t.findIndex((({name:t})=>t===e));return-1===n?void 0:n}function J(e,t){if(t(e),null!=e.children)for(const n of e.children)J(n,t)}!function(e){e[e.Predecessor=0]="Predecessor",e[e.Successor=1]="Successor",e[e.Equal=2]="Equal",e[e.None=3]="None"}(Y||(Y={}));n(1135);new o.Matrix4;function ee(e,t){return e[t]}function te(e,t,n){e[t]=n}function ne(e){pe.setFromRotationMatrix(e),re.set(0,1,0),re.applyQuaternion(pe);const t=Math.abs(re.x),n=Math.abs(re.y),r=Math.abs(re.z),o=Math.max(t,n,r);return t===o?re.x<0?"west":"east":n===o?re.y<0?"down":"up":re.z<0?"south":"north"}const re=new o.Vector3,oe=new o.Box3,ie=new o.Vector3,ae=new o.Box3;function le(e,t,n){let r=e[t];null==r&&(r=[],e[t]=r),r.push(n)}function se(e,t,n){let r=e.findIndex((e=>re.copy(e).sub(t).lengthSq()<n));return-1===r&&(r=e.length,e.push(t)),r}function ce(e,t,n,r,i){if(0===e.points.length)return[];const a=new Set;return e.connectionsList.reduce(((n,l,c)=>null==l?n:[...n,...l.map(((n,u)=>{const p=`${n}/${c}`,f=`${c}/${n}`;if(!a.has(p)&&!a.has(f))return a.add(p),function(e,t,n,r,i,a,l,c){const u=n[r],p=new o.Shape,f=new o.Matrix4,m=e.points[t],d=e.points[u];re.copy(d).sub(m).setY(0).normalize(),f.makeBasis(re,me,(new o.Vector3).crossVectors(re,me)),f.premultiply(s(m.x,m.y,m.z)),ue.copy(f).invert(),we(e,p,ue,Array.isArray(i)?i[t]:i,m,d,l,r,n,!0);const h=e.connectionsList[u],y=null===h||void 0===h?void 0:h.indexOf(t);return we(e,p,ue,Array.isArray(i)?i[u]:i,d,m,l,y,h,!1),new Te(f,p,c)}(e,c,l,u,t,0,r,i)})).filter(_)]),[])}const ue=new o.Matrix4,pe=new o.Quaternion,fe=new o.Vector3(1,0,0),me=new o.Vector3(0,1,0),de=new o.Vector3(0,0,1);const he=new o.Vector3,ye=new o.Vector3,ve=new o.Vector3,ge=new o.Vector3,be=new o.Vector3,xe=new o.Vector3;function we(e,t,n,r,o,i,a,l,s,c){if(ye.copy(o).applyMatrix4(n),null!=l&&null!=s&&s.length>1){ge.copy(i).sub(o).normalize(),be.copy(e.points[s[(l+s.length-1)%s.length]]).sub(o).normalize(),he.copy(ge).add(be).normalize().multiplyScalar(r),2===s.length?(xe.copy(be),ve.copy(he)):(xe.copy(e.points[s[(l+1)%s.length]]).sub(o).normalize(),ve.copy(ge).add(xe).normalize().multiplyScalar(r)),re.crossVectors(ge,a);re.dot(be)>=0||he.multiplyScalar(-1);re.dot(xe)>=0&&ve.multiplyScalar(-1)}else he.copy(i).sub(o).cross(a).normalize().multiplyScalar(r),ve.copy(he).multiplyScalar(-1);he.add(o).applyMatrix4(n),ve.add(o).applyMatrix4(n),c?t.moveTo(he.x,he.z):t.lineTo(he.x,he.z),t.lineTo(ye.x,ye.z),t.lineTo(ve.x,ve.z)}function je(e,t,n,r){he.copy(t).sub(e),ye.copy(n).sub(e);const o=ve.crossVectors(he,r).dot(ye)<0;he.projectOnPlane(r),ye.projectOnPlane(r);const i=he.angleTo(ye);return o?i:2*Math.PI-i}function Se(e){return t=>{switch(t){case Ne.Point:return new o.PointsMaterial({size:3e-8,toneMapped:!1,color:e});case Ne.Line:return new o.LineBasicMaterial({toneMapped:!1,color:e});case Ne.Mesh:return new o.MeshPhongMaterial({toneMapped:!1,color:e})}}}const Oe=new o.Matrix4,Me=new o.Vector3,Pe=new o.Quaternion;function Ee(e,t){return e.matrixAutoUpdate=!1,e.matrix=t,e.updateMatrixWorld(!0),e}var Ne;!function(e){e[e.Point=0]="Point",e[e.Line=1]="Line",e[e.Mesh=2]="Mesh"}(Ne||(Ne={}));class Ae{constructor(){this.geometryCache=null,this.objectCache=null,this.outlineCache=null}getGeometry(){return null===this.geometryCache&&(this.geometryCache=this.computeGeometry()),this.geometryCache}getOutline(){return null==this.outlineCache&&(this.outlineCache=this.computeOutline()),this.outlineCache}getObject(){return null==this.objectCache&&(this.objectCache=this.computeObject3D()),this.objectCache}dispose(){var e;null===(e=this.geometryCache)||void 0===e||e.dispose()}multiplyMatrix(e){return this.changeMatrix(this.matrix.clone().multiply(e))}premultiplyMatrix(e){return this.changeMatrix(this.matrix.clone().premultiply(e))}}class ke extends Ae{constructor(e,t){super(),this.matrix=e,this.materialGenerator=t}changeMaterialGenerator(e){return new ke(this.matrix,e)}changeMatrix(e){return new ke(e,this.materialGenerator)}multiplyMatrix(e){return new ke(this.matrix.clone().multiply(e),this.materialGenerator)}getBoundingBox(e){e.min.set(0,0,0),e.max.set(0,0,0)}getVertecies(){return[new o.Vector3]}extrude(e){return Ce.fromPoints(this.matrix.clone(),new o.Vector3(0,0,0),new o.Vector3(0,e,0),this.materialGenerator)}components(e){return"points"===e?[this.clone()]:[]}computeObject3D(){return Ee(new o.Points((new o.BufferGeometry).setFromPoints([new o.Vector3]),this.materialGenerator(Ne.Point)),this.matrix)}computeOutline(){const e=new o.Points((new o.BufferGeometry).setFromPoints([new o.Vector3]),new o.PointsMaterial({color:0,size:3e-8,transparent:!0,depthTest:!1}));return e.renderOrder=1e3,Ee(e,this.matrix)}clone(){return new ke(this.matrix,this.materialGenerator)}computeGeometry(){}expand(e,t,n){throw new Error("Method not implemented.")}getSize(e){return 0===e?1:0}samplePoints(e){return new Array(e).fill(null).map((()=>this.clone()))}}class Ce extends Ae{constructor(e,t,n){super(),this.matrix=e,this.length=t,this.materialGenerator=n}changeMaterialGenerator(e){return new Ce(this.matrix,this.length,e)}getStart(){return new o.Vector3(0,0,0).applyMatrix4(this.matrix)}getEnd(){return new o.Vector3(this.length,0,0).applyMatrix4(this.matrix)}changeMatrix(e){return new Ce(e,this.length,this.materialGenerator)}getVertecies(){return[new o.Vector3,new o.Vector3(this.length,0,0)]}static fromPoints(e,t,n,r){e.multiply(s(t.x,t.y,t.z)),Me.copy(n).sub(t);const o=Me.length();return Pe.setFromUnitVectors(fe,Me.divideScalar(o)),Oe.makeRotationFromQuaternion(Pe),e.multiply(Oe),new Ce(e,o,r)}getBoundingBox(e){e.min.set(0,0,0),e.max.set(this.length,0,0)}clone(){return new Ce(this.matrix,this.length,this.materialGenerator)}extrude(e){return Te.fromLengthAndHeight(this.matrix.clone(),this.length,e,me,this.materialGenerator)}components(e){switch(e){case"faces":return[];case"lines":return[this.clone()];case"points":{const e=new ke(this.matrix.clone().multiply(Oe.makeTranslation(this.length,0,0)),this.materialGenerator);return[new ke(this.matrix,this.materialGenerator),e]}}}computeObject3D(){return Ee(new o.Line((new o.BufferGeometry).setFromPoints([new o.Vector3,new o.Vector3(this.length,0,0)]),this.materialGenerator(Ne.Line)),this.matrix)}computeOutline(){const e=new o.Line((new o.BufferGeometry).setFromPoints([new o.Vector3,new o.Vector3(this.length,0,0)]),new o.LineBasicMaterial({color:0,transparent:!0,depthTest:!1}));return e.renderOrder=1e3,Ee(e,this.matrix)}computeGeometry(){}getSize(e){return 1===e?this.length:0}samplePoints(e){return new Array(e).fill(null).map((()=>new ke(this.matrix.clone().multiply(Oe.makeTranslation(Math.random()*this.length,0,0)),this.materialGenerator)))}}const Ve=new o.Box2,ze=(new o.Vector2,new o.Matrix4);class Te extends Ae{constructor(e,t,n){super(),this.matrix=e,this.shape=t,this.materialGenerator=n}changeMaterialGenerator(e){return new Te(this.matrix,this.shape,e)}changeMatrix(e){return new Te(e,this.shape,this.materialGenerator)}getVertecies(){return this.shape.getPoints().map((({x:e,y:t})=>new o.Vector3(e,0,t)))}static fromLengthAndHeight(e,t,n,r,i){const a=[new o.Vector2(t,0),new o.Vector2(t,n),new o.Vector2(0,n),new o.Vector2(0,0)],l=new o.Shape(a);return Pe.setFromUnitVectors(de,r),Oe.makeRotationFromQuaternion(Pe),e.multiply(Oe),new Te(e,l,i)}getBoundingBox(e){Ve.setFromPoints(this.shape.getPoints()),e.min.set(Ve.min.x,0,Ve.min.y),e.max.set(Ve.max.x,0,Ve.max.y)}computeGeometry(){const e=new o.ShapeBufferGeometry(this.shape);return function(e){let t;for(let n=0;n<e.index.count;n+=3)t=e.index.getX(n),e.index.setX(n,e.index.getX(n+2)),e.index.setX(n+2,t)}(e),Le(e),e}invert(){const e=this.matrix.clone();e.multiply(c(Math.PI,0,0));const t=this.shape.getPoints(5),n=this.shape.holes,r=new o.Shape(t.map((({x:e,y:t})=>new o.Vector2(e,-t))));return r.holes=n.map((e=>new o.Path(e.getPoints().map((({x:e,y:t})=>new o.Vector2(e,-t)))))),new Te(e,r,this.materialGenerator)}extrude(e){ze.copy(this.matrix).invert();const t=this.multiplyMatrix(ze.multiply(s(0,e,0))),n=this.shape.getPoints(5);return new Ze(this.matrix,[...n.map(((t,r)=>{const l=n[(r+1)%n.length];Me.set(l.x-t.x,0,l.y-t.y);const c=Me.length(),u=s(t.x,0,t.y,new o.Matrix4);u.multiply(function(e,t,n=i){return a.crossVectors(e,t),n.makeBasis(e,t,a)}(Me.normalize(),me));const p=Te.fromLengthAndHeight(u,c,e,me,this.materialGenerator);return e<0?p.invert():p})),t])}components(e){switch(e){case"points":return this.shape.extractPoints(5).shape.map((e=>new ke(this.matrix.clone().multiply(s(e.x,0,e.y)),this.materialGenerator)));case"lines":{const e=this.shape.extractPoints(5).shape;return e.map(((t,n)=>{const r=e[(n+1)%e.length];return Ce.fromPoints(this.matrix.clone(),new o.Vector3(t.x,0,t.y),new o.Vector3(r.x,0,r.y),this.materialGenerator)}))}case"faces":return[this]}}computeObject3D(){return Ee(new o.Mesh(this.getGeometry(),this.materialGenerator(Ne.Mesh)),this.matrix)}computeOutline(){const e=this.pathToOutline(this.shape.extractPoints(5).shape),t=this.shape.holes.map((e=>this.pathToOutline(e.getPoints(5)))),n=Ee(new o.Object3D,this.matrix);return n.renderOrder=1e3,n.add(e,...t),n}pathToOutline(e){if(0===e.length)return new o.Object3D;e.push(e[0]);const t=(new o.BufferGeometry).setFromPoints(e);return Le(t),new o.Line(t,new o.MeshBasicMaterial({color:0,transparent:!0}))}expand(e,t,n){throw new Error("not implemented")}getSize(e){if(2===e){const e=o.ShapeUtils.area(this.shape.getPoints(5));return this.shape.holes.reduce(((e,t)=>e-o.ShapeUtils.area(t.getPoints(5))),e)}return 0}samplePoints(e){const t=this.getGeometry();return null==t?[]:y(t,e).map((e=>new ke(this.matrix.clone().multiply(s(e.x,e.y,e.z)),this.materialGenerator)))}}function Le(e){let t;const n=e.getAttribute("position");for(let r=0;r<n.count;r++)t=n.getY(r),n.setY(r,n.getZ(r)),n.setZ(r,t)}const De=new o.Box3,Ie=new o.BoxBufferGeometry(1,1,1),Be=new o.EdgesGeometry(Ie);class qe extends Ae{constructor(e,t){super(),this.matrix=e,this.object=t,this.computeObject3D()}get materialGenerator(){throw new Error("Method not implemented.")}changeMaterialGenerator(e){return this}getVertecies(){throw new Error("Method not implemented.")}changeMatrix(e){return new qe(e,this.object)}extrude(e){throw new Error("Method not implemented.")}components(e){throw new Error("Method not implemented.")}computeObject3D(){const e=new o.Object3D;return e.add(this.object),Ee(e,this.matrix)}computeGeometry(){}getBoundingBox(e){Ge(this.object,e)}computeOutline(){this.getBoundingBox(De),De.getCenter(Me);const e=new o.LineSegments(Be,new o.LineBasicMaterial({transparent:!0,depthTest:!1,color:1}));return e.matrix.copy(this.matrix).multiply(s(Me.x,Me.y,Me.z)),De.getSize(Me),e.matrix.multiply(u(Me.x,Me.y,Me.z)),e.renderOrder=1e3,e}expand(e,t,n){throw new Error("Method not implemented.")}getSize(e){throw new Error("Method not implemented.")}samplePoints(e){throw new Error("Method not implemented.")}}function Ge(e,t){t=null!==t&&void 0!==t?t:new o.Box3,e instanceof o.Mesh?(e.geometry.computeBoundingBox(),t.copy(e.geometry.boundingBox)):t.makeEmpty();for(const n of e.children){if(0===n.children.length&&!(n instanceof o.Mesh))continue;const e=Ge(n).applyMatrix4(n.matrix);t.union(e)}return t}class Re extends Ae{constructor(e,t,n){super(),this.matrix=e,this.geometry=t,this.materialGenerator=n,t.computeBoundingBox()}changeMaterialGenerator(e){return new Re(this.matrix,this.geometry,e)}changeMatrix(e){return new Re(e,this.geometry,this.materialGenerator)}extrude(e){throw new Error("Method not implemented.")}components(e){throw new Error("Method not implemented.")}computeObject3D(){return Ee(new o.Mesh(this.getGeometry(),this.materialGenerator(Ne.Mesh)),this.matrix)}getVertecies(){throw new Error("Method not implemented.")}getBoundingBox(e){e.copy(this.geometry.boundingBox)}computeGeometry(){return this.geometry}computeOutline(){const e=new o.LineSegments(new o.EdgesGeometry(this.geometry),new o.LineBasicMaterial({transparent:!0,depthTest:!1,color:1}));return e.matrix.copy(this.matrix),e.renderOrder=1e3,e}expand(e,t,n){throw new Error("Method not implemented.")}getSize(e){throw new Error("Method not implemented.")}samplePoints(e){const t=this.getGeometry();return null==t?[]:y(t,e).map((e=>new ke(this.matrix.clone().multiply(s(e.x,e.y,e.z)),this.materialGenerator)))}}class Ze extends Ae{constructor(e,t){super(),this.matrix=e,this.primitives=t}changeMaterialGenerator(e){return new Ze(this.matrix,this.primitives.map((t=>t.changeMaterialGenerator(e))))}get materialGenerator(){return this.primitives[0].materialGenerator}changeMatrix(e){return new Ze(e,this.primitives)}getVertecies(){return this.primitives.reduce(((e,t)=>e.concat(t.getVertecies().map((e=>e.applyMatrix4(t.matrix))))),[])}extrude(e){return new Ze(this.matrix,this.primitives.map((t=>t.extrude(e))))}components(e){const t=this.primitives.map((t=>t.components(e))).reduce(((e,t)=>e.concat(t)));return t.map((e=>e.premultiplyMatrix(this.matrix)))}computeObject3D(){const e=Ee(new o.Object3D,this.matrix);return this.primitives.forEach((t=>e.add(t.getObject()))),e}getBoundingBox(e){e.makeEmpty(),this.primitives.forEach((t=>{t.getBoundingBox(De),De.applyMatrix4(t.matrix),e.union(De)}))}computeGeometry(){const e=this.primitives.map((e=>{var t;return null===(t=e.getGeometry())||void 0===t?void 0:t.applyMatrix4(e.matrix)})).filter(_),t=(0,v.qf)(e);return e.forEach((e=>e.dispose())),t}computeOutline(){const e=Ee(new o.Object3D,this.matrix);return this.primitives.forEach((t=>e.add(t.getOutline()))),e.renderOrder=1e3,e}getSize(e){return this.primitives.reduce(((t,n)=>n.getSize(e)+t),0)}samplePoints(e){const t=f(this.primitives.map((e=>e.getSize(2))),e),n=[];for(let r=0;r<t.length;r++){const e=t[r];null!=e&&n.push(...this.primitives[r].samplePoints(e))}return n}}var Qe=n(7587),$e=n(8882),Xe=n.n($e),Fe=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function a(e){try{s(r.next(e))}catch(t){i(t)}}function l(e){try{s(r.throw(e))}catch(t){i(t)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,l)}s((r=r.apply(e,t||[])).next())}))};function Ye(e,t){return(e+180)/360*Math.pow(2,t)}function Ue(e,t){return(1-Math.log(Math.tan(e*Math.PI/180)+1/Math.cos(e*Math.PI/180))/Math.PI)/2*Math.pow(2,t)}function We(e,t,n=256){const r=function(e,t){const n=Math.PI-2*Math.PI*e/Math.pow(2,t);return 180/Math.PI*Math.atan(.5*(Math.exp(n)-Math.exp(-n)))}(e,t);return 156543.03*Math.cos(r*Math.PI/180)/Math.pow(2,t)*n}function He(e,t){return Math.pow(2,t)/Math.pow(2,e)}function _e(e,t,n,r=256){return Fe(this,void 0,void 0,(function*(){const o=We(t,n,r),i=yield fetch(e),a=yield i.arrayBuffer(),l=new Qe.VectorTile(new(Xe())(a));return Object.entries(l.layers).reduce(((e,[t,n])=>{const r=o/n.extent;return Object.assign(Object.assign({},e),{[t]:new Array(n.length).fill(null).map(((e,t)=>{const o=n.feature(t),i=o.loadGeometry().map((e=>{const t=new Array(e.length);for(let n=0;n<e.length;n++){const{x:o,y:i}=e[n];t[n]={x:o*r,y:i*r}}return t})).filter((e=>e.length>0));return{properties:o.properties,geometry:i}}))})}),{})}))}function Ke(e,t,n,r){return e.road.filter((e=>"street"===e.properties.class)).map((e=>{const t=e.geometry.reduce(((e,t)=>{const o=function(e,t,n){const r=e.slice(0,-1).map(((r,o)=>{let i=e[(o+1)%e.length];switch(t){case"include":break;case"exclude":if(!rt(r.x,r.y,n)||!rt(i.x,i.y,n))return;break;case"clip":{const e=function(e,t,n,r,o,i,a,l){const s=(r-t)/(n-e),c=t-s*e,u=Je(s,c,e,t,o,i,a,l),p=Je(s,c,n,r,o,i,a,l);if(null==u||null==p)return;return{start:u,end:p}}(r.x,r.y,i.x,i.y,0,0,n,n);if(null==e)return;r=e.start,i=e.end}}return{type:"operation",identifier:"line",children:[r,i].map((({x:e,y:t})=>({type:"operation",identifier:"point2",children:[{type:"raw",value:e},{type:"raw",value:t}]})))}})).filter(_);if(0===r.length)return;return r}(t,n,r);return null==o?e:e.concat(o)}),[]);return 1===t.length?t[0]:{type:"parallel",children:t}}),[]).filter(_).map(((e,n)=>({name:`Road${n+1}${t}`,step:e})))}function Je(e,t,n,r,o,i,a,l){if(nt(n,r,o,i,a,l))return{x:n,y:r};const s=et(r,i,l),c=function(e,t,n){return(e-n)/t}(s,e,t);if(nt(c,s,o,i,a,l))return{x:c,y:s};const u=et(n,o,a),p=function(e,t,n){return e*t+n}(u,e,t);return nt(u,p,o,i,a,l)?{x:u,y:p}:void 0}function et(e,t,n){return Math.max(Math.min(e,n),t)}function tt(e,t,n,r){return e.building.map((e=>{const t=e.geometry.map((e=>function(e,t,n){const r=new Array(e.length-1);for(let o=0;o<e.length-1;o++){const{x:i,y:a}=e[o];if("exclude"===t&&!rt(i,a,n))return;r[o]={type:"operation",identifier:"point2",children:[{type:"raw",value:i},{type:"raw",value:a}]}}return{type:"operation",identifier:"face",children:r}}(e,n,r))).filter(_);if(0!==t.length)return 1===t.length?t[0]:{type:"parallel",children:t}})).filter(_).map(((e,n)=>({name:`Building${n+1}${t}`,step:e})))}function nt(e,t,n,r,o,i){return n<=e&&r<=t&&e<=o&&t<=i}function rt(e,t,n){return 0<e&&0<t&&e<n&&t<n}var ot=n(7340),it=n(8816),at=n(598),lt=n(7606),st=n(985);const ct=n.n(st)().compile({returnSymbol:/return/,nullSymbol:/null/,thisSymbol:/this/,ifSymbol:/if/,thenSymbol:/then/,elseSymbol:/else/,switchSymbol:/switch/,caseSymbol:/case/,arrow:/->/,longArrow:/-->/,openBracket:/\(/,closedBracket:/\)/,openCurlyBracket:/{/,closedCurlyBracket:/}/,point:/\./,comma:/,/,colon:/:/,smallerEqual:/<=/,greaterEqual:/>=/,smaller:/</,greater:/>/,doubleEqual:/==/,equal:/=/,unequal:/!=/,and:/&&/,or:/\|\|/,not:/!/,parallel:/\|/,int:/0[Xx][\da-fA-F]+|0[bB][01]+/,number:/-?\d+(?:\.\d+)?/,string:/"[^"]*"/,boolean:/true|false/,plus:/\+/,minus:/-/,multiply:/\*/,percent:/%/,divide:/\//,identifier:/[a-zA-Z_$@']+\w*/,ws:{match:/\s+/,lineBreaks:!0}});var ut={Lexer:ct,ParserRules:[{name:"GrammarDefinition",symbols:["ws","RuleDefinition","ws"],postprocess:([,e])=>[e]},{name:"GrammarDefinition$ebnf$1",symbols:["RuleDefinitions"]},{name:"GrammarDefinition$ebnf$1",symbols:["GrammarDefinition$ebnf$1","RuleDefinitions"],postprocess:e=>e[0].concat([e[1]])},{name:"GrammarDefinition",symbols:["ws","GrammarDefinition$ebnf$1","RuleDefinition","ws"],postprocess:([,e,t])=>{if(null!=e.find((({name:e})=>e===t.name)))throw new Error(`rule "${identifier}" is already defined`);return[...e,t]}},{name:"GrammarDefinition",symbols:["ws"],postprocess:()=>[]},{name:"RuleDefinitions",symbols:["RuleDefinition",ct.has("ws")?{type:"ws"}:ws],postprocess:([e])=>e},{name:"RuleDefinition",symbols:[ct.has("identifier")?{type:"identifier"}:identifier,"ws",ct.has("longArrow")?{type:"longArrow"}:longArrow,"ws","Steps"],postprocess:([{value:e},,,,t])=>({name:e,step:t})},{name:"Steps",symbols:["ParallelSteps"],postprocess:([e])=>e},{name:"ParallelSteps$ebnf$1",symbols:["ParallelStep"]},{name:"ParallelSteps$ebnf$1",symbols:["ParallelSteps$ebnf$1","ParallelStep"],postprocess:e=>e[0].concat([e[1]])},{name:"ParallelSteps",symbols:["ParallelSteps$ebnf$1","SequentialSteps"],postprocess:([e,t])=>({type:"parallel",children:[...e,t]})},{name:"ParallelSteps",symbols:["SequentialSteps"],postprocess:([e])=>e},{name:"ParallelStep",symbols:["SequentialSteps","ws",ct.has("parallel")?{type:"parallel"}:parallel,"ws"],postprocess:([e])=>e},{name:"SequentialSteps$ebnf$1",symbols:["SequentialStep"]},{name:"SequentialSteps$ebnf$1",symbols:["SequentialSteps$ebnf$1","SequentialStep"],postprocess:e=>e[0].concat([e[1]])},{name:"SequentialSteps",symbols:["SequentialSteps$ebnf$1","OrOperation"],postprocess:([e,t])=>({type:"sequential",children:[...e,t]})},{name:"SequentialSteps",symbols:["OrOperation"],postprocess:([e])=>e},{name:"SequentialStep",symbols:["OrOperation","ws",ct.has("arrow")?{type:"arrow"}:arrow,"ws"],postprocess:([e])=>e},{name:"OrOperation",symbols:["OrOperation","ws",ct.has("or")?{type:"or"}:or,"ws","AndOperation"],postprocess:([e,,,,t])=>({type:"or",children:[e,t]})},{name:"OrOperation",symbols:["AndOperation"],postprocess:([e])=>e},{name:"AndOperation",symbols:["AndOperation","ws",ct.has("and")?{type:"and"}:and,"ws","NegateOperation"],postprocess:([e,,,,t])=>({type:"and",children:[e,t]})},{name:"AndOperation",symbols:["NegateOperation"],postprocess:([e])=>e},{name:"NegateOperation",symbols:[ct.has("not")?{type:"not"}:not,"ws","NegateOperation"],postprocess:([,,e])=>({type:"not",children:[e]})},{name:"NegateOperation",symbols:["ComparisonOperation"],postprocess:([e])=>e},{name:"ComparisonOperation",symbols:["EquityOperation"],postprocess:([e])=>e},{name:"EquityOperation",symbols:["EqualOperation"],postprocess:([e])=>e},{name:"EquityOperation",symbols:["UnequalOperation"],postprocess:([e])=>e},{name:"EquityOperation",symbols:["RelationalOperation"],postprocess:([e])=>e},{name:"EqualOperation",symbols:["EquityOperation","ws",ct.has("doubleEqual")?{type:"doubleEqual"}:doubleEqual,"ws","RelationalOperation"],postprocess:([e,,,,t])=>({type:"equal",children:[e,t]})},{name:"UnequalOperation",symbols:["EquityOperation","ws",ct.has("unequal")?{type:"unequal"}:unequal,"ws","RelationalOperation"],postprocess:([e,,,,t])=>({type:"unequal",children:[e,t]})},{name:"RelationalOperation",symbols:["SmallerOperation"],postprocess:([e])=>e},{name:"RelationalOperation",symbols:["SmallerEqualOperation"],postprocess:([e])=>e},{name:"RelationalOperation",symbols:["GreaterOperation"],postprocess:([e])=>e},{name:"RelationalOperation",symbols:["GreaterEqualOperation"],postprocess:([e])=>e},{name:"RelationalOperation",symbols:["ArithmeticOperation"],postprocess:([e])=>e},{name:"SmallerOperation",symbols:["RelationalOperation","ws",ct.has("smaller")?{type:"smaller"}:smaller,"ws","ArithmeticOperation"],postprocess:([e,,,,t])=>({type:"smaller",children:[e,t]})},{name:"SmallerEqualOperation",symbols:["RelationalOperation","ws",ct.has("smallerEqual")?{type:"smallerEqual"}:smallerEqual,"ws","ArithmeticOperation"],postprocess:([e,,,,t])=>({type:"smallerEqual",children:[e,t]})},{name:"GreaterOperation",symbols:["RelationalOperation","ws",ct.has("greater")?{type:"greater"}:greater,"ws","ArithmeticOperation"],postprocess:([e,,,,t])=>({type:"greater",children:[e,t]})},{name:"GreaterEqualOperation",symbols:["RelationalOperation","ws",ct.has("greaterEqual")?{type:"greaterEqual"}:greaterEqual,"ws","ArithmeticOperation"],postprocess:([e,,,,t])=>({type:"greaterEqual",children:[e,t]})},{name:"ArithmeticOperation",symbols:["LineOperation"],postprocess:([e])=>e},{name:"LineOperation",symbols:["AddOperation"],postprocess:([e])=>e},{name:"LineOperation",symbols:["SubtractOperation"],postprocess:([e])=>e},{name:"LineOperation",symbols:["PointOperation"],postprocess:([e])=>e},{name:"AddOperation",symbols:["LineOperation","ws",ct.has("plus")?{type:"plus"}:plus,"ws","PointOperation"],postprocess:([e,,,,t])=>({type:"add",children:[e,t]})},{name:"SubtractOperation",symbols:["LineOperation","ws",ct.has("minus")?{type:"minus"}:minus,"ws","PointOperation"],postprocess:([e,,,,t])=>({type:"subtract",children:[e,t]})},{name:"PointOperation",symbols:["MultiplyOperation"],postprocess:([e])=>e},{name:"PointOperation",symbols:["DivideOperation"],postprocess:([e])=>e},{name:"PointOperation",symbols:["ModuloOperation"],postprocess:([e])=>e},{name:"PointOperation",symbols:["InvertOperation"],postprocess:([e])=>e},{name:"DivideOperation",symbols:["PointOperation","ws",ct.has("divide")?{type:"divide"}:divide,"ws","InvertOperation"],postprocess:([e,,,,t])=>({type:"divide",children:[e,t]})},{name:"MultiplyOperation",symbols:["PointOperation","ws",ct.has("multiply")?{type:"multiply"}:multiply,"ws","InvertOperation"],postprocess:([e,,,,t])=>({type:"multiply",children:[e,t]})},{name:"ModuloOperation",symbols:["PointOperation","ws",ct.has("percent")?{type:"percent"}:percent,"ws","InvertOperation"],postprocess:([e,,,,t])=>({type:"modulo",children:[e,t]})},{name:"InvertOperation",symbols:[ct.has("minus")?{type:"minus"}:minus,"ws","InvertOperation"],postprocess:([,,e])=>({type:"invert",children:[e]})},{name:"InvertOperation",symbols:["Step"],postprocess:([e])=>e},{name:"Step",symbols:["Operation"],postprocess:([e])=>e},{name:"Step",symbols:["Symbol"],postprocess:([e])=>e},{name:"Step",symbols:[ct.has("thisSymbol")?{type:"thisSymbol"}:thisSymbol],postprocess:()=>({type:"this"})},{name:"Step",symbols:["GetVariable"],postprocess:([e])=>e},{name:"Step",symbols:["SetVariable"],postprocess:([e])=>e},{name:"Step",symbols:["Constant"],postprocess:([e])=>({type:"raw",value:e})},{name:"Step",symbols:["Conditional"],postprocess:([e])=>e},{name:"Step",symbols:[ct.has("returnSymbol")?{type:"returnSymbol"}:returnSymbol],postprocess:()=>({type:"return"})},{name:"Step",symbols:[ct.has("nullSymbol")?{type:"nullSymbol"}:nullSymbol],postprocess:()=>({type:"null"})},{name:"Step",symbols:[ct.has("openBracket")?{type:"openBracket"}:openBracket,"ws","Steps","ws",ct.has("closedBracket")?{type:"closedBracket"}:closedBracket],postprocess:([,,e])=>e},{name:"Step",symbols:["Random"],postprocess:([e])=>e},{name:"Random$ebnf$1",symbols:[]},{name:"Random$ebnf$1",symbols:["Random$ebnf$1","RandomStep"],postprocess:e=>e[0].concat([e[1]])},{name:"Random",symbols:[ct.has("openCurlyBracket")?{type:"openCurlyBracket"}:openCurlyBracket,"Random$ebnf$1","ws",ct.has("closedCurlyBracket")?{type:"closedCurlyBracket"}:closedCurlyBracket],postprocess:([,e])=>({type:"random",probabilities:e.map((({probability:e})=>e)),children:e.map((({steps:e})=>e))})},{name:"RandomStep",symbols:["ws",ct.has("number")?{type:"number"}:number,ct.has("percent")?{type:"percent"}:percent,"ws",ct.has("colon")?{type:"colon"}:colon,"ws","Steps"],postprocess:([,{value:e},,,,,t])=>({probability:Number.parseFloat(e)/100,steps:t})},{name:"Operation",symbols:[ct.has("identifier")?{type:"identifier"}:identifier,ct.has("openBracket")?{type:"openBracket"}:openBracket,"EmptyParameters","ws",ct.has("closedBracket")?{type:"closedBracket"}:closedBracket],postprocess:([{value:e},,t])=>({type:"operation",children:t,identifier:e})},{name:"EmptyParameters",symbols:["ws","Parameters"],postprocess:([,e])=>e},{name:"EmptyParameters",symbols:[],postprocess:()=>[]},{name:"Parameters$ebnf$1",symbols:[]},{name:"Parameters$ebnf$1",symbols:["Parameters$ebnf$1","Parameter"],postprocess:e=>e[0].concat([e[1]])},{name:"Parameters",symbols:["Parameters$ebnf$1","Steps"],postprocess:([e,t])=>[...e,t]},{name:"Parameter",symbols:["Steps","ws",ct.has("comma")?{type:"comma"}:comma,"ws"],postprocess:([e])=>e},{name:"Symbol",symbols:[ct.has("identifier")?{type:"identifier"}:identifier],postprocess:([{value:e}])=>({type:"symbol",identifier:e})},{name:"ws",symbols:[ct.has("ws")?{type:"ws"}:ws]},{name:"ws",symbols:[]},{name:"Constant",symbols:[ct.has("boolean")?{type:"boolean"}:boolean],postprocess:([{value:e}])=>"true"===e},{name:"Constant",symbols:[ct.has("string")?{type:"string"}:string],postprocess:([{value:e}])=>e.slice(1,-1)},{name:"Constant",symbols:[ct.has("number")?{type:"number"}:number],postprocess:([{value:e}])=>Number.parseFloat(e)},{name:"Constant",symbols:[ct.has("int")?{type:"int"}:int],postprocess:([{value:e}])=>Number.parseInt(e)},{name:"GetVariable",symbols:[ct.has("thisSymbol")?{type:"thisSymbol"}:thisSymbol,ct.has("point")?{type:"point"}:point,ct.has("identifier")?{type:"identifier"}:identifier],postprocess:([,,{value:e}])=>({type:"getVariable",identifier:e})},{name:"SetVariable",symbols:[ct.has("thisSymbol")?{type:"thisSymbol"}:thisSymbol,ct.has("point")?{type:"point"}:point,ct.has("identifier")?{type:"identifier"}:identifier,"ws",ct.has("equal")?{type:"equal"}:equal,"ws","Step"],postprocess:([,,{value:e},,,,t])=>({type:"setVariable",identifier:e,children:[t]})},{name:"Conditional",symbols:["IfThenElse"],postprocess:([e])=>e},{name:"Conditional",symbols:["Switch"],postprocess:([e])=>e},{name:"IfThenElse",symbols:[ct.has("ifSymbol")?{type:"ifSymbol"}:ifSymbol,ct.has("ws")?{type:"ws"}:ws,"Steps",ct.has("ws")?{type:"ws"}:ws,"Then","ws","Else"],postprocess:([,,e,,t,,n])=>({type:"if",children:[e,t,n]})},{name:"Then",symbols:[ct.has("thenSymbol")?{type:"thenSymbol"}:thenSymbol,"ws",ct.has("openCurlyBracket")?{type:"openCurlyBracket"}:openCurlyBracket,"ws","Steps","ws",ct.has("closedCurlyBracket")?{type:"closedCurlyBracket"}:closedCurlyBracket],postprocess:([,,,,e])=>e},{name:"Else",symbols:[ct.has("elseSymbol")?{type:"elseSymbol"}:elseSymbol,"ws",ct.has("openCurlyBracket")?{type:"openCurlyBracket"}:openCurlyBracket,"ws","Steps","ws",ct.has("closedCurlyBracket")?{type:"closedCurlyBracket"}:closedCurlyBracket],postprocess:([,,,,e])=>e},{name:"Switch$ebnf$1",symbols:[]},{name:"Switch$ebnf$1",symbols:["Switch$ebnf$1","SwitchCases"],postprocess:e=>e[0].concat([e[1]])},{name:"Switch",symbols:[ct.has("switchSymbol")?{type:"switchSymbol"}:switchSymbol,ct.has("ws")?{type:"ws"}:ws,"Steps","ws",ct.has("openCurlyBracket")?{type:"openCurlyBracket"}:openCurlyBracket,"Switch$ebnf$1","ws",ct.has("closedCurlyBracket")?{type:"closedCurlyBracket"}:closedCurlyBracket],postprocess:([,,e,,,t])=>({type:"switch",cases:t.map((({caseValues:e})=>e)),children:[e,...t.map((({steps:e})=>e))]})},{name:"SwitchCases$ebnf$1",symbols:["SwitchCase"]},{name:"SwitchCases$ebnf$1",symbols:["SwitchCases$ebnf$1","SwitchCase"],postprocess:e=>e[0].concat([e[1]])},{name:"SwitchCases",symbols:["ws","SwitchCases$ebnf$1","Steps"],postprocess:([,e,t])=>({caseValues:e,steps:t})},{name:"SwitchCase",symbols:[ct.has("caseSymbol")?{type:"caseSymbol"}:caseSymbol,ct.has("ws")?{type:"ws"}:ws,"Constant",ct.has("colon")?{type:"colon"}:colon,"ws"],postprocess:([,,e])=>e}],ParserStart:"GrammarDefinition"};const pt=lt.Grammar.fromCompiled(ut);function ft(e){const t=new lt.Parser(pt);if(t.feed(e),0===t.results.length)throw new Error("unexpected end of input");return t.results[0]}function mt(e,t,n,r){const o={fromStep:(e,n,r)=>function(e,t,n,r,o){if(null!=e&&"string"!=typeof t&&j(e,t))return n.join(n.fromText("(",t),n.getWhitespace(o+1,t),r(o+1,t),n.getWhitespace(o,t),n.fromText(")",t));return r(o,t)}(n,r,o,t,e),fromText:e,getWhitespace:r,join:n};return o}function dt(e,t){return t.join(...e.map((({name:e,step:n},r)=>{const o=t.fromStep(0,void 0,e),i=t.fromText(" --\x3e",e),a=t.getWhitespace(1,n),l=t.fromStep(1,void 0,n);return 0===r?t.join(o,i,a,l):t.join(t.getWhitespace(0,e),o,i,a,l)})))}function ht(e,t,n=0){switch(e.type){case"operation":return function(e,t,n){const r=t.getWhitespace(n,e),o=t.getWhitespace(n+1,e);return t.join(t.fromText(`${e.identifier}(`,e),...bt(e.children.map((r=>t.join(o,t.fromStep(n+1,e,r)))),t.fromText(",",e)),r,t.fromText(")",e))}(e,t,n);case"parallel":return function(e,t,n){const r=t.getWhitespace(n,e);return t.join(...bt(e.children.map((r=>t.fromStep(n,e,r))),t.join(t.fromText(" |",e),r)))}(e,t,n);case"raw":return function(e,t,n){return t.fromText(gt(e.value),e)}(e,t);case"sequential":return function(e,t,n){const r=t.getWhitespace(n,e);return t.join(...bt(e.children.map((r=>t.fromStep(n,e,r))),t.join(t.fromText(" ->",e),r)))}(e,t,n);case"symbol":return function(e,t,n){return t.fromText(e.identifier,e)}(e,t);case"this":return function(e,t,n){return t.fromText("this",e)}(e,t);case"invert":case"not":return function(e,t,n){switch(e.type){case"invert":return t.join(t.fromText("-",e),t.fromStep(n,e,e.children[0]));case"not":return t.join(t.fromText("!",e),t.fromStep(n,e,e.children[0]))}}(e,t,n);case"add":case"and":case"divide":case"equal":case"greater":case"greaterEqual":case"modulo":case"multiply":case"or":case"smaller":case"smallerEqual":case"subtract":case"unequal":return function(e,t,n){return t.join(t.fromStep(n,e,e.children[0]),t.fromText(` ${vt[e.type]} `,e),t.fromStep(n,e,e.children[1]))}(e,t,n);case"if":return function(e,t,n){const[r,o,i]=e.children,a=t.getWhitespace(n+1,r),l=t.getWhitespace(n,r),s=t.getWhitespace(n+1,o,i),c=t.getWhitespace(n,o,i);return t.join(t.fromText("if",e),a,t.fromStep(n+1,e,r),l,t.fromText("then {",e),s,t.fromStep(n+1,e,o),c,t.fromText("} else {",e),s,t.fromStep(n+1,e,i),c,t.fromText("}",e))}(e,t,n);case"switch":return function(e,t,n){const r=t.getWhitespace(n,e),o=t.getWhitespace(n+1,e);return t.join(t.fromText("switch",e),t.getWhitespace(n+1,e.children[0]),t.fromStep(n+1,e,e.children[0]),r,t.fromText("{",e),...e.cases.map(((r,i)=>[...r.reduce(((n,r)=>[...n,o,t.fromText(`case ${gt(r)}:`,e)]),[]),t.getWhitespace(n+2,e.children[i+1]),t.fromStep(n+2,e,e.children[i+1])])).reduce(((e,t)=>e.concat(t)),[]),r,t.fromText("}",e))}(e,t,n);case"getVariable":return function(e,t,n){return t.fromText(`this.${e.identifier}`,e)}(e,t);case"setVariable":return function(e,t,n){return t.join(t.fromText(`this.${e.identifier} =`,e),t.getWhitespace(n+1,e.children[0]),t.fromStep(n+1,e,e.children[0]))}(e,t,n);case"return":return function(e,t,n){return t.fromText("return",e)}(e,t);case"random":return function(e,t,n){if(e.children.length!=e.probabilities.length)throw new Error("random step must have the same amount of childrens as the amount of probabilities");const r=t.getWhitespace(n,e),o=t.getWhitespace(n+1,e);return t.join(t.fromText("{",e),...e.children.map(((r,i)=>[o,t.fromText(`${yt(100*e.probabilities[i],2)}%:`,e),o,t.fromStep(n+1,e,r)])).reduce(((e,t)=>e.concat(t)),[]),r,t.fromText("}",e))}(e,t,n);case"null":return function(e,t,n){return t.fromText("null",e)}(e,t)}}function yt(e,t){const n=Math.pow(10,t);return(Math.round(e*n)/n).toString()}const vt={add:"+",and:"&&",divide:"/",equal:"==",greater:">",greaterEqual:">=",modulo:"%",multiply:"*",or:"||",smaller:"<",smallerEqual:"<=",subtract:"-",unequal:"!="};function gt(e){switch(typeof e){case"string":return`"${e}"`;case"number":return""+Math.round(100*e)/100;case"boolean":return e.toString();default:throw new Error(`constant "${e}" of unexpected type`)}}function bt(e,t){const n=[];for(let r=0;r<e.length;r++)n.push(e[r]),r<e.length-1&&n.push(t);return n}function xt(e,...t){return"string"===typeof t[0]?"\n":" "}function wt(e,...t){for(const n of t){if("string"===typeof n)return"\n\n";if(jt(n)>2)return`\n${"\t".repeat(e)}`}return" "}function jt(e){var t,n;return null!==(n=null===(t=e.children)||void 0===t?void 0:t.reduce(((e,t)=>e+jt(t)+1),0))&&void 0!==n?n:0}function St(e=(()=>{}),t=xt){const n=mt((e=>e),((t,r)=>{var o;return null!==(o=e(r))&&void 0!==o?o:"string"===typeof r?r:ht(r,n,t)}),((...e)=>e.join("")),t);return n}function Ot(e,t=(()=>{}),n=xt){return dt(e,St(t,n))}function Mt(e,t=0,n=(()=>{}),r=xt){return St(n,r).fromStep(t,void 0,e)}var Pt,Et=n(8170),Nt=n(3184),At=n(5900),kt=n(1026),Ct=n(6621),Vt=n(6431),zt=n(6427),Tt=n(2432),Lt=n(1556),Dt=n(7506),It=n(5314),Bt=n(5954),qt=n(2598),Gt=n(4340),Rt=n(2384),Zt=n(1952),Qt=n(6562),$t=n(8167);function Xt(e){return t=>{const n=new Nt.t(1);return t.pipe((0,Vt.b)((()=>n.next())),(0,Gt.f)(n.pipe((0,Rt.b)(e))),(0,Zt.x)((()=>n.complete())))}}function Ft(e,t,n,r,o,i,a){const l=null==o?e:o(e),s=Ut(n,r.index),c=t[s];return null!=t[s]&&function(e,t){const n=Math.min(e.length,t.length);for(let r=0;r<n;r++)if(e[r]!=t[r])return!1;return!0}(c,r.index)&&(a(l,s),t.splice(s,1)),r.type===Pt.SET&&(i(l,r.value,s),t.splice(s,0,r.index)),l}function Yt(){return e=>e.pipe((0,Lt.z)((e=>e.invalid.value?Qt.C:(0,At.T)((0,ot.of)({index:e.index,type:Pt.SET,value:e}),e.invalid.observable.pipe((0,Bt.q)(1),(0,$t.h)({index:e.index,type:Pt.UNSET}))))))}function Ut(e,t){if(0===t.length)return 0;if(!Array.isArray(e))return 0;const n=t[0];let r=0;for(let o=0;o<n;o++)r+=Ht(e[o]);return r+Ut(e[n],t.slice(1))}function Wt(e,t,n=t.index){if(0===n.length)return t.type===Pt.SET?t.value:void 0;const r=n[0],o=Array.isArray(e)?e:[],i=Wt(o[r],t,n.slice(1)),a=[],l=Math.max(o.length,r+1);let s=0,c=0;for(let u=0;u<l;u++){const e=u===r?i:o[u];a[u]=e,void 0!==e&&(s+=Ht(e),c=u+1)}return 0!==s?(a.splice(c),Object.assign(a,{size:s})):void 0}function Ht(e){return null==e?0:Array.isArray(e)&&"size"in e?e.size:1}function _t(e){return t=>e(...t.raw).pipe((0,at.U)((e=>1===e.length?[Object.assign(Object.assign({},t),{raw:e[0]})]:e.map(((e,n)=>Object.assign(Object.assign({},t),{raw:e,index:[...t.index,n]}))))))}function Kt(e){for(const t of e)if(t.value)return!0;return!1}function Jt(...e){return{observable:(0,At.T)(...e.map((({observable:e})=>e))).pipe((0,kt.d)({refCount:!0,bufferSize:1})),value:Kt(e)}}function en(e,t,n){var r;if(0===e.length)return e=>e;const o=e[0].name,i={},a=Object.assign(Object.assign({grammar:e,compiledGrammar:i,operations:t},n),{maxSymbolDepth:null!==(r=n.maxSymbolDepth)&&void 0!==r?r:100});for(const{name:l,step:s}of e)i[l]=nn(s,a);return i[o]}!function(e){e[e.SET=0]="SET",e[e.UNSET=1]="UNSET"}(Pt||(Pt={}));const tn=(0,Ct.h)((({invalid:e})=>!e.value));function nn(e,t,n){try{const{delay:r,listeners:o}=t,i=[tn];if(null!=(null===o||void 0===o?void 0:o.onAfterStep)){const t=o.onAfterStep.bind(null,e);i.push((0,Vt.b)(t))}null!=n&&null!=r&&i.push((0,zt.g)(r)),null!=n&&i.push(n);const a=function(e,t,n){switch(e.type){case"operation":return function(e,t,n){const r=e.children,o=t.operations[e.identifier];if(null==o)throw new Error(`unknown operation "${e.identifier}"`);const i=r.map((e=>nn(e,t)));o.includeThis&&i.unshift((e=>e));return e=>e.pipe(cn(...i),(0,Lt.z)((e=>o.execute(e).pipe((0,Lt.z)((e=>(0,At.T)(...e.map((e=>(0,ot.of)(e).pipe(n))))))))))}(e,t,n);case"parallel":return function(e,t,n){return r=>{const o=r.pipe((0,kt.d)({refCount:!0}));return(0,At.T)(...e.children.map(((e,r)=>o.pipe((0,at.U)((e=>Object.assign(Object.assign({},e),{index:[...e.index,r]}))),nn(e,t,n)))))}}(e,t,n);case"raw":return function(e,t){return n=>n.pipe((0,at.U)((t=>Object.assign(Object.assign({},t),{raw:e.value}))),t)}(e,n);case"sequential":return function(e,t,n){return sn(0,e.children,t,n)}(e,t,n);case"symbol":return function(e,t,n){if(null==K(e.identifier,t.grammar))throw new Error(`unknown symbol "${e.identifier}"`);return r=>{const o=r.pipe((0,kt.d)({refCount:!0,bufferSize:1}));return o.pipe((0,Bt.q)(1),(0,Lt.z)((()=>o.pipe((0,at.U)((n=>{var r;const o=null!==(r=n.symbolDepth[e.identifier])&&void 0!==r?r:0;if(o>=t.maxSymbolDepth)throw new Error(`maximum symbol depth (${t.maxSymbolDepth}) reached for symbol "${e.identifier}"`);return Object.assign(Object.assign({},n),{symbolDepth:Object.assign(Object.assign({},n.symbolDepth),{[e.identifier]:o+1})})})),t.compiledGrammar[e.identifier],n))))}}(e,t,n);case"this":return n;case"invert":case"not":return function(e,t,n){const r=nn(e.children[0],t);return t=>t.pipe(r,(0,at.U)((t=>Object.assign(Object.assign({},t),{raw:rn[e.type](t.raw)}))),n)}(e,t,n);case"add":case"and":case"divide":case"equal":case"greater":case"greaterEqual":case"modulo":case"multiply":case"or":case"smaller":case"smallerEqual":case"subtract":case"unequal":return function(e,t,n){const r=e.children.map((e=>nn(e,t)));return t=>t.pipe(cn(...r),(0,at.U)((t=>Object.assign(Object.assign({},t),{raw:on[e.type](t.raw[0],t.raw[1])}))),n)}(e,t,n);case"if":return function(e,t,n){const r=nn(e.children[0],t),[o,i]=e.children.slice(1).map((e=>nn(e,t,n)));return e=>e.pipe(cn((e=>e),r),(0,Dt.v)((({raw:[,e]})=>e)),(0,Lt.z)((e=>e.pipe((0,at.U)((e=>Object.assign(Object.assign({},e),{raw:e.raw[0]}))),e.key?o:i))))}(e,t,n);case"switch":return function(e,t,n){const r=nn(e.children[0],t),o=e.children.slice(1).map((e=>nn(e,t,n)));return t=>t.pipe(cn((e=>e),r),(0,Dt.v)((({raw:[,e]})=>e)),(0,Lt.z)((t=>{const n=e.cases.findIndex((e=>e.includes(t.key)));return-1===n?It.E:t.pipe((0,at.U)((e=>Object.assign(Object.assign({},e),{raw:e.raw[0]}))),o[n])})))}(e,t,n);case"getVariable":return function(e,t){return(0,Lt.z)((n=>{var r;return(null!==(r=n.variables[e.identifier])&&void 0!==r?r:(0,ot.of)(void 0)).pipe(an(n.invalid,n.index,n.variables),t)}))}(e,n);case"setVariable":return function(e,t,n){const r=nn(e.children[0],t);return t=>{const o=t.pipe((0,kt.d)({refCount:!0})),i=o.pipe(r);return o.pipe((0,at.U)((t=>Object.assign(Object.assign({},t),{variables:Object.assign(Object.assign({},t.variables),{[e.identifier]:i})}))),n)}}(e,t,n);case"return":return e=>e;case"random":return function(e,t,n){var r;const o=e.children.map((e=>nn(e,t,n)));let i;if(null!=(null===(r=t.listeners)||void 0===r?void 0:r.onRandom)){const n=t.listeners.onRandom;i=(0,Lt.z)((t=>t.pipe((0,Vt.b)({next:r=>n(e,r,t.key)}),o[t.key])))}else i=(0,Lt.z)((e=>e.pipe(o[e.key])));return n=>n.pipe((0,Dt.v)((n=>{const r=(0,Et.v3)(n.index.join(","),t.seed)/ln;let o=0;for(let t=0;t<e.probabilities.length;t++)if(o+=e.probabilities[t],r<=o)return t;return e.probabilities.length-1})),i)}(e,t,n);case"null":return()=>It.E}}(e,t,(e=>e.pipe(...i)));if(null!=(null===o||void 0===o?void 0:o.onBeforeStep)){const t=o.onBeforeStep.bind(null,e);return e=>e.pipe((0,Vt.b)(t),a)}return a}catch(r){return()=>(0,Tt._)((()=>r))}}const rn={invert:e=>-e,not:e=>!e};const on={add:(e,t)=>e+t,and:(e,t)=>e&&t,divide:(e,t)=>e/t,equal:(e,t)=>e==t,greater:(e,t)=>e>t,greaterEqual:(e,t)=>e>=t,modulo:(e,t)=>e%t,multiply:(e,t)=>e*t,or:(e,t)=>e||t,smaller:(e,t)=>e<t,smallerEqual:(e,t)=>e<=t,subtract:(e,t)=>e-t,unequal:(e,t)=>e!=t};function an(e,t,n){return r=>{let o;return r.pipe((0,at.U)((r=>(null!=o&&o.invalidate(),o=function(){const e=new Nt.t(1),t={invalidate:()=>{t.value=!0,e.next()},complete:()=>e.complete(),observable:e,value:!1};return t}(),{raw:r,index:null!==t&&void 0!==t?t:[],invalid:null==e?o:Jt(o,e),variables:null!==n&&void 0!==n?n:{},symbolDepth:{}}))),(0,Vt.b)({complete:()=>null===o||void 0===o?void 0:o.complete()}))}}const ln=Math.pow(2,32);function sn(e,t,n,r){return e>=t.length?r:nn(t[e],n,sn(e+1,t,n,r))}function cn(...e){return t=>{const n=t.pipe((0,kt.d)({refCount:!0})),r=[e=>e,...e];return(0,At.T)(...r.map(((e,t)=>n.pipe(e,(0,at.U)((e=>Object.assign(Object.assign({},e),{index:[...e.index,t]}))))))).pipe((0,Dt.v)((e=>e.index.slice(0,-1).join(","))),(0,Lt.z)((t=>t.pipe(function(){return e=()=>[],t=e=>[...e],n=(e,t,n)=>e.splice(n,0,t),r=(e,t)=>e.splice(t,1),o=>o.pipe(Yt(),Xt(0),(0,qt.R)((([e,o,i],a)=>{for(const l of a)e=Ft(e,o,i,l,t,n,r),i=Wt(i,l);return[e,o,i]}),[e(),[],void 0]),(0,at.U)((([e])=>e)));var e,t,n,r}(),(0,Ct.h)((t=>t.length===e.length+1)),(0,at.U)((e=>{const[t,...n]=e;return{variables:t.variables,index:t.index.slice(0,-1),invalid:Jt(...e.map((({invalid:e})=>e))),raw:n.map((({raw:e})=>e)),symbolDepth:t.symbolDepth}}))))))}}var un=n(6102);class pn{constructor(){this.matrix=[]}set(e,t,n){if(t>e){const n=t;t=e,e=n}let r=this.matrix[t];null==r&&(r=[],this.matrix[t]=r),r[e]=n}get(e,t){if(t>e){const n=t;t=e,e=n}return this.matrix[t][e]}}function fn(e,t,n,r=0,o=e[0].horizontal.length,i=new Array(e.length).fill(void 0).map(((e,t)=>t)),a=1){if(0===i.length)throw new Error("unable to nest group with a height 0 zero (yList.length == 0)");if(1===i.length)return vn(n.nestVerticalGroups(e,t,n,r,o,i,a),n.filterValue);let l,s,c;const u=new pn;for(const p of i)for(const f of i){if(f<=p)continue;const i=n.rowSimilarity(e,t,n,a,r,o,p,f);u.set(p,f,i),(null==c||i<c)&&(l=p,s=f,c=i)}return c<n.minRowSimilarity?[yn(mn(e,t,n,u,l,s,c>=0,r,o,i,a))]:vn(n.nestVerticalGroups(e,t,n,r,o,i,a),n.filterValue)}function mn(e,t,n,r,o,i,a,l,s,c,u){const p=[o],f=[i],m=new Set(c);m.delete(o),m.delete(i);let d=e[o].probability,h=e[i].probability;for(;m.size>0;){const{similarity:t,y:n}=dn(p,m,r),{similarity:o,y:i}=dn(f,m,r);t>=o?(p.push(n),m.delete(n),d+=e[n].probability):(f.push(i),m.delete(i),h+=e[i].probability)}p.sort(),f.sort();const{child:y,parent:v}=hn(d,u),{child:g,parent:b}=hn(h,u);return{compatible:a,vertical:[{group:fn(e,t,n,l,s,p,y),probability:v},{group:fn(e,t,n,l,s,f,g),probability:b}]}}function dn(e,t,n){let r,o;for(const i of t){let t=0;for(const r of e)t+=n.get(i,r);t/=e.length,(null==r||t>r)&&(r=t,o=i)}return{similarity:r,y:o}}function hn(e,t){return t*e<=1?{parent:e*t,child:1/e}:{parent:1,child:t}}function yn(e,t=1){return{vertical:e.vertical.reduce(((n,{group:r,probability:o})=>{const i=o*t;return Array.isArray(r)&&1===r.length&&r[0].compatible===e.compatible?n.concat(yn(r[0],i).vertical):n.concat({group:r,probability:i})}),[]),compatible:e.compatible}}function vn(e,t,n=1){return e.reduce(((e,r)=>{if(1===r.vertical.length){const{group:o,probability:i}=r.vertical[0];if(Array.isArray(o)){const r=vn(o,t,i*n);return[...e,...r]}if(!t(o))return e}return[...e,{vertical:r.vertical.map((({group:e,probability:t})=>({group:e,probability:t*n}))),compatible:r.compatible}]}),[])}function gn(e,t,n){switch(e.type){case"random":return function(e,t,n){return e.children.map(((r,o)=>gn(r,t,e.probabilities[o]*n))).reduce(((e,t)=>xn(e,t,!0)))}(e,t,n);case"if":return function(e,t,n){return xn(wn(gn(e.children[1],t,n/2),(n=>({horizontal:[{type:"filterStart",children:[gn(e.children[0],t,1)],values:[!0],options:2},...n.horizontal,{type:"filterEnd"}],probability:n.probability}))),wn(gn(e.children[2],t,n/2),(n=>({horizontal:[{type:"filterStart",children:[gn(e.children[0],t,1)],values:[!1],options:2},...n.horizontal,{type:"filterEnd"}],probability:n.probability}))),!0)}(e,t,n);case"sequential":return function(e,t,n){const{seperationMatrix:r,vertical:o}=e.children.map((e=>gn(e,t,1))).reduce(((e,t)=>function(e,t){const n=[],r=[];for(let o=0;o<e.vertical.length;o++)for(let i=0;i<t.vertical.length;i++){const a=o*t.vertical.length+i;n[a]={horizontal:[...e.vertical[o].horizontal,...t.vertical[i].horizontal],probability:e.vertical[o].probability*t.vertical[i].probability};for(let n=0;n<e.vertical.length;n++)for(let l=0;l<t.vertical.length;l++){const s=n*t.vertical.length+l;let c=r[a],u=r[s];null==c&&(c=[],r[a]=c),null==u&&(u=[],r[s]=u);const p=e.seperationMatrix[o][n]&&t.seperationMatrix[i][l];c[s]=p,u[a]=p}}return{vertical:n,seperationMatrix:r}}(e,t)));return{seperationMatrix:r,vertical:o.map((({horizontal:e,probability:t})=>({horizontal:e,probability:t*n})))}}(e,t,n);case"parallel":return function(e,t,n){return e.children.map((e=>gn(e,t,n))).reduce(((e,t)=>xn(e,t,!1)))}(e,t,n);case"switch":return function(e,t,n){const r=n/(e.children.length-1),o=gn(e.children[0],t,1);return e.children.slice(1).map(((n,i)=>wn(gn(n,t,r),(t=>({horizontal:[{type:"filterStart",children:[o],values:e.cases[i],options:e.children.length-1},...t.horizontal,{type:"filterEnd"}],probability:t.probability}))))).reduce(((e,t)=>xn(e,t,!0)))}(e,t,n);case"symbol":return function(e,t,n){return wn(gn(t(e.identifier),t,n),(t=>({horizontal:[{type:"nounStart",identifier:e.identifier},...t.horizontal,{type:"nounEnd"}],probability:t.probability})))}(e,t,n);default:return{seperationMatrix:[[!0]],vertical:[{probability:n,horizontal:[bn(e,t)]}]}}}function bn(e,t){return null!=e.children?Object.assign(Object.assign({},e),{children:e.children.map((e=>gn(e,t,1)))}):e}function xn(e,t,n){const r=e.seperationMatrix.map((e=>e.concat(new Array(t.vertical.length).fill(n)))),o=t.seperationMatrix.map((t=>new Array(e.vertical.length).fill(n).concat(t)));return{vertical:e.vertical.concat(t.vertical),seperationMatrix:r.concat(o)}}function wn(e,t){return{seperationMatrix:e.seperationMatrix,vertical:e.vertical.map(t)}}function jn(e,t,n,r,o){const i=[];for(const a of o){let o=i.find((o=>t(e[o[0]].horizontal[r],e[a].horizontal[r])>=n));null==o&&(o=[],i.push(o)),o.push(a)}return i}function Sn(e,t){if(0===t.length)return{type:"this"};const n=t[0].value;switch(n.type){case"filterStart":case"filterEnd":case"nounStart":case"nounEnd":throw new Error(`unable to combine "${n.type}" here (should be done earlier)`);case"this":case"null":case"raw":case"getVariable":return n;default:return Object.assign(Object.assign({},n),{children:null==n.children?void 0:On(t.map((({value:e})=>e.children)),t.map((({probability:e})=>e)),e.createNoun)})}}function On(e,t,n){const r=Math.max(...e.map((e=>e.length)));return new Array(r).fill(void 0).map(((r,o)=>Vn(e.map(((e,n)=>{const r=e[o],i=t[n];if(null!=r)return function(e,t){return{seperationMatrix:e.seperationMatrix,vertical:e.vertical.map((e=>({horizontal:e.horizontal,probability:e.probability*t})))}}(r,i)})).filter(_).reduce(((e,t)=>xn(e,t,!0))),n)))}function Mn(e,t){const{maxSimilarity:n,similarity:r}=Pn(e,t);return r/n}function Pn(e,t){if(e.type!==t.type)return{similarity:0,maxSimilarity:1};switch(e.type){case"filterStart":if(typeof e.values[0]!==typeof t.values[0])return{similarity:0,maxSimilarity:1};break;case"setVariable":case"operation":if(e.identifier!==t.identifier)return{similarity:0,maxSimilarity:1};break;case"getVariable":case"nounStart":return{similarity:e.identifier===t.identifier?1:0,maxSimilarity:1};case"raw":return{similarity:e.value===t.value?1:0,maxSimilarity:1};case"filterEnd":case"nounEnd":return{similarity:1,maxSimilarity:1}}if(null==e.children)return{similarity:1,maxSimilarity:1};const{maxSimilarity:n,similarity:r}=function(e,t){let n=0,r=0;for(let o=0;o<Math.max(e.length,t.length);o++){const i=e[o],a=t[o];if(null==i||null==a){r++;continue}const{maxSimilarity:l,similarity:s}=En(i,a);n+=s,r+=l}return{similarity:n,maxSimilarity:r}}(e.children,t.children);return{maxSimilarity:n+1,similarity:r+1}}function En(e,t){return 1===e.vertical.length&&1===e.vertical[0].horizontal.length&&1===t.vertical.length&&1===t.vertical[0].horizontal.length?Pn(e.vertical[0].horizontal[0],t.vertical[0].horizontal[0]):{similarity:1,maxSimilarity:2}}function Nn(e,t,n,r,o,i,a,l){let s=0,c=0;for(let u=o;u<i;u++){const t=e[a].horizontal[u],r=e[l].horizontal[u];if(!("filterEnd"===t.type&&"filterEnd"===r.type||"nounEnd"===t.type&&"nounEnd"===r.type||"this"===t.type&&"this"===r.type)&&(++c,!(Mn(t,r)<n.minValueSimilarity)&&(s++,"filterStart"===t.type&&"filterStart"===r.type&&!W(t.values,r.values)))){let t=1,n=1;for(;t>0&&n>0&&u<i;){u++;const r=e[a].horizontal[u],o=e[l].horizontal[u];"filterStart"===r.type?t++:"filterEnd"===r.type&&t--,"filterStart"===o.type?n++:"filterEnd"===o.type&&n--}}}return 0===c?s=1:s/=c,t[a][l]?(e[a].probability+e[l].probability)*r>1.001&&(s=-1.5):s=-3,s}function An(e){if(!Array.isArray(e))return e;const t=e.map((e=>{const t=[],n=new Set(e.vertical);let r,o;for(;n.size>0;){const[i]=n;let a;if(e.compatible&&null!=r&&null!=o&&null!=(a=kn(n,o))){n.delete(a),r.children.push(An(a.group)),r.probabilities.push(a.probability),o+=a.probability;continue}n.delete(i);const l=An(i.group);e.compatible?b(i.probability,1)?(t.push(l),r=void 0,o=void 0):(r={type:"random",children:[l],probabilities:[i.probability]},o=i.probability,t.push(r)):(t.push(b(i.probability,1)?l:{type:"random",children:[l],probabilities:[i.probability]}),r=void 0,o=void 0)}return 1===t.length?t[0]:{type:"parallel",children:t}}));return 0===t.length?{type:"this"}:1===t.length?t[0]:{type:"sequential",children:t}}function kn(e,t){if(b(t,1))return;const n=1-t+g;let r,o;for(const i of e)i.probability>n||(null==o||i.probability>o)&&(o=i.probability,r=i);return r}const Cn=(e,t,n,r,o,i,a)=>{var l,s;let c,u;const p=new Array(i.length).fill(!1),f=new Array(i.length).fill(0);for(let w=r;w<o;w++){for(let t=0;t<i.length;t++){const n=i[t],r=e[n].horizontal[w];"filterStart"!==r.type&&"nounStart"!==r.type||(c=w,f[t]=1,u=r,p[t]=!0)}if(null!=c)break}if(null==c||null==u)return function(e,t,n,r,o,i,a,l,s,c){if(l-a<=0)throw new Error("unable to nest vertical groups with with <= 0");let u=jn(e,r,o,a,s),p=a;for(let d=a+1;d<l;d++){const t=jn(e,r,o,d,s);t.length<u.length&&(u=t,p=d)}const f=[];p-a>0&&f.push(...fn(e,t,i,a,p,s,c));const m={compatible:!0,vertical:[]};f.push(m);for(const d of u){const t=d.reduce(((t,n)=>t+e[n].probability),0),r=t*c;m.vertical.push({group:n(i,d.map((n=>({value:e[n].horizontal[p],probability:e[n].probability/t})))),probability:r})}return l-(p+1)>0&&f.push(...fn(e,t,i,p+1,l,s,c)),f}(e,t,Sn,Mn,n.minValueSimilarity,n,r,o,i,a);const m=i.reduce(((t,n)=>t+e[n].probability),0),d=m*a,h=1/m,y=e.map((e=>({horizontal:[...e.horizontal],probability:e.probability}))),v=[];c-r>0&&v.push(...fn(e,t,n,r,c,i,a));let g,b=c+1,x=!1;for(;!x&&b<o;){x=!0;for(let t=0;t<i.length;t++){const n=i[t],r=e[n].horizontal[b];"filterStart"===r.type||"nounStart"===r.type?f[t]++:"filterEnd"!==r.type&&"nounEnd"!==r.type||f[t]--,0===f[t]?p[t]&&(p[t]=!1,y[n].horizontal[b]={type:"this"}):x=!1}b++}if("filterStart"===u.type){const r=[],o=[],u=[];let p=!0;for(let t=0;t<i.length;t++){const n=i[t],a=e[n].horizontal[c];if("filterStart"!==a.type){o.push(t);continue}u[t]=wn(a.children[0],(({horizontal:t})=>({horizontal:t,probability:e[n].probability*h}))),1===a.values.length&&"boolean"===typeof a.values[0]||(p=!1);let l=r.find((({values:e})=>W(e,a.values)));null==l&&(l={values:a.values,yList:[]},r.push(l)),l.yList.push(n)}for(const t of i){"filterStart"===e[t].horizontal[c].type&&(y[t].probability*=r.length)}for(const l of o){const o=i[l];let s,p;for(const e of r){let r=0;for(const i of e.yList)r+=Nn(y,t,n,a,c+1,b,o,i);r/=e.yList.length,(null==s||r>s)&&(s=r,p=e)}p.yList.push(o),u[l]={vertical:[{horizontal:[{type:"raw",value:p.values[0]}],probability:e[o].probability*h}],seperationMatrix:[[!0]]}}const f=Vn(u.reduce(((e,t)=>xn(e,t,!0))),n.createNoun);if(p){const e=null===(l=r.find((({values:e})=>!0===e[0])))||void 0===l?void 0:l.yList,o=null===(s=r.find((({values:e})=>!1===e[0])))||void 0===s?void 0:s.yList;g={type:"if",children:[f,null==e?{type:"null"}:An(fn(y,t,n,c+1,b,e,h)),null==o?{type:"null"}:An(fn(y,t,n,c+1,b,o,h))]}}else g={type:"switch",cases:r.map((({values:e})=>e)),children:[f,...r.map((({yList:e})=>An(fn(y,t,n,c+1,b,e,h))))]}}else{const e=n.createNoun(u.identifier);e.step=An(fn(y,t,n,c+1,b,i,h)),g={type:"symbol",identifier:e.name}}return v.push({compatible:!0,vertical:[{group:g,probability:d}]}),o-b>0&&v.push(...fn(e,t,n,b,o,i,a)),v};function Vn({seperationMatrix:e,vertical:t},n,r=1){const o=function(e,t,n){const r=e[0],o=[...r.horizontal],i=[{horizontal:[...r.horizontal],probability:r.probability}];for(let a=1;a<e.length;a++){const r=e[a],l=[...r.horizontal],s=(0,un.Bm)(o,l,{comparator:n});let c=0;for(const e of s){const n=e.value.length;if(e.added){o.splice(c,0,...e.value);for(const e of i)e.horizontal.splice(c,0,...new Array(n).fill(void 0).map((()=>t())))}else e.removed&&l.splice(c,0,...new Array(n).fill(void 0).map((()=>t())));c+=n}i.push({horizontal:l,probability:r.probability})}return i}(t,(()=>({type:"this"})),((e,t)=>Mn(e,t)>=.1));return An(fn(o,e,{createNoun:n,nestVerticalGroups:Cn,filterValue:e=>"this"!=e.type,minRowSimilarity:.1,minValueSimilarity:.1,rowSimilarity:Nn},void 0,void 0,void 0,r))}function zn(...e){const t=[],n={name:e[0][0].name,step:{type:"this"}};return t.push(n),n.step=function(e,t,n){const r=1/e.length;return Vn(e.map(((e,t)=>gn(e,n[t],r))).reduce(((e,t)=>xn(e,t,!0))),t)}(e.map((e=>e[0].step)),(e=>{const n={name:Tn(e,t),step:{type:"this"}};return t.push(n),n}),e.map((e=>t=>{const n=e.find((({name:e})=>t===e));if(null==n)throw new Error(`unknown noun "${t}"`);return n.step}))),t}function Tn(e,t){for(const{name:n}of t)if(n===e)return Tn(`${e}'`,t);return e}var Ln=n(1514),Dn=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function a(e){try{s(r.next(e))}catch(t){i(t)}}function l(e){try{s(r.throw(e))}catch(t){i(t)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,l)}s((r=r.apply(e,t||[])).next())}))};function In(e,t,n,r){return Dn(this,void 0,void 0,(function*(){const o=yield function(e,t,n,r){return Dn(this,void 0,void 0,(function*(){const o=new Map;return yield(0,Ln.n)((0,ot.of)(e).pipe(an(),en(t,n,Object.assign(Object.assign({},r),{listeners:{onRandom:(e,t,n)=>{let r=o.get(e);null==r&&(r=[],o.set(e,r)),r.push([t.index.join(","),n])}}})))),o}))}(e,t,n,r);return function(e,t){return e.map((({name:e,step:n})=>({name:e,step:Bn(n,t)})))}(t,o)}))}function Bn(e,t){if("random"===e.type){const n=t.get(e);if(null==n)return{type:"null"};const r=new Map;for(const[e,t]of n){let n=r.get(t);null==n&&(n=[],r.set(t,n)),n.push(e)}const o=Array.from(r.keys()).map((t=>e.children[t]));return 1===o.length?o[0]:{type:"switch",children:[{type:"operation",children:[],identifier:"id"},...o],cases:Array.from(r.values())}}return null==e.children?e:Object.assign(Object.assign({},e),{children:e.children.map((e=>Bn(e,t)))})}function qn(e,t){return"symbol"===e.type?D(e.identifier,t):"operation"===e.type?e.identifier:"raw"===e.type?e.value.toString():e.type}const Gn=D;function Rn(e,t){return"string"===typeof e?Gn(e,t):qn(e,t)}var Zn=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function a(e){try{s(r.next(e))}catch(t){i(t)}}function l(e){try{s(r.throw(e))}catch(t){i(t)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,l)}s((r=r.apply(e,t||[])).next())}))};const Qn=e=>e.index[e.index.length-1],$n=(e,t)=>Qn(e)%t;function Xn(e,t,n,r){return sr((e=>`in every set of ${n} select index ${e.join(", ")}`),e,t,(e=>$n(e,n)),(e=>((e,t)=>({type:"equal",children:[{type:"modulo",children:[{type:"operation",children:[],identifier:"index"},{type:"raw",value:t}]},{type:"raw",value:$n(e,t)}]}))(e,n)),r)}function Fn(e){return e.map(Qn).filter(((e,t,n)=>n.indexOf(e)===t)).sort(((e,t)=>e-t))}const Yn=()=>({description:"everything",isSelected:()=>!0,generateStep:void 0}),Un={generateContaining:Yn,generateMatching:Yn};function Wn(e,...t){const n=t.filter(_);let r;for(const o of n)(null==r||e(o,r))&&(r=o);return r}const Hn={generateMatching:(e,t)=>{const n=Fn(t),r=n[0]+1,o=n[1]-n[0];return Wn(((e,t)=>e.keySize<t.keySize),Xn(e,t,r,(n=>lr(e,t,n))),n.length>=2?Xn(e,t,o,(n=>lr(e,t,n))):void 0)},generateContaining:(e,t)=>{const n=Fn(t),r=n[0]+1,o=n[1]-n[0];return Wn(((e,t)=>e.selectionSize<t.selectionSize),Xn(e,t,r),n.length>=2?Xn(e,t,o):void 0)}},_n=e=>e.index.join(","),Kn={generateMatching:(e,t)=>sr((e=>`where index is one of ${e.join(", ")}`),e,t,Qn,(e=>({type:"equal",children:[{type:"operation",children:[],identifier:"index"},{type:"raw",value:Qn(e)}]})),(n=>lr(e,t,n))),generateContaining:(e,t)=>sr((e=>`where index is one of ${e.join(", ")}`),e,t,Qn,(e=>({type:"equal",children:[{type:"operation",children:[],identifier:"index"},{type:"raw",value:Qn(e)}]})))};function Jn(e,t,n,r){return{description:t(r),isSelected:t=>e(r,Qn(t)),generateStep:()=>({type:n,children:[{type:"operation",children:[],identifier:"index"},{type:"raw",value:r}]})}}const er=Jn.bind(null,((e,t)=>t>e),(e=>`where index > ${e}`),"greater"),tr=Jn.bind(null,((e,t)=>t<e),(e=>`where index < ${e}`),"smaller"),nr={generateMatching:(e,t)=>{const n=Math.max(...t.map(Qn))+1,r=e.filter((e=>Qn(e)<n));if(r.length!==e.length&&lr(e,t,r))return tr(n)},generateContaining:(e,t)=>{const n=Math.max(...t.map(Qn))+1;return tr(n)}},rr={generateMatching:(e,t)=>{const n=Math.min(...t.map(Qn))-1,r=e.filter((e=>Qn(e)>n));if(r.length!==e.length&&lr(e,t,r))return er(n)},generateContaining:(e,t)=>{const n=Math.min(...t.map(Qn))-1;return er(n)}},ir={generateMatching:(e,t)=>sr((e=>"exactly and only my selection"),e,t,_n,(e=>({type:"equal",children:[{type:"operation",children:[],identifier:"id"},{type:"raw",value:e.index.join(",")}]})),(n=>lr(e,t,n))),generateContaining:()=>{}};function ar(e,t,n,r){return Zn(this,void 0,void 0,(function*(){if(t.length===e.length)return;const o=n.map((n=>n.generateMatching(e,t))).filter(_);if(0===o.length)throw new Error("no pattern found (missing the allPatternType?)");return function(e){for(const t of e)if(null!=t.generateStep)return!1;return!0}(o)?void 0:r(o)}))}function lr(e,t,n){if(n.length!==t.length)return!1;for(const r of t)if(!n.includes(r))return!1;return!0}function sr(e,t,n,r,o,i){const a=new Map;for(const c of n){const e=r(c);a.has(e)||a.set(e,c)}const l=Array.from(a.keys()),s=t.filter((e=>l.includes(r(e))));if(s.length!==t.length&&0!==a.size&&(null==i||i(s)))return{description:e(l),isSelected:e=>a.has(r(e)),generateStep:()=>Array.from(a.values()).map((e=>o(e))).reduce(((e,t)=>({type:"or",children:[e,t]}))),keySize:a.size,selectionSize:s.length}}var cr=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function a(e){try{s(r.next(e))}catch(t){i(t)}}function l(e){try{s(r.throw(e))}catch(t){i(t)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,l)}s((r=r.apply(e,t||[])).next())}))};function ur(e){return"string"===typeof e?e:e.path.join(",")}function pr(e){return"string"===typeof e?[e]:e.path}function fr(e,t,n){return"string"===typeof e?"string"===typeof t&&e===t:ur(e)===(null!==n&&void 0!==n?n:ur(t))}function mr(e,t,n,r,o){return t.map((t=>{var i;const a=ur(t),l=null!==(i=e[a])&&void 0!==i?i:[],s=l.filter((e=>null!=n.find((t=>r(t,e)&&(null==o||o(e))))));if(!(0===s.length&&l.length>0))return{steps:t,values:s,generatePatternCondition:void 0}})).filter(_)}function dr(e,t){if("string"===typeof e){const n=[];for(const{step:r}of t)Mr(r,e,(e=>n.push(e)));return n}if(e.path.length>1){const n=M(t,e.path);return null==n?[]:[E(n,e.path.length-2)]}return[e.path[0]]}function hr(e,t,n,r,o){var i;return cr(this,void 0,void 0,(function*(){const a=ur(n.steps),l=null!==(i=t[a])&&void 0!==i?i:[];if(0===l.length)return e;const s=yield function(e,t,n,r){return Zn(this,void 0,void 0,(function*(){if(t.length===e.length)return;const o=n.map((n=>n.generateContaining(e,t))).filter(_);if(0===o.length)throw new Error("no pattern found (missing the allPatternType?)");return r(o)}))}(l.map((({after:e})=>e)),n.values.map((({after:e})=>e)),r,o);return(0,S.vV)(e.map((e=>e===n?Object.assign(Object.assign({},n),{generatePatternCondition:s.generateStep,values:l.filter((({after:e})=>s.isSelected(e)))}):e)))}))}function yr(e,t,n,r,o){var i;const a=ur(n),l=t.findIndex((e=>fr(e.steps,n,a))),s=null!==(i=e[a])&&void 0!==i?i:[];if(-1===l){if("remove"===o)return;return void t.push({steps:n,values:null==r?s:r})}const c=t[l];if(c.generatePatternCondition=void 0,null!=r){for(const e of r){const t=c.values.findIndex((t=>U(t.after.index,e.after.index)===Y.Equal));-1!==t||"toggle"!==o&&"add"!==o||c.values.push(e),-1===t||"toggle"!==o&&"remove"!==o||c.values.splice(t,1)}0===c.values.length&&t.splice(l,1)}else"toggle"===o||"remove"===o?t.splice(l,1):c.values=s}function vr(e,t,n,r){return(0,S.ZP)("replace"===r?[]:t,(t=>{for(const{steps:o,values:i}of n)yr(e,t,o,i,"replace"===r?"add":r)}))}var gr=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function a(e){try{s(r.next(e))}catch(t){i(t)}}function l(e){try{s(r.throw(e))}catch(t){i(t)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,l)}s((r=r.apply(e,t||[])).next())}))};function br(e,t,n,r,o,i,a){return gr(this,void 0,void 0,(function*(){const l=yield(0,S.ZP)({grammar:a,selectionsList:[]},(({grammar:l,selectionsList:s})=>gr(this,void 0,void 0,(function*(){var c,u;const p="parallel"===o?"parallel":"sequential";for(const{values:f,steps:m,generatePatternCondition:d}of t){const t="after"===o?[pr(m)]:Er(m,a);for(const a of t){const t=a.join(","),m=null!==(c=e[t])&&void 0!==c?c:[];if(m.length>0&&0===f.length)return;const h=M(l,a);if(null==h)continue;const y=i(a),v="parallel"===p?{type:"null"}:{type:"this"},g="parallel"===o?"before":o,b=null!==d&&void 0!==d?d:null===(u=yield ar(m.map((e=>e[g])),f.map((e=>e[g])),n,r))||void 0===u?void 0:u.generateStep,x=null==b?y:{type:"if",children:[b(),y,v]},w=E(h,a.length-1),j=a.length>1?E(h,a.length-2):void 0;if((null===j||void 0===j?void 0:j.type)===p){let e=a[a.length-1];"before"!==o&&(e+=1),j.children.splice(e,0,x),A(j,...a.slice(0,-1))}else P(a,h,a.length-1,{type:p,children:"before"===o?[x,w]:[w,x]});const S=y;s.push({steps:S,values:[]})}}}))));return Object.assign(Object.assign({},l),{hovered:void 0,dependencyMap:C(l.grammar)})}))}var xr=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function a(e){try{s(r.next(e))}catch(t){i(t)}}function l(e){try{s(r.throw(e))}catch(t){i(t)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,l)}s((r=r.apply(e,t||[])).next())}))};function wr(e,t,n){const r=new Set,o=new Set;for(const{name:i,step:a}of e){const e=Q(i);o.has(e)||null!=n&&!n.includes(e)||(r.add(i),o.add(e)),J(a,(e=>{"symbol"===e.type&&e.identifier!==i&&r.add(e.identifier)}))}return{grammar:(0,S.vV)(e.filter((e=>r.has(e.name)))),selectionsList:t.filter((e=>r.has(pr(e.steps)[0])))}}function jr(e,t,n,r,o,i){return xr(this,void 0,void 0,(function*(){null==K(o,i)&&(i=(0,S.ZP)(i,(e=>{e.push({name:o,step:{type:"this",path:[o]}})})));const a=yield br(e,t,n,r,"after",(()=>({type:"symbol",identifier:o})),i);return Object.assign(Object.assign({},a),{selectionsList:[{steps:o,values:[]}]})}))}function Sr(e,t,n,r,o=new Set){const i=L(t,n),a=L(t,r),l=e.find((e=>e.name===i));if(null==l)throw new Error(`unknown noun "${i}"`);const s=[],c=(0,S.ZP)(l.step,(t=>(J(t,(t=>{if("symbol"===t.type){const n=Q(t.identifier);if(n==r)return;const i=D(t.identifier,n),a=L(i,r);t.identifier=a,null!=e.find((e=>e.name===a))||o.has(i)||s.push({localNounName:i,descriptionName:n})}})),A(t,a))));o.add(t);const u={name:a,step:c};return(0,S.vV)(s.reduce(((t,{descriptionName:n,localNounName:i})=>t.concat(Sr(e,i,n,r,o))),[u]))}function Or(e,t,n,r,o,i){return xr(this,void 0,void 0,(function*(){const a=yield(0,S.ZP)({grammar:i,selectionsList:[]},(({grammar:a,selectionsList:l})=>xr(this,void 0,void 0,(function*(){for(const s of t){if("string"!==typeof s.steps)continue;const t=s.steps,c=K(t,i),u=K(t,a);if(null!=K(o,a)||null==c||null==u)continue;const p=A((0,S.vV)(i[c].step,!1),o);a.splice(u,0,{name:o,step:p});const f=dr(t,a);if(f.length>0){const t=mr(e,f,s.values,((e,t)=>{const n=U(e.before.index,t.before.index);return n===Y.Predecessor||n===Y.Equal}),void 0);yield Ar(e,t,n,r,(()=>({type:"symbol",identifier:o})),a)}l.push({steps:o,values:[]})}})))),l=wr(a.grammar,a.selectionsList);return Object.assign(Object.assign({hovered:void 0},l),{dependencyMap:C(l.grammar)})}))}function Mr(e,t,n){J(e,(e=>{"symbol"===e.type&&e.identifier===t&&n(e)}))}var Pr=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function a(e){try{s(r.next(e))}catch(t){i(t)}}function l(e){try{s(r.throw(e))}catch(t){i(t)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,l)}s((r=r.apply(e,t||[])).next())}))};function Er(e,t){if("string"===typeof e){const n=[];for(const{step:r}of t)Mr(r,e,(e=>n.push(e.path)));return n}return[e.path]}function Nr(e,t,n,r,o,i){return Pr(this,void 0,void 0,(function*(){const a=yield(0,S.Uy)({grammar:i,selectionsList:[]},(({grammar:i,selectionsList:a})=>Ar(e,t,n,r,o,i,a)));return Object.assign(Object.assign({},a),{dependencyMap:C(a.grammar),hovered:void 0})}))}function Ar(e,t,n,r,o,i,a){var l;return Pr(this,void 0,void 0,(function*(){for(const{values:s,steps:c,generatePatternCondition:u}of t)for(const t of Er(c,i)){const c=t.join(","),p=null!==(l=e[c])&&void 0!==l?l:[],f=M(i,t);null!=f&&(yield kr(p.map((({before:e})=>e)),s.map((({before:e})=>e)),n,r,o,t,f,a,u))}}))}function kr(e,t,n,r,o,i,a,l,s){var c,u;return Pr(this,void 0,void 0,(function*(){if(e.length>0&&0===t.length)return;const p=E(a,i.length-1),f=null!==(c=o(p,i,a))&&void 0!==c?c:p,m=(0,S.Js)(p),d=null!==s&&void 0!==s?s:null===(u=yield ar(e,t,n,r))||void 0===u?void 0:u.generateStep,h=null==d?f:{type:"if",children:[d(),f,m]};P(i,a,i.length-1,h);const y=f;null===l||void 0===l||l.push({steps:(0,S.vV)(y),values:[]})}))}var Cr=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function a(e){try{s(r.next(e))}catch(t){i(t)}}function l(e){try{s(r.throw(e))}catch(t){i(t)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,l)}s((r=r.apply(e,t||[])).next())}))};function Vr(e,t,n,r,o,i){return Cr(this,void 0,void 0,(function*(){const a=(e,t,n)=>function(e,t,n){if(Array.isArray(e)||"string"==typeof t)return{type:"this"};const r=e.children[t];switch(e.type){case"operation":{const r=n[e.identifier];if(null==r)break;const o=r.defaultParameters[t];return null==o?{type:"null"}:o()}case"sequential":return{type:"this"};case"parallel":case"random":return{type:"this"===r.type?"null":"this"};case"switch":case"if":if(0===t)break;return{type:"this"===r.type?"null":"this"}}}(n[n.length-2],t[t.length-1],o),l=wr(yield(0,S.ZP)(i,(o=>Cr(this,void 0,void 0,(function*(){yield Ar(e,t,n,r,a,o);for(const e of o)e.step=zr(e.step);return k(o)})))),[]);return Object.assign(Object.assign({},l),{dependencyMap:C(l.grammar),hovered:void 0})}))}function zr(e){if(null==e.children)return e;for(let t=e.children.length-1;t>=0;t--)Tr(e,t)||(e.children[t]=zr(e.children[t]));return function(e){if("if"===e.type&&"this"===e.children[1].type&&"this"===e.children[2].type)return{type:"this"};if(("parallel"===e.type||"sequential"===e.type)&&1===e.children.length)return e.children[0];return e}(e)}function Tr(e,t){const n=e.children[t];if(null==n)return!1;switch(e.type){case"sequential":if("this"!==n.type||1===e.children.length)return!1;break;case"parallel":if("null"!==n.type||1===e.children.length)return!1;break;case"random":if("null"!==n.type)return!1;e.probabilities.splice(t,1);break;case"switch":if(0===t)return!1;if("null"!==n.type)return!1;e.cases.splice(t-1,1);break;default:return!1}return e.children.splice(t,1),!0}const Lr=[{type:"add"},{type:"and"},{type:"divide"},{type:"equal"},{type:"getVariable"},{type:"greater"},{type:"greaterEqual"},{type:"if"},{type:"invert"},{type:"modulo"},{type:"multiply"},{type:"not"},{type:"or"},{type:"parallel"},{type:"random"},{type:"raw"},{type:"return"},{type:"sequential"},{type:"setVariable"},{type:"smaller"},{type:"smallerEqual"},{type:"subtract"},{type:"switch"},{type:"this"},{type:"unequal"},{type:"null"}];const Dr={index:{execute:e=>{var t;const n=e.raw.length>0?(e.raw[0]+e.index.length)%e.index.length:e.index.length-1,r=null!==(t=e.index[n])&&void 0!==t?t:0;return(0,ot.of)([Object.assign(Object.assign({},e),{raw:r})])},includeThis:!1,defaultParameters:[]},id:{execute:e=>(0,ot.of)([Object.assign(Object.assign({},e),{raw:e.index.join(",")})]),includeThis:!1,defaultParameters:[]},log:{execute:e=>(console.log(e.raw[1]),(0,ot.of)([Object.assign(Object.assign({},e),{raw:e.raw[0]})])),includeThis:!0,defaultParameters:[]},select:{execute:e=>{var t;const n=e.raw.length>0?(e.raw[0]+e.index.length)%e.index.length:e.index.length-1,r=null!==(t=e.index[n])&&void 0!==t?t:0,[o,i,a]=e.raw;return(0,ot.of)(i<=r&&(null==a||r<a)?[Object.assign(Object.assign({},e),{raw:o})]:[])},includeThis:!0,defaultParameters:[()=>({type:"raw",value:1}),()=>({type:"raw",value:2})]},randomFloat:{execute:_t(((e,t)=>(0,ot.of)([e+(t-e)*Math.random()]))),includeThis:!1,defaultParameters:[()=>({type:"raw",value:0}),()=>({type:"raw",value:1})]}};var Ir=n(8569),Br=n(1771);class qr extends o.ExtrudeGeometry{constructor(e,t,n){super(new o.Shape([new o.Vector2(0,0),new o.Vector2(e/2,t),new o.Vector2(e,0)]),{depth:n,bevelEnabled:!1})}}const Gr=new o.Box3,Rr=new o.Vector3;o.Cache.enabled=!0;const Zr=new Ir.E,Qr=new Br._;Qr.setDecoderPath("/cgv/"),Zr.setDRACOLoader(Qr);const $r=new o.Vector3;const Xr=new o.Vector3,Fr=new o.Box3;function Yr(e){return Math.PI*e/180}function Ur(e,...t){const n=t.reduce(((t,n)=>[...t,...n.components(e)]),[]);return(0,ot.of)(n)}const Wr=Object.assign(Object.assign({},Dr),{translate:{execute:_t((function(e,t,n,r){return(0,ot.of)([e.multiplyMatrix(s(t,n,r))])})),includeThis:!0,defaultParameters:[()=>({type:"raw",value:0}),()=>({type:"raw",value:0}),()=>({type:"raw",value:0})]},scale:{execute:_t((function(e,t,n,r){return(0,ot.of)([e.multiplyMatrix(u(t,n,r))])})),includeThis:!0,defaultParameters:[()=>({type:"raw",value:1}),()=>({type:"raw",value:1}),()=>({type:"raw",value:1})]},rotate:{execute:_t((function(e,t,n,r){return(0,ot.of)([e.multiplyMatrix(c(Yr(t),Yr(n),Yr(r)))])})),includeThis:!0,defaultParameters:[()=>({type:"raw",value:0}),()=>({type:"raw",value:0}),()=>({type:"raw",value:0})]},extrude:{execute:_t((function(e,t){return(0,ot.of)([e.extrude(t)])})),includeThis:!0,defaultParameters:[()=>({type:"raw",value:1})]},split:{execute:_t((function(e,t,n,...r){if(0===r.length)return(0,ot.of)([e]);const o=function(e,t,n){e.getBoundingBox(oe),ie.copy(oe.min);let r=0;const o=[];for(;ee(oe.min,t)<ee(oe.max,t);){const i=e.matrix.clone();i.multiply(s(oe.min.x,oe.min.y,oe.min.z));const a=n(i,r,oe.max.x-oe.min.x,oe.max.y-oe.min.y,oe.max.z-oe.min.z);o.push(a),a.getBoundingBox(ae),ae.getSize(re),r++,te(oe.min,t,ee(oe.min,t)+ee(re,t))}return o}(e,t,((o,i,a,l,s)=>{const c=Math.floor(i/r.length),u=r[i%r.length];if(!1===n&&0==c||!0===n||c<n){const n="x"===t?Math.min(u,a):a,r="z"===t?Math.min(u,s):s;return Te.fromLengthAndHeight(o,n,r,de,e.materialGenerator)}return Te.fromLengthAndHeight(o,a,s,de,e.materialGenerator)}));return(0,ot.of)(o)})),includeThis:!0,defaultParameters:[()=>({type:"raw",value:"x"}),()=>({type:"raw",value:!0}),()=>({type:"raw",value:1})]},toPoints:{execute:_t(Ur.bind(null,"points")),includeThis:!0,defaultParameters:[]},toLines:{execute:_t(Ur.bind(null,"lines")),includeThis:!0,defaultParameters:[]},toFaces:{execute:_t(Ur.bind(null,"faces")),includeThis:!0,defaultParameters:[]},sample:{execute:_t((function(e,t){return(0,ot.of)(e.samplePoints(t))})),includeThis:!0,defaultParameters:[()=>({type:"raw",value:10})]},color:{execute:_t((function(e,t){return(0,ot.of)([e.changeMaterialGenerator(Se(t))])})),includeThis:!0,defaultParameters:[()=>({type:"raw",value:"#ff0000"})]},size:{execute:_t((function(e,t){return e.getBoundingBox(Fr),Fr.getSize(Xr),(0,ot.of)([Xr[t]])})),includeThis:!0,defaultParameters:[()=>({type:"raw",value:"x"})]},expandGraph:{execute:_t((function(e,t,...n){return(0,ot.of)(ce(function(e,t,n){const r=n*n,o=[],i=[];for(const[a,l]of e){const e=se(o,a,r),t=se(o,l,r);le(i,e,t),le(i,t,e)}for(let a=0;a<i.length;a++){const e=i[a],n=e.slice(1).map((n=>({index:n,angle:je(o[a],o[e[0]],o[n],t)}))).sort(((e,t)=>e.angle-t.angle));i[a]=[e[0],...n.map((({index:e})=>e))]}return{connectionsList:i,points:o}}(n.map((e=>[e.getStart(),e.getEnd()])),me,t),t,0,me,e.materialGenerator))})),includeThis:!0,defaultParameters:[()=>({type:"raw",value:3})]},load:{execute:_t((function(e,t){return(0,it.D)(Zr.loadAsync(t)).pipe((0,at.U)((t=>[new qe(e.matrix,t.scene)])))})),includeThis:!0,defaultParameters:[]},point3:{execute:_t((function(e,t,n,r){const i=Se(new o.Color(16711680));return(0,ot.of)([new ke(s(t,n,r,e.matrix.clone()),i)])})),includeThis:!0,defaultParameters:[()=>({type:"raw",value:0}),()=>({type:"raw",value:0}),()=>({type:"raw",value:0})]},point2:{execute:_t((function(e,t,n){const r=Se(new o.Color(16711680));return(0,ot.of)([new ke(s(t,0,n,e.matrix.clone()),r)])})),includeThis:!0,defaultParameters:[()=>({type:"raw",value:0}),()=>({type:"raw",value:0})]},line:{execute:_t((function(e,...t){if(t.length<2)return(0,ot.of)([e]);const[n,r]=t.map((e=>(new o.Vector3).setFromMatrixPosition(e.matrix))),i=Se(new o.Color(16711680));return(0,ot.of)([Ce.fromPoints(e.matrix.clone(),n,r,i)])})),includeThis:!0,defaultParameters:[()=>({type:"operation",identifier:"point3",children:[{type:"raw",value:0},{type:"raw",value:0},{type:"raw",value:0}]}),()=>({type:"operation",identifier:"point3",children:[{type:"raw",value:1},{type:"raw",value:0},{type:"raw",value:0}]})]},face:{execute:_t((function(e,...t){if(t.length<3)return(0,ot.of)([e]);const n=t.map((e=>($r.setFromMatrixPosition(e.matrix),new o.Vector2($r.x,$r.z))));o.ShapeUtils.isClockWise(n)&&n.reverse();const r=Se(new o.Color(16711680));return(0,ot.of)([new Te(e.matrix,new o.Shape(n),r)])})),includeThis:!0,defaultParameters:[]},gableRoof:{execute:_t((function(e,t,n,r,o){const i=null==t?0:Math.PI*t/180,a=c(0,-i,0);Gr.setFromPoints(e.getVertecies().map((e=>e.applyMatrix4(a)))),Gr.getSize(Rr);const l=new qr(null!==n&&void 0!==n?n:Rr.x,null!==r&&void 0!==r?r:Rr.y,null!==o&&void 0!==o?o:Rr.z);return l.translate(Gr.min.x,Gr.min.y,Gr.min.z),l.computeBoundingBox(),l.rotateY(i),(0,ot.of)([new Re(e.matrix,l,e.materialGenerator)])})),includeThis:!0,defaultParameters:[()=>({type:"raw",value:0})]},direction:{execute:_t((function(e){return(0,ot.of)([ne(e.matrix)])})),includeThis:!0,defaultParameters:[]}});function Hr(e,t,n,r){const o=new Map;return e.pipe(Yt()).subscribe({next:e=>{const r=e.index.join(",");if(e.type===Pt.SET){const i=n(e.value);t.add(i),o.set(r,i)}else{const e=o.get(r);null!=e&&(o.delete(r),t.remove(e))}},error:e=>{r(e)}})}const _r=e=>ne(e.raw.matrix),Kr=[Un,Hn,rr,nr,{generateMatching:(e,t)=>sr((e=>`where direction is one of ${e.join(", ")}`),e,t,_r,(e=>({type:"equal",children:[{type:"operation",children:[],identifier:"direction"},{type:"raw",value:_r(e)}]})),(e=>lr(0,t,e))),generateContaining:(e,t)=>sr((e=>`where direction is one of ${e.join(", ")}`),e,t,_r,(e=>({type:"equal",children:[{type:"operation",children:[],identifier:"direction"},{type:"raw",value:_r(e)}]})))},ir,Kn];var Jr=n(9008),eo=n(7294),to=n(4051),no=n.n(to),ro=n(4671),oo=n(8597);function io(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function ao(e,t,n,r,o,i,a){try{var l=e[i](a),s=l.value}catch(c){return void n(c)}l.done?t(s):Promise.resolve(s).then(r,o)}function lo(e){return function(){var t=this,n=arguments;return new Promise((function(r,o){var i=e.apply(t,n);function a(e){ao(i,r,o,a,l,"next",e)}function l(e){ao(i,r,o,a,l,"throw",e)}a(void 0)}))}}function so(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function co(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){so(e,t,n[t])}))}return e}function uo(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i=[],a=!0,l=!1;try{for(n=n.call(e);!(a=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);a=!0);}catch(s){l=!0,o=s}finally{try{a||null==n.return||n.return()}finally{if(l)throw o}}return i}}(e,t)||fo(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function po(e){return function(e){if(Array.isArray(e))return io(e)}(e)||function(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||fo(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function fo(e,t){if(e){if("string"===typeof e)return io(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?io(e,t):void 0}}function mo(e,t){return(0,ro.Z)((0,oo.XR)((0,oo.$e)({type:"gui",valueMap:{},selectionsList:[],hovered:void 0,grammar:[],dependencyMap:{},descriptions:[],selectedDescriptions:[],interpretationDelay:0,requested:void 0,shift:!1,showTui:!1,graphVisualization:!1},yo.bind(null,e,t))))}var ho=new ke(new o.Matrix4,Se(new o.Color(16711680)));function yo(e,t,n,r){var o=function(e,t,o){"gui"==r().type&&n({requested:{type:e,data:o,fulfill:function(e){var o=r().requested;t&&t(e);var i=r();"gui"===i.type&&i.requested===o&&n({requested:void 0})}}})},i=function(e){return function(t){return new Promise((function(n){return o("select-condition",n,{patterns:t,title:e})}))}};return{import:function(e){try{var t=k(ft(e)),r=new Set,o=!0,i=!1,a=void 0;try{for(var l,s=t[Symbol.iterator]();!(o=(l=s.next()).done);o=!0){var c=Q(l.value.name);r.add(c)}}catch(u){i=!0,a=u}finally{try{o||null==s.return||s.return()}finally{if(i)throw a}}n({descriptions:Array.from(r).map((function(e){return{name:e,seed:0}})),grammar:t,selectedDescriptions:[],selectionsList:[],valueMap:{},dependencyMap:C(t),hovered:void 0,requested:void 0,type:"gui"})}catch(p){console.error(p)}},download:function(){var e=r(),t=Ot("gui"===e.type?e.grammar.map((({name:e,step:t})=>({name:e,step:N(t)}))):e.grammar,void 0,wt),n=document.createElement("a");n.href=window.URL.createObjectURL(new Blob([t],{type:"text/plain"})),n.download="descriptions.cgv",n.click()},setShowTui:function(e){n({showTui:e})},selectDescription:function(e,t){var o=r();if("gui"===o.type){var i,a,l=null===(i=o.grammar.find((function(t){return T(e,t.name)})))||void 0===i?void 0:i.name;if(!t){if(1===o.selectedDescriptions.length&&o.selectedDescriptions[0]===e)return;var s=Object.entries(o.valueMap);return void n({selectedDescriptions:[e],selectionsList:null==l?[]:[{steps:l,values:s.filter((function(e){return uo(e,1)[0]==l})).reduce((function(e,t){var n=uo(t,2)[1];return null!=n?e.concat(n):e}),[])}]})}if(!o.selectedDescriptions.includes(e))return void n({selectedDescriptions:po(o.selectedDescriptions).concat([e]),selectionsList:null==l?o.selectionsList:po(o.selectionsList).concat([{steps:l,values:[]}])});n({selectedDescriptions:o.selectedDescriptions.filter((function(t){return e!==t})),selectionsList:o.selectionsList.filter((function(t){var n=t.steps;return!T(e,pr(n)[0])})),hovered:null!=(null===(a=o.hovered)||void 0===a?void 0:a.steps)&&T(e,pr(o.hovered.steps)[0])?void 0:o.hovered})}else 1===o.selectedDescriptions.length&&o.selectedDescriptions[0]===e||n({selectedDescriptions:[e],text:Ot(z(o.grammar,void 0,e),$.bind(null,e),wt)})},clearValueMap:function(e){var t=r();"gui"===t.type&&n({valueMap:Object.entries(t.valueMap).filter((function(t){return!uo(t,1)[0].includes("@"+e)})).reduce((function(e,t){var n=uo(t,2);return co({},e,so({},n[0],n[1]))}),{})})},pasteNoun:function(){var e=lo(no().mark((function e(o,a,l){var s,c,u,p,f;return no().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("gui"===(s=r()).type&&null!=s.selectedDescriptions){e.next=3;break}return e.abrupt("return");case 3:return c=Q(l),u=D(l,c),p=Sr(s.grammar,u,c,o),f=ur(a),e.t0=n,e.next=10,Nr(s.valueMap,s.selectionsList.filter((function(e){return fr(e.steps,a,f)})),t,i("On what should this noun be copied to?"),(function(){return{type:"symbol",identifier:L(u,o)}}),s.grammar.concat(p));case 10:e.t1=e.sent,(0,e.t0)(e.t1);case 12:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),addDescriptions:function(e){var t=r(),o=t.descriptions,i=t.grammar,a=t.dependencyMap,l=!0,s=!1,c=void 0;try{for(var u,p=function(e,t){var n=t.value;if(-1!==o.findIndex((function(e){return e.name===n.name})))return"continue";var r,a=L("Start",n.name);-1===i.findIndex((function(e){return e.name===a}))&&(i=(0,S.vV)(k([{name:a,step:null!==(r=n.step)&&void 0!==r?r:{type:"this"}}]).concat(i)));o=[{name:n.name,seed:0}].concat(o)},f=e[Symbol.iterator]();!(l=(u=f.next()).done);l=!0)p(0,u)}catch(m){s=!0,c=m}finally{try{l||null==f.return||f.return()}finally{if(s)throw c}}a=C(i),n({descriptions:o,grammar:i,dependencyMap:a})},deleteDescription:function(e){var t=r(),o=t.descriptions,i=t.selectedDescriptions,a=t.grammar,l=t.selectionsList,s=o.filter((function(t){return t.name!=e}));n(co({descriptions:s,selectedDescriptions:i.filter((function(t){return t!==e}))},wr(a,null!==l&&void 0!==l?l:[],s.map((function(e){return e.name})))))},concretizeDescription:function(){var t=lo(no().mark((function t(o,i){var a,l,s,c,u,p,f;return no().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if("gui"===(l=r()).type){t.next=4;break}return t.abrupt("return");case 4:if(null!=(s=null===(a=l.grammar.find((function(e){return T(o,e.name)})))||void 0===a?void 0:a.name)){t.next=7;break}return t.abrupt("return");case 7:return c=F(s,l.grammar,l.dependencyMap),t.next=10,In(ho,c,e,{seed:i});case 10:u=t.sent,p=k((0,S.vV)(po(u).concat(po(l.grammar.filter((function(e){return!c.includes(e)})))))),n(co({},wr(p,null!==(f=l.selectionsList)&&void 0!==f?f:[],l.descriptions.map((function(e){return e.name}))),{dependencyMap:C(p)}));case 14:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}(),setSeed:function(e,t){n({descriptions:r().descriptions.map((function(n){return n.name===e?{name:n.name,seed:t}:n}))})},setText:function(e){var t,o,i,a=r();if("tui"==a.type&&1==a.selectedDescriptions.length)try{var l=function(e,t){const n=ft(e);return R(n,t)}(e,a.selectedDescriptions[0]);n({text:e,correct:!0,grammar:(t=a.grammar,o=l,i=a.selectedDescriptions[0],(0,S.vV)(t.filter((e=>!T(i,e.name))).concat(o)))})}catch(s){n({text:e,correct:!1,error:s.message})}},setGraphVisualization:function(e){"gui"===r().type&&n({graphVisualization:e})},setType:function(e){var t=r();if(t.type!==e){var o=k(t.grammar);"tui"===t.type&&t.correct?n({type:"gui",grammar:o,dependencyMap:C(o),valueMap:{},selectionsList:[],hovered:void 0,requested:void 0,shift:!1}):1==t.selectedDescriptions.length&&n({type:"tui",grammar:t.grammar,text:null==t.selectedDescriptions?"":Ot(z(t.grammar,void 0,t.selectedDescriptions[0]),$.bind(null,t.selectedDescriptions[0]),wt),correct:!0})}},onStartHover:function(e,t){var o,i=r();"gui"==i.type&&(t=null!==(o=null!==t&&void 0!==t?t:i.valueMap[ur(e)])&&void 0!==o?o:[],n({hovered:{steps:e,values:t}}))},onEndHover:function(e){var t,o=r();"gui"==o.type&&(null===(t=o.hovered)||void 0===t?void 0:t.steps)==e&&n(co({},o,{hovered:void 0}))},editIndices:function(e,t){var o=r();"gui"==o.type&&n(function(e,t,n,r,o){return(0,S.ZP)({hovered:n,valueMap:e,selectionsList:t},(e=>{for(const{value:i,steps:a}of r){const{valueMap:r,selectionsList:l,hovered:s}=e,c=a.path.join(","),u=t.findIndex((e=>ur(e.steps)===c)),p=l[u];let f=r[c];if(!o){if(null==f)return;const t=f.findIndex((e=>U(e.after.index,i.after.index)===Y.Equal));if(f.splice(t,1),null!=p){const e=p.values.findIndex((e=>U(e.after.index,i.after.index)===Y.Equal));p.values.splice(e,1),0===p.values.length&&l.splice(u,1)}if((null===n||void 0===n?void 0:n.steps)===a&&null!=s){const t=s.values.findIndex((e=>U(e.after.index,i.after.index)===Y.Equal));s.values.splice(t,1),0===s.values.length&&(e.hovered=void 0)}}null==f&&(f=[],r[c]=f),null!=p&&f.length===p.values.length&&p.values.push(i),f.push(i)}}))}(o.valueMap,o.selectionsList,o.hovered,e,t))},autoSelectPattern:function(){var e=lo(no().mark((function e(o){var a;return no().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("gui"==(a=r()).type){e.next=3;break}return e.abrupt("return");case 3:return e.t0=n,e.next=6,hr(a.selectionsList,a.valueMap,o,t,i("What should be selected?"));case 6:e.t1=e.sent,e.t2={selectionsList:e.t1},(0,e.t0)(e.t2);case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),select:function(e,t,o){var i=r();"gui"==i.type&&(o=null!==o&&void 0!==o?o:i.shift?"add":"replace",n({selectionsList:vr(i.valueMap,i.selectionsList,[{steps:e,values:null==t?void 0:[t]}],o)}))},selectResult:function(e,t){var o=r();"gui"==o.type&&n({selectionsList:vr(o.valueMap,o.selectionsList,[{steps:e,values:[t]}],o.shift?"toggle":"replace")})},selectChildren:function(e,t,o){var i=r();"gui"==i.type&&n({selectionsList:vr(i.valueMap,vr(i.valueMap,i.selectionsList,[{steps:e,values:t}],"remove"),mr(i.valueMap,[o],t,(function(e,t){var n=U(t.before.index,e.before.index);return n===Y.Successor||n===Y.Equal}),void 0),"add")})},selectRelated:function(e,t){var o=r();"gui"==o.type&&n({selectionsList:vr(o.valueMap,vr(o.valueMap,o.selectionsList,[e],"remove"),[t],"add")})},unselectAll:function(){"gui"==r().type&&n({selectionsList:[]})},escape:function(){var e=r();"gui"==e.type&&(null==e.requested?n({selectionsList:[]}):n({requested:void 0}))},request:o,cancelRequest:function(){"gui"==r().type&&n({requested:void 0})},insert:function(){var e=lo(no().mark((function e(o,a,l){var s,c,u,p,f=arguments;return no().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s=f.length>3&&void 0!==f[3]&&f[3],"gui"==(c=r()).type){e.next=4;break}return e.abrupt("return");case 4:return u=c.grammar,null!=l&&(u=c.selectedDescriptions.reduce((function(e,t){var n=l(t);return null==n?e:e.concat(n)}),u)),e.next=8,br(c.valueMap,c.selectionsList,t,i("On what should this transformation be applied?"),o,a,u);case 8:p=e.sent,s&&(p=co({descriptions:c.descriptions.map((function(e){return c.selectedDescriptions.includes(e.name)?{name:e.name,seed:Math.random()*Number.MAX_SAFE_INTEGER}:e}))},p)),n(p);case 11:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),removeStep:lo(no().mark((function o(){var a;return no().wrap((function(o){for(;;)switch(o.prev=o.next){case 0:if("gui"==(a=r()).type){o.next=3;break}return o.abrupt("return");case 3:return o.t0=n,o.next=6,Vr(a.valueMap,a.selectionsList,t,i("From what should this transformation be removed?"),e,a.grammar);case 6:o.t1=o.sent,(0,o.t0)(o.t1);case 8:case"end":return o.stop()}}),o)}))),renameNoun:function(){var e=lo(no().mark((function e(o){var a;return no().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("gui"==(a=r()).type){e.next=3;break}return e.abrupt("return");case 3:return e.t0=n,e.next=6,Or(a.valueMap,a.selectionsList,t,i("What should be renamed?"),o,a.grammar);case 6:e.t1=e.sent,(0,e.t0)(e.t1);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),setName:function(){var e=lo(no().mark((function e(o){var a,l;return no().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("gui"==(a=r()).type&&1===a.selectedDescriptions.length){e.next=3;break}return e.abrupt("return");case 3:return e.t0=n,e.next=7,jr(a.valueMap,a.selectionsList,t,i("What should be named?"),null!==(l=X(a.selectedDescriptions[0],o))&&void 0!==l?l:o,a.grammar);case 7:e.t1=e.sent,(0,e.t0)(e.t1);case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),replace:function(){var e=lo(no().mark((function e(o,a,l){var s,c,u,p,f,m=arguments;return no().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s=m.length>3&&void 0!==m[3]&&m[3],c=null!=a?ur(a):void 0,"gui"==(u=r()).type){e.next=5;break}return e.abrupt("return");case 5:return p=u.grammar,null!=l&&(p=u.selectedDescriptions.reduce((function(e,t){var n=l(t);return null==n?e:e.concat(n)}),p)),e.next=9,Nr(u.valueMap,null==a?u.selectionsList:u.selectionsList.filter((function(e){return fr(e.steps,a,c)})),t,i("For what should the new transformation replace the current?"),o,p);case 9:f=e.sent,s&&(f=co({descriptions:u.descriptions.map((function(e){return u.selectedDescriptions.includes(e.name)?{name:e.name,seed:Math.random()*Number.MAX_SAFE_INTEGER}:e}))},f)),n(f);case 12:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),setShift:function(e){"gui"==r().type&&n({shift:e})},setInterpretationDelay:function(e){n({interpretationDelay:e})}}}var vo=n(3359),go=n(7088),bo=n(896),xo=n(6493),wo=n(6135);function jo(){return(0,r.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",className:"bi bi-exclamation-octagon",viewBox:"0 0 16 16",children:[(0,r.jsx)("path",{d:"M4.54.146A.5.5 0 0 1 4.893 0h6.214a.5.5 0 0 1 .353.146l4.394 4.394a.5.5 0 0 1 .146.353v6.214a.5.5 0 0 1-.146.353l-4.394 4.394a.5.5 0 0 1-.353.146H4.893a.5.5 0 0 1-.353-.146L.146 11.46A.5.5 0 0 1 0 11.107V4.893a.5.5 0 0 1 .146-.353L4.54.146zM5.1 1 1 5.1v5.8L5.1 15h5.8l4.1-4.1V5.1L10.9 1H5.1z"}),(0,r.jsx)("path",{d:"M7.002 11a1 1 0 1 1 2 0 1 1 0 0 1-2 0zM7.1 4.995a.905.905 0 1 1 1.8 0l-.35 3.507a.552.552 0 0 1-1.1 0L7.1 4.995z"})]})}function So(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Oo(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}function Mo(e){var t=e.align,n=e.message,o=e.className,i=Oo(e,["align","message","className"]),a=(0,eo.useState)(!1),l=a[0],s=a[1];return(0,r.jsxs)("div",function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){So(e,t,n[t])}))}return e}({},i,{className:"".concat(o," d-flex flex-column ").concat("left"===t?"align-items-start":"align-items-end"),children:[l&&(0,r.jsx)("div",{style:{overflowY:"auto",fontSize:"0.8rem",overflowX:"hidden",maxWidth:"20rem",maxHeight:"8rem",whiteSpace:"pre-line",bottom:24},className:"rounded position-absolute mb-2 p-2 bg-danger text-light",children:n}),(0,r.jsx)("div",{onClick:function(){return s((function(e){return!e}))},className:"btn btn-sm btn-danger d-flex align-items-center",children:(0,r.jsx)(jo,{})})]}))}function Po(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var Eo=(0,eo.createContext)(null),No=function(){return(0,eo.useContext)(Eo)};function Ao(){return(0,eo.useContext)(Eo).store}function ko(e,t){return Ao()(e,t)}function Co(e){var t=e.children,n=Po(e,["children"]);return(0,r.jsx)(Eo.Provider,{value:n,children:t})}function Vo(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var zo=JSON.parse('[{"position":[-73.991293,0.2,40.7603894],"rotationOffset":152,"url":"/cgv/panoramas/ny/panorama-@40.7603894,-73.991293,152.png"},{"position":[-73.9911163,0.2,40.7605103],"rotationOffset":-115,"url":"/cgv/panoramas/ny/panorama-@40.7605103,-73.9911163,-115.png"},{"position":[-73.9917221,0.2,40.7605683],"rotationOffset":152,"url":"/cgv/panoramas/ny/panorama-@40.7605683,-73.9917221,152.png"},{"position":[-73.9921399,0.2,40.7607437],"rotationOffset":151,"url":"/cgv/panoramas/ny/panorama-@40.7607437,-73.9921399,151.png"},{"position":[-73.9909371,0.2,40.7607584],"rotationOffset":-117,"url":"/cgv/panoramas/ny/panorama-@40.7607584,-73.9909371,-117.png"},{"position":[-73.9924488,0.2,40.7608757],"rotationOffset":151,"url":"/cgv/panoramas/ny/panorama-@40.7608757,-73.9924488,151.png"},{"position":[-73.9928593,0.2,40.7610493],"rotationOffset":151,"url":"/cgv/panoramas/ny/panorama-@40.7610493,-73.9928593,151,152.png"},{"position":[-73.9913927,0.2,40.7612502],"rotationOffset":-35,"url":"/cgv/panoramas/ny/panorama-@40.7612502,-73.9913927,-35,-31.png"},{"position":[-73.9933606,0.2,40.7612609],"rotationOffset":147,"url":"/cgv/panoramas/ny/panorama-@40.7612609,-73.9933606,147.png"},{"position":[-73.9938411,0.2,40.7614897],"rotationOffset":154,"url":"/cgv/panoramas/ny/panorama-@40.7614897,-73.9938411,154.png"},{"position":[-73.9920941,0.2,40.7615683],"rotationOffset":-26,"url":"/cgv/panoramas/ny/panorama-@40.7615683,-73.9920941,-26.png"},{"position":[-73.9925237,0.2,40.7617265],"rotationOffset":-26,"url":"/cgv/panoramas/ny/panorama-@40.7617265,-73.9925237,-26,-30.png"},{"position":[-73.9929245,0.2,40.7619153],"rotationOffset":-23,"url":"/cgv/panoramas/ny/panorama-@40.7619153,-73.9929245,-23.png"},{"position":[-73.9937505,0.2,40.7619205],"rotationOffset":79,"url":"/cgv/panoramas/ny/panorama-@40.7619205,-73.9937505,79,58.png"},{"position":[-73.9933428,0.2,40.7620772],"rotationOffset":-25,"url":"/cgv/panoramas/ny/panorama-@40.7620772,-73.9933428,-25,-28.png"},{"position":[-73.9894495,0.2,40.7628862],"rotationOffset":153,"url":"/cgv/panoramas/ny/panorama-@40.7628862,-73.9894495,153.png"},{"position":[-73.989556,0.2,40.7629306],"rotationOffset":152,"url":"/cgv/panoramas/ny/panorama-@40.7629306,-73.989556,152.png"},{"position":[-73.98966,0.2,40.7629745],"rotationOffset":152,"url":"/cgv/panoramas/ny/panorama-@40.7629745,-73.98966,152.png"},{"position":[-73.9897629,0.2,40.7630177],"rotationOffset":152,"url":"/cgv/panoramas/ny/panorama-@40.7630177,-73.9897629,152.png"},{"position":[-73.9898661,0.2,40.7630604],"rotationOffset":152,"url":"/cgv/panoramas/ny/panorama-@40.7630604,-73.9898661,152.png"},{"position":[-73.9899691,0.2,40.7631037],"rotationOffset":152,"url":"/cgv/panoramas/ny/panorama-@40.7631037,-73.9899691,152.png"},{"position":[-73.9900702,0.2,40.7631467],"rotationOffset":151,"url":"/cgv/panoramas/ny/panorama-@40.7631467,-73.9900702,151.png"},{"position":[-73.9901697,0.2,40.7631887],"rotationOffset":152,"url":"/cgv/panoramas/ny/panorama-@40.7631887,-73.9901697,152.png"},{"position":[-73.9902683,0.2,40.7632302],"rotationOffset":152,"url":"/cgv/panoramas/ny/panorama-@40.7632302,-73.9902683,152.png"},{"position":[-73.9903677,0.2,40.7632717],"rotationOffset":152,"url":"/cgv/panoramas/ny/panorama-@40.7632717,-73.9903677,152.png"},{"position":[-73.9905082,0.2,40.7633307],"rotationOffset":151,"url":"/cgv/panoramas/ny/panorama-@40.7633307,-73.9905082,151.png"},{"position":[-73.9906086,0.2,40.763374],"rotationOffset":151,"url":"/cgv/panoramas/ny/panorama-@40.763374,-73.9906086,151.png"},{"position":[-73.9907119,0.2,40.7634208],"rotationOffset":151,"url":"/cgv/panoramas/ny/panorama-@40.7634208,-73.9907119,151.png"},{"position":[-73.9908192,0.2,40.7634687],"rotationOffset":151,"url":"/cgv/panoramas/ny/panorama-@40.7634687,-73.9908192,151.png"},{"position":[-73.9909259,0.2,40.7635125],"rotationOffset":151,"url":"/cgv/panoramas/ny/panorama-@40.7635125,-73.9909259,151.png"},{"position":[-73.9910314,0.2,40.7635554],"rotationOffset":152,"url":"/cgv/panoramas/ny/panorama-@40.7635554,-73.9910314,152.png"},{"position":[-73.9911354,0.2,40.7635973],"rotationOffset":152,"url":"/cgv/panoramas/ny/panorama-@40.7635973,-73.9911354,152.png"},{"position":[-73.9912372,0.2,40.7636388],"rotationOffset":152,"url":"/cgv/panoramas/ny/panorama-@40.7636388,-73.9912372,152.png"},{"position":[-73.9913394,0.2,40.7636803],"rotationOffset":152,"url":"/cgv/panoramas/ny/panorama-@40.7636803,-73.9913394,152.png"},{"position":[-73.9914375,0.2,40.7637211],"rotationOffset":152,"url":"/cgv/panoramas/ny/panorama-@40.7637211,-73.9914375,152.png"},{"position":[-73.9915457,0.2,40.763767],"rotationOffset":152,"url":"/cgv/panoramas/ny/panorama-@40.763767,-73.9915457,152.png"},{"position":[-73.9916401,0.2,40.7638439],"rotationOffset":143,"url":"/cgv/panoramas/ny/panorama-@40.7638439,-73.9916401,143.png"},{"position":[-73.9917486,0.2,40.7638941],"rotationOffset":153,"url":"/cgv/panoramas/ny/panorama-@40.7638941,-73.9917486,153.png"},{"position":[-73.9918524,0.2,40.7639381],"rotationOffset":153,"url":"/cgv/panoramas/ny/panorama-@40.7639381,-73.9918524,153.png"},{"position":[-73.9919505,0.2,40.7639785],"rotationOffset":152,"url":"/cgv/panoramas/ny/panorama-@40.7639785,-73.9919505,152.png"},{"position":[-73.9920937,0.2,40.7640343],"rotationOffset":149,"url":"/cgv/panoramas/ny/panorama-@40.7640343,-73.9920937,149.png"},{"position":[-73.9922023,0.2,40.7640409],"rotationOffset":153,"url":"/cgv/panoramas/ny/panorama-@40.7640409,-73.9922023,153.png"},{"position":[8.6623931,0.2,50.1146702],"rotationOffset":-182,"url":"/cgv/panoramas/fm/panorama-@50.1146702,8.6623931,-182.png"},{"position":[8.6625474,0.2,50.1146801],"rotationOffset":-154,"url":"/cgv/panoramas/fm/panorama-@50.1146801,8.6625474,-154.png"},{"position":[8.6622397,0.2,50.1146802],"rotationOffset":-184,"url":"/cgv/panoramas/fm/panorama-@50.1146802,8.6622397,-184.png"},{"position":[8.6621095,0.2,50.1146872],"rotationOffset":-185,"url":"/cgv/panoramas/fm/panorama-@50.1146872,8.6621095,-185.png"},{"position":[8.6619715,0.2,50.1146951],"rotationOffset":-188,"url":"/cgv/panoramas/fm/panorama-@50.1146951,8.6619715,-188.png"},{"position":[8.6618412,0.2,50.1147036],"rotationOffset":174,"url":"/cgv/panoramas/fm/panorama-@50.1147036,8.6618412,174.png"},{"position":[8.6626901,0.2,50.1148191],"rotationOffset":-94,"url":"/cgv/panoramas/fm/panorama-@50.1148191,8.6626901,-94.png"},{"position":[8.6616697,0.2,50.114846],"rotationOffset":-97,"url":"/cgv/panoramas/fm/panorama-@50.114846,8.6616697,-97.png"},{"position":[8.662711,0.2,50.1149033],"rotationOffset":-97,"url":"/cgv/panoramas/fm/panorama-@50.1149033,8.662711,-97.png"},{"position":[8.6616896,0.2,50.1149293],"rotationOffset":-101,"url":"/cgv/panoramas/fm/panorama-@50.1149293,8.6616896,-101.png"},{"position":[8.6627286,0.2,50.1149732],"rotationOffset":-101,"url":"/cgv/panoramas/fm/panorama-@50.1149732,8.6627286,-101.png"},{"position":[8.6617209,0.2,50.1150402],"rotationOffset":-104,"url":"/cgv/panoramas/fm/panorama-@50.1150402,8.6617209,-104.png"},{"position":[8.6627538,0.2,50.1150518],"rotationOffset":-102,"url":"/cgv/panoramas/fm/panorama-@50.1150518,8.6627538,-102.png"},{"position":[8.6617453,0.2,50.1151227],"rotationOffset":-102,"url":"/cgv/panoramas/fm/panorama-@50.1151227,8.6617453,-102.png"},{"position":[8.6627812,0.2,50.1151545],"rotationOffset":-98,"url":"/cgv/panoramas/fm/panorama-@50.1151545,8.6627812,-98.png"},{"position":[8.6617704,0.2,50.1152061],"rotationOffset":-105,"url":"/cgv/panoramas/fm/panorama-@50.1152061,8.6617704,-105.png"},{"position":[8.6628064,0.2,50.1152442],"rotationOffset":-100,"url":"/cgv/panoramas/fm/panorama-@50.1152442,8.6628064,-100.png"},{"position":[8.6617932,0.2,50.1152884],"rotationOffset":-100,"url":"/cgv/panoramas/fm/panorama-@50.1152884,8.6617932,-100.png"},{"position":[8.6618155,0.2,50.115368],"rotationOffset":-97,"url":"/cgv/panoramas/fm/panorama-@50.115368,8.6618155,-97.png"},{"position":[8.662853,0.2,50.1154101],"rotationOffset":-99,"url":"/cgv/panoramas/fm/panorama-@50.1154101,8.662853,-99.png"},{"position":[8.661839,0.2,50.1154461],"rotationOffset":-97,"url":"/cgv/panoramas/fm/panorama-@50.1154461,8.661839,-97.png"},{"position":[8.6628751,0.2,50.1154918],"rotationOffset":-99,"url":"/cgv/panoramas/fm/panorama-@50.1154918,8.6628751,-99.png"},{"position":[8.6618617,0.2,50.1155217],"rotationOffset":-101,"url":"/cgv/panoramas/fm/panorama-@50.1155217,8.6618617,-101.png"},{"position":[8.6628988,0.2,50.1155784],"rotationOffset":-98,"url":"/cgv/panoramas/fm/panorama-@50.1155784,8.6628988,-98.png"},{"position":[8.6618911,0.2,50.1156269],"rotationOffset":-99,"url":"/cgv/panoramas/fm/panorama-@50.1156269,8.6618911,-99.png"},{"position":[8.6629243,0.2,50.115672],"rotationOffset":-100,"url":"/cgv/panoramas/fm/panorama-@50.115672,8.6629243,-100.png"},{"position":[8.6619182,0.2,50.1157194],"rotationOffset":-98,"url":"/cgv/panoramas/fm/panorama-@50.1157194,8.6619182,-98.png"},{"position":[8.6629498,0.2,50.1157581],"rotationOffset":257,"url":"/cgv/panoramas/fm/panorama-@50.1157581,8.6629498,257.png"},{"position":[8.6628525,0.2,50.1158494],"rotationOffset":-11,"url":"/cgv/panoramas/fm/panorama-@50.1158494,8.6628525,-11.png"},{"position":[8.6626738,0.2,50.1158712],"rotationOffset":-4,"url":"/cgv/panoramas/fm/panorama-@50.1158712,8.6626738,-4.png"},{"position":[8.6625303,0.2,50.1158865],"rotationOffset":-6,"url":"/cgv/panoramas/fm/panorama-@50.1158865,8.6625303,-6.png"},{"position":[8.662406,0.2,50.1159013],"rotationOffset":-8,"url":"/cgv/panoramas/fm/panorama-@50.1159013,8.662406,-8.png"},{"position":[8.6619545,0.2,50.1159062],"rotationOffset":-65,"url":"/cgv/panoramas/fm/panorama-@50.1159062,8.6619545,-65.png"},{"position":[8.6622687,0.2,50.1159175],"rotationOffset":-6,"url":"/cgv/panoramas/fm/panorama-@50.1159175,8.6622687,-6.png"},{"position":[8.6621347,0.2,50.1159323],"rotationOffset":-8,"url":"/cgv/panoramas/fm/panorama-@50.1159323,8.6621347,-8.png"},{"position":[8.6630039,0.2,50.1160285],"rotationOffset":-96,"url":"/cgv/panoramas/fm/panorama-@50.1160285,8.6630039,-96,-97.png"},{"position":[8.6631204,0.2,50.1163257],"rotationOffset":-100,"url":"/cgv/panoramas/fm/panorama-@50.1163257,8.6631204,-100,-98.png"},{"position":[8.6632372,0.2,50.1167265],"rotationOffset":-100,"url":"/cgv/panoramas/fm/panorama-@50.1167265,8.6632372,-100,-100.png"},{"position":[8.6586113,0.2,50.1169004],"rotationOffset":73,"url":"/cgv/panoramas/fm/panorama-@50.1169004,8.6586113,73,70.png"},{"position":[8.6633554,0.2,50.1171317],"rotationOffset":-100,"url":"/cgv/panoramas/fm/panorama-@50.1171317,8.6633554,-100,-101.png"},{"position":[8.6588044,0.2,50.1172581],"rotationOffset":71,"url":"/cgv/panoramas/fm/panorama-@50.1172581,8.6588044,71,71.png"},{"position":[8.663442,0.2,50.1174098],"rotationOffset":-100,"url":"/cgv/panoramas/fm/panorama-@50.1174098,8.663442,-100,-101.png"},{"position":[8.6590014,0.2,50.1176176],"rotationOffset":74,"url":"/cgv/panoramas/fm/panorama-@50.1176176,8.6590014,74,72.png"},{"position":[8.6600027,0.2,50.1176976],"rotationOffset":-186,"url":"/cgv/panoramas/fm/panorama-@50.1176976,8.6600027,-186,-189.png"},{"position":[8.6593229,0.2,50.1177469],"rotationOffset":-186,"url":"/cgv/panoramas/fm/panorama-@50.1177469,8.6593229,-186,-189.png"},{"position":[8.660359,0.2,50.1177635],"rotationOffset":261,"url":"/cgv/panoramas/fm/panorama-@50.1177635,8.660359,261,260.png"},{"position":[8.6604327,0.2,50.1180577],"rotationOffset":263,"url":"/cgv/panoramas/fm/panorama-@50.1180577,8.6604327,263,261.png"},{"position":[8.6605192,0.2,50.1184347],"rotationOffset":-97,"url":"/cgv/panoramas/fm/panorama-@50.1184347,8.6605192,-97,-96.png"}]').map((function(e){var t=Ye(e.position[0],0),n=Ue(e.position[2],0),r=We(0,0);return function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){Vo(e,t,n[t])}))}return e}({},e,{position:[t,e.position[1]/r,n]})})),To=n(712),Lo=n(5449);function Do(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Io(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var Bo=[{title:"721 9th Ave, New York, NY 10019",lat:40.7628862,lon:-73.9894495},{title:"Feuerbachstra\xdfe 25, 60325 Frankfurt am Main",lat:50.1157581,lon:8.6629498}];function qo(e){var t=e.className,n=Io(e,["className"]);return(0,r.jsxs)("div",function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){Do(e,t,n[t])}))}return e}({},n,{className:"".concat(t," bg-light border rounded shadow"),children:[(0,r.jsx)("div",{className:"py-2 px-3 border-bottom border-2",children:"Adresses"}),Bo.map((function(e){var t=e.title,n=e.lat,o=e.lon;return(0,r.jsx)("div",{style:{fontSize:"x-small"},className:"pointer border-top py-2 px-3",onClick:function(){return oi.getState().setLatLon(n,o)},children:t},t)}))]}))}function Go(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Ro(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i=[],a=!0,l=!1;try{for(n=n.call(e);!(a=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);a=!0);}catch(s){l=!0,o=s}finally{try{a||null==n.return||n.return()}finally{if(l)throw o}}return i}}(e,t)||Qo(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Zo(e){return function(e){if(Array.isArray(e))return Go(e)}(e)||function(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||Qo(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Qo(e,t){if(e){if("string"===typeof e)return Go(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Go(e,t):void 0}}var $o,Xo=new o.Euler(0,0,0,"YXZ"),Fo=[0,0,0],Yo=[($o=new o.Euler(-Math.PI/2,0,0)).x,$o.y,$o.z],Uo=We(0,0),Wo=.1/Uo,Ho=1/Uo,_o=10/Uo,Ko=40/Uo;function Jo(e){return Math.max(2*e,0)}function ei(e,t,n){return Math.min(Math.max(e,t),n)}var ti=new o.Vector3,ni=new o.Euler(void 0,void 0,void 0,"YXZ");function ri(e,t,n){var r,o,i=Ro(e,3),a=i[0],l=i[1],s=i[2];return(r=ti).set.apply(r,Zo(t)),(o=ni).set.apply(o,Zo(n)),ti.applyEuler(ni),ti.x+=a,ti.y+=l,ti.z+=s,ti.y=ei(ti.y,Wo,Ko),ti.toArray()}var oi=(0,ro.Z)((0,oo.XR)((0,oo.$e)({viewType:"satelite",position:[Ye(Bo[0].lon,0),_o,Ue(Bo[0].lat,0)],error:void 0,visualType:0,controlling:!1},(function(e,t){return{setControlling:function(t){return e({controlling:t})},setLatLon:function(t,n){e({viewType:"satelite",position:[Ye(n,0),_o,Ue(t,0)]})},drag:function(n,r){var o=t(),i=li(o)/180*Math.PI;if(o.viewType,"satelite"==o.viewType){var a=Ro(o.position,3),l=a[0],s=a[1],c=a[2],u=2*Math.tan(i/2)*o.position[1];e({position:[ei(l-n*u,0,1),s,ei(c-r*u,0,1)]})}else{var p;(p=Xo).set.apply(p,Zo(o.rotation)),Xo.x=ei(Xo.x+r*i,-Math.PI/2,Math.PI/2),Xo.y+=n*i,e({rotation:[Xo.x,Xo.y,Xo.z]})}},moveFlyCamera:function(n){var r=t();"fly"===r.viewType&&e({position:ri(r.position,n,r.rotation)})},pinch:function(n){var r=t();switch(r.viewType){case"satelite":var o=Ro(r.position,3),i=o[0],a=o[1],l=o[2];e({position:[i,ei(a/n,Ho,Ko),l]});break;case"panorama":var s=ei(r.fov/((2+n)/3),5,120);e({fov:s});break;case"fly":e({position:ri(r.position,[0,0,1e-6*(1-n)],r.rotation)})}},changeView:function(t){return e(t)},enterFlyCamera:function(){var n=t();if("fly"!==n.viewType){var r=ii(n),o=ai(n);e({viewType:"fly",position:r,rotation:o})}},backToSateliteView:function(){var n=t();if("satelite"!==n.viewType){var r=Ro(ii(n),3),o=r[0],i=r[1],a=r[2];e({viewType:"satelite",position:[o,ei(i,Ho,Ko),a]})}},changePanoramaView:function(n){var r=t(),o="satelite"===r.viewType?Fo:r.rotation,i="panorama"===r.viewType?r.fov:60;e({viewType:"panorama",panoramaIndex:n,rotation:o,fov:i})},setError:function(t){e({error:t})},setVisualType:function(t){e({visualType:t})}}}))));function ii(e){return"panorama"!==e.viewType?e.position:zo[e.panoramaIndex].position}function ai(e){return"satelite"===e.viewType?Yo:e.rotation}function li(e){return"panorama"===e.viewType?e.fov:60}function si(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function ci(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function ui(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}function pi(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i=[],a=!0,l=!1;try{for(n=n.call(e);!(a=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);a=!0);}catch(s){l=!0,o=s}finally{try{a||null==n.return||n.return()}finally{if(l)throw o}}return i}}(e,t)||function(e,t){if(!e)return;if("string"===typeof e)return si(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return si(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var fi=(0,Lo.animated)(To.c);function mi(){var e=oi.getState();return{position:ii(e),rotation:ai(e)}}function di(e){var t=e.children,n=ui(e,["children"]),o=pi((0,Lo.useSpring)(mi),1)[0],i=o.position,a=o.rotation,l=(0,eo.useRef)();return(0,eo.useEffect)((function(){var e=oi.subscribe((function(e){return ai(e)}),(function(e){return a.start(e)})),t=oi.subscribe((function(e){return ii(e)}),(function(e){return i.start(e)})),n=oi.subscribe((function(e){return li(e)}),(function(e){null!=l.current&&(l.current.fov=e,l.current.updateProjectionMatrix())}),{fireImmediately:!0});return function(){e(),t(),n()}}),[a,i]),(0,r.jsx)(fi,function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){ci(e,t,n[t])}))}return e}({},n,{ref:l,far:1e3,near:1e-9,position:i,"rotation-order":"YXZ",children:t,rotation:a,makeDefault:!0}))}var hi=n(6008),yi=n(9613);function vi(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function gi(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i=[],a=!0,l=!1;try{for(n=n.call(e);!(a=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);a=!0);}catch(s){l=!0,o=s}finally{try{a||null==n.return||n.return()}finally{if(l)throw o}}return i}}(e,t)||function(e,t){if(!e)return;if("string"===typeof e)return vi(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return vi(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function bi(){var e=(0,yi.w)((function(e){return e.gl.domElement}));return(0,hi.T2)({onWheel:function(e){var t=e.first,n=gi(e.xy,2)[1],r=gi(e.previous,2)[1];e.event.preventDefault(),t||oi.getState().pinch(1+.002*(n-r))},onDrag:function(t){var n=t.first,r=gi(t.xy,2),o=r[0],i=r[1],a=gi(t.previous,2),l=a[0],s=a[1],c=t.buttons;t.event.preventDefault(),n||2!==c||oi.getState().drag((o-l)/e.clientHeight,(i-s)/e.clientHeight)},onPinch:function(t){var n=gi(t.da,1)[0],r=t.event,o=t.origin,i=t.memo;if(r.preventDefault(),null==i)return[n,o];var a=gi(i,2),l=a[0],s=a[1];if(null!=l&&oi.getState().pinch(n/l),null!=o&&null!=s){var c=gi(o,2),u=c[0],p=c[1],f=gi(s,2),m=f[0],d=f[1];oi.getState().drag((u-m)/e.clientHeight,(p-d)/e.clientHeight)}return[n,o]},onPointerDown:function(t){var n=t.buttons;t.event.preventDefault(),2==n&&"requestPointerLock"in e&&e.requestPointerLock()},onPointerUp:function(e){e.event.preventDefault(),"exitPointerLock"in document&&document.exitPointerLock()}},{domTarget:e,eventOptions:{passive:!1}}),function(){var e=(0,eo.useRef)({forward:!1,backward:!1,left:!1,right:!1,up:!1,down:!1});(0,eo.useEffect)((function(){var t=function(t){switch(t.key){case"e":e.current.up=!0;break;case"q":e.current.down=!0;break;case"w":case"ArrowUp":e.current.forward=!0;break;case"d":case"ArrowRight":e.current.right=!0;break;case"s":case"ArrowDown":e.current.backward=!0;break;case"a":case"ArrowLeft":e.current.left=!0}},n=function(t){switch(t.key){case"e":e.current.up=!1;break;case"q":e.current.down=!1;break;case"w":case"ArrowUp":e.current.forward=!1;break;case"d":case"ArrowRight":e.current.right=!1;break;case"s":case"ArrowDown":e.current.backward=!1;break;case"a":case"ArrowLeft":e.current.left=!1}};return window.addEventListener("keydown",t),window.addEventListener("keyup",n),function(){window.removeEventListener("keydown",t),window.removeEventListener("keyup",n)}}),[]),(0,yi.x)((function(t,n){var r=oi.getState();if("fly"==r.viewType){var o=n*xi,i=0,a=0,l=0;e.current.left&&(i-=o),e.current.right&&(i+=o),e.current.forward&&(l-=o),e.current.backward&&(l+=o),e.current.up&&(a+=o),e.current.down&&(a-=o),0==i&&0==a&&0==l||r.moveFlyCamera([i,a,l])}}))}(),(0,eo.useEffect)((function(){var e=function(e){return e.preventDefault()};return window.addEventListener("contextmenu",e),function(){return window.removeEventListener("contextmenu",e)}}),[]),null}var xi=1e-6;function wi(){return(0,r.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",className:"bi bi-box-arrow-left",viewBox:"0 0 16 16",children:[(0,r.jsx)("path",{fillRule:"evenodd",d:"M6 12.5a.5.5 0 0 0 .5.5h8a.5.5 0 0 0 .5-.5v-9a.5.5 0 0 0-.5-.5h-8a.5.5 0 0 0-.5.5v2a.5.5 0 0 1-1 0v-2A1.5 1.5 0 0 1 6.5 2h8A1.5 1.5 0 0 1 16 3.5v9a1.5 1.5 0 0 1-1.5 1.5h-8A1.5 1.5 0 0 1 5 12.5v-2a.5.5 0 0 1 1 0v2z"}),(0,r.jsx)("path",{fillRule:"evenodd",d:"M.146 8.354a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L1.707 7.5H10.5a.5.5 0 0 1 0 1H1.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3z"})]})}function ji(){return(0,r.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",className:"bi bi-check2-all",viewBox:"0 0 16 16",children:[(0,r.jsx)("path",{d:"M12.354 4.354a.5.5 0 0 0-.708-.708L5 10.293 1.854 7.146a.5.5 0 1 0-.708.708l3.5 3.5a.5.5 0 0 0 .708 0l7-7zm-4.208 7-.896-.897.707-.707.543.543 6.646-6.647a.5.5 0 0 1 .708.708l-7 7a.5.5 0 0 1-.708 0z"}),(0,r.jsx)("path",{d:"m5.354 7.146.896.897-.707.707-.897-.896a.5.5 0 1 1 .708-.708z"})]})}var Si=n(9866);function Oi(){return(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",className:"bi bi-trash3",viewBox:"0 0 16 16",children:(0,r.jsx)("path",{d:"M6.5 1h3a.5.5 0 0 1 .5.5v1H6v-1a.5.5 0 0 1 .5-.5ZM11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3A1.5 1.5 0 0 0 5 1.5v1H2.506a.58.58 0 0 0-.01 0H1.5a.5.5 0 0 0 0 1h.538l.853 10.66A2 2 0 0 0 4.885 16h6.23a2 2 0 0 0 1.994-1.84l.853-10.66h.538a.5.5 0 0 0 0-1h-.995a.59.59 0 0 0-.01 0H11Zm1.958 1-.846 10.58a1 1 0 0 1-.997.92h-6.23a1 1 0 0 1-.997-.92L3.042 3.5h9.916Zm-7.487 1a.5.5 0 0 1 .528.47l.5 8.5a.5.5 0 0 1-.998.06L5 5.03a.5.5 0 0 1 .47-.53Zm5.058 0a.5.5 0 0 1 .47.53l-.5 8.5a.5.5 0 1 1-.998-.06l.5-8.5a.5.5 0 0 1 .528-.47ZM8 4.5a.5.5 0 0 1 .5.5v8.5a.5.5 0 0 1-1 0V5a.5.5 0 0 1 .5-.5Z"})})}function Mi(){return(0,r.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",className:"bi bi-file-earmark-check",viewBox:"0 0 16 16",children:[(0,r.jsx)("path",{d:"M10.854 7.854a.5.5 0 0 0-.708-.708L7.5 9.793 6.354 8.646a.5.5 0 1 0-.708.708l1.5 1.5a.5.5 0 0 0 .708 0l3-3z"}),(0,r.jsx)("path",{d:"M14 14V4.5L9.5 0H4a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2zM9.5 3A1.5 1.5 0 0 0 11 4.5h2V14a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1h5.5v2z"})]})}function Pi(){return(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",className:"bi bi-plus",viewBox:"0 0 16 16",children:(0,r.jsx)("path",{d:"M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4z"})})}function Ei(){return(0,r.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",className:"bi bi-shuffle",viewBox:"0 0 16 16",children:[(0,r.jsx)("path",{fillRule:"evenodd",d:"M0 3.5A.5.5 0 0 1 .5 3H1c2.202 0 3.827 1.24 4.874 2.418.49.552.865 1.102 1.126 1.532.26-.43.636-.98 1.126-1.532C9.173 4.24 10.798 3 13 3v1c-1.798 0-3.173 1.01-4.126 2.082A9.624 9.624 0 0 0 7.556 8a9.624 9.624 0 0 0 1.317 1.918C9.828 10.99 11.204 12 13 12v1c-2.202 0-3.827-1.24-4.874-2.418A10.595 10.595 0 0 1 7 9.05c-.26.43-.636.98-1.126 1.532C4.827 11.76 3.202 13 1 13H.5a.5.5 0 0 1 0-1H1c1.798 0 3.173-1.01 4.126-2.082A9.624 9.624 0 0 0 6.444 8a9.624 9.624 0 0 0-1.317-1.918C4.172 5.01 2.796 4 1 4H.5a.5.5 0 0 1-.5-.5z"}),(0,r.jsx)("path",{d:"M13 5.466V1.534a.25.25 0 0 1 .41-.192l2.36 1.966c.12.1.12.284 0 .384l-2.36 1.966a.25.25 0 0 1-.41-.192zm0 9v-3.932a.25.25 0 0 1 .41-.192l2.36 1.966c.12.1.12.284 0 .384l-2.36 1.966a.25.25 0 0 1-.41-.192z"})]})}function Ni(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Ai(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}function ki(e){var t,n=e.createDescriptionRequestData,o=e.style,i=e.className,a=e.children,l=Ai(e,["createDescriptionRequestData","style","className","children"]),s=Ao(),c=s((function(e){return e.descriptions})),u=s((function(e){return e.selectedDescriptions}));return(0,r.jsxs)("div",function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){Ni(e,t,n[t])}))}return e}({},l,{style:o,className:"".concat(i," bg-light rounded shadow w-100 overflow-hidden border d-flex flex-column"),children:[(0,r.jsxs)("div",{className:"px-3 py-2 border-bottom d-flex flex-row align-items-center",children:[(0,r.jsx)("span",{children:"Descriptions"}),(0,r.jsx)("div",{className:"flex-grow-1"}),(0,r.jsx)(Si.Z,{align:{offset:[0,8]},placement:"top",overlay:"Add Description",children:(0,r.jsx)("button",{onClick:function(){return s.getState().request("create-description",(function(e){return s.getState().addDescriptions([{name:e}])}),null==n?void 0:n())},className:"btn text-primary btn-sm",children:(0,r.jsx)(Pi,{})})})]}),(0,r.jsx)("div",{className:"d-flex flex-column scroll",children:c.map((function(e,n){var o=e.name,i=e.seed;return(0,r.jsxs)("div",{onClick:function(e){return s.getState().selectDescription(o,null!==(t=s.getState().shift)&&void 0!==t&&t)},className:"pointer py-2 ps-3 pe-2 d-flex flex-row align-items-center border-top border-1 ".concat(u.includes(o)?"border-primary border-3 border":""),children:[(0,r.jsx)("span",{className:"overflow-hidden",style:{textOverflow:"ellipsis"},children:o}),(0,r.jsx)("div",{className:"flex-grow-1"}),(0,r.jsx)(Si.Z,{align:{offset:[0,5]},placement:"top",overlay:"Concretize",children:(0,r.jsx)("button",{onClick:function(e){e.stopPropagation(),s.getState().concretizeDescription(o,i)},className:"btn btn-sm",children:(0,r.jsx)(Mi,{})})}),(0,r.jsx)(Si.Z,{placement:"top",align:{offset:[0,5]},overlay:"Randomize",children:(0,r.jsx)("button",{onClick:function(e){e.stopPropagation(),s.getState().setSeed(o,i+1)},className:"btn btn-sm",children:(0,r.jsx)(Ei,{})})}),(0,r.jsx)(Si.Z,{placement:"top",align:{offset:[0,5]},overlay:"Delete Description",children:(0,r.jsx)("button",{onClick:function(e){e.stopPropagation(),s.getState().deleteDescription(o)},className:"btn text-danger btn-sm",children:(0,r.jsx)(Oi,{})})})]},o)}))}),a]}))}function Ci(){return(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",className:"bi bi-check",viewBox:"0 0 16 16",children:(0,r.jsx)("path",{d:"M10.97 4.97a.75.75 0 0 1 1.07 1.05l-3.99 4.99a.75.75 0 0 1-1.08.02L4.324 8.384a.75.75 0 1 1 1.06-1.06l2.094 2.093 3.473-4.425a.267.267 0 0 1 .02-.022z"})})}function Vi(){return(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",className:"bi bi-arrow-left-right",viewBox:"0 0 16 16",children:(0,r.jsx)("path",{fillRule:"evenodd",d:"M1 11.5a.5.5 0 0 0 .5.5h11.793l-3.147 3.146a.5.5 0 0 0 .708.708l4-4a.5.5 0 0 0 0-.708l-4-4a.5.5 0 0 0-.708.708L13.293 11H1.5a.5.5 0 0 0-.5.5zm14-7a.5.5 0 0 1-.5.5H2.707l3.147 3.146a.5.5 0 1 1-.708.708l-4-4a.5.5 0 0 1 0-.708l4-4a.5.5 0 1 1 .708.708L2.707 4H14.5a.5.5 0 0 1 .5.5z"})})}function zi(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Ti(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){zi(e,t,n[t])}))}return e}function Li(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}function Di(e){var t=e.className,n=e.value,o=e.children,i=Li(e,["className","value","children"]);return(0,r.jsxs)("div",Ti({className:"".concat(t," d-flex flex-row")},i,{children:[(0,r.jsx)("label",{style:{width:"4rem"},className:"mb-0 flex-shrink-0 form-label me-2",children:n}),o]}))}function Ii(e){var t=e.className,n=e.value,o=e.children,i=Li(e,["className","value","children"]);return(0,r.jsxs)("div",Ti({className:"".concat(t," d-flex flex-row")},i,{children:[o,(0,r.jsx)("label",{className:"mb-0 flex-shrink-0 form-label ms-2",children:n})]}))}function Bi(e){var t=e.step,n=e.values,o=Ao();return(0,r.jsxs)("div",{className:"d-flex flex-column mb-3 mx-3",children:[(0,r.jsx)(Di,{onClick:function(e){return o.getState().selectChildren(t,n,t.children[0])},value:"Condition",className:"pointer mb-3",children:(0,r.jsx)("div",{className:"flex-grow-1 text-end px-2",children:Mt(t.children[0])})}),(0,r.jsxs)(Di,{onClick:function(e){return o.getState().selectChildren(t,n,t.children[1])},value:"Then",className:"pointer mb-3",children:[(0,r.jsx)("div",{className:"flex-grow-1 text-end px-2",children:Mt(t.children[1])}),(0,r.jsx)(Si.Z,{placement:"left",overlay:"Replace with this",children:(0,r.jsx)("button",{onClick:function(){return o.getState().replace((function(){return t.children[1]}),t)},className:"btn btn-sm btn-outline-primary",children:(0,r.jsx)(Vi,{})})})]}),(0,r.jsxs)(Di,{onClick:function(e){return o.getState().selectChildren(t,n,t.children[2])},value:"Else",className:"pointer mb-3",children:[(0,r.jsx)("div",{className:"flex-grow-1 text-end px-2",children:Mt(t.children[2])}),(0,r.jsx)(Si.Z,{placement:"left",overlay:"Replace with this",children:(0,r.jsx)("button",{onClick:function(){return o.getState().replace((function(){return t.children[2]}),t)},className:"btn btn-sm btn-outline-primary",children:(0,r.jsx)(Vi,{})})})]})]})}function qi(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Gi(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i=[],a=!0,l=!1;try{for(n=n.call(e);!(a=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);a=!0);}catch(s){l=!0,o=s}finally{try{a||null==n.return||n.return()}finally{if(l)throw o}}return i}}(e,t)||function(e,t){if(!e)return;if("string"===typeof e)return qi(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return qi(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ri(e){var t,n,o=e.label,i=e.className,a=e.values,l=e.onChange,s=e.selectAll,c=e.unselectAll,u=(0,eo.useState)(!1),p=u[0],f=u[1],m=(0,eo.useState)(),d=m[0],h=m[1],y=null===d||void 0===d?void 0:d.getBoundingClientRect();return(0,r.jsxs)("div",{className:"".concat(i," d-flex"),children:[(0,r.jsx)("button",{ref:h,onClick:function(){return f((function(e){return!e}))},className:"btn-sm btn-outline-secondary btn flex-grow-1 dropdown-toggle",type:"button",children:o}),a.length>0&&(0,r.jsx)("div",{style:{width:null===y||void 0===y?void 0:y.width,top:(null!==(t=null===y||void 0===y?void 0:y.top)&&void 0!==t?t:0)+(null!==(n=null===y||void 0===y?void 0:y.height)&&void 0!==n?n:0),bottom:"4rem"},className:"d-flex flex-column overflow-hidden position-absolute ".concat(p?"":"visually-hidden"),children:(0,r.jsxs)("div",{className:"overflow-hidden d-flex flex-column w-100 pt-2 bg-light rounded border",children:[(0,r.jsxs)("div",{className:"btn-group w-100 px-2 mb-2",children:[(0,r.jsx)("button",{className:"btn btn-sm btn-outline-secondary",onClick:s,children:"Select All"}),(0,r.jsx)("button",{className:"btn btn-sm btn-outline-secondary",onClick:c,children:"Unselect All"})]}),(0,r.jsx)("div",{className:"d-flex flex-column scroll",children:a.map((function(e,t){var n=Gi(e,3),o=n[0],i=n[1],a=n[2];return(0,r.jsx)("div",{className:"mx-3 mb-2",children:(0,r.jsx)(Ii,{value:o,children:(0,r.jsx)("input",{onChange:function(e){return l(a,e.target.checked,t)},type:"checkbox",checked:i})})},o)}))})]})})]})}function Zi(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Qi(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}function $i(e){var t=e.value,n=e.onBlur,o=Qi(e,["value","onBlur"]),i=(0,eo.useState)(t),a=i[0],l=i[1];return(0,eo.useEffect)((function(){return l(t)}),[t]),(0,r.jsx)("input",function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){Zi(e,t,n[t])}))}return e}({},o,{value:a,onChange:function(e){return l(e.target.value)},onKeyDown:function(e){return"Enter"===e.key&&e.currentTarget.blur()},onBlur:function(e){null!=n&&e.target.value!=t&&n(e)}}))}function Xi(e,t,n,r,o,i,a){try{var l=e[i](a),s=l.value}catch(c){return void n(c)}l.done?t(s):Promise.resolve(s).then(r,o)}function Fi(e){return function(){var t=this,n=arguments;return new Promise((function(r,o){var i=e.apply(t,n);function a(e){Xi(i,r,o,a,l,"next",e)}function l(e){Xi(i,r,o,a,l,"throw",e)}a(void 0)}))}}function Yi(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Ui(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){Yi(e,t,n[t])}))}return e}function Wi(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}function Hi(e){var t=e.asyncFn,n=e.shortcutKey,o=e.className,i=e.children,a=Wi(e,["asyncFn","shortcutKey","className","children"]),l=(0,eo.useState)(void 0),s=l[0],c=l[1],u=(0,eo.useRef)();u.current=s;var p=(0,eo.useCallback)(Fi(no().mark((function e(){return no().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t();case 2:c(setTimeout((function(){return c(void 0)}),1e3));case 3:case"end":return e.stop()}}),e)}))),[t]);return(0,eo.useEffect)((function(){var e=function(e){e.key===n&&e.ctrlKey&&(e.stopPropagation(),e.preventDefault(),p())};return window.addEventListener("keydown",e),function(){null!=u.current&&clearTimeout(u.current),window.removeEventListener("keydown",e)}}),[]),null!=s?(0,r.jsx)("div",Ui({},a,{className:"".concat(o," btn btn-success h1 btn-outline-success btn-sm text-light"),children:(0,r.jsx)(Ci,{})})):(0,r.jsx)("div",Ui({},a,{className:"".concat(o," btn btn-sm"),onClick:p,children:i}))}function _i(e){var t=e.onPaste,n=Wi(e,["onPaste"]);return(0,r.jsx)(Hi,Ui({},n,{shortcutKey:"v",asyncFn:Fi(no().mark((function e(){var n;return no().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,navigator.clipboard.readText();case 2:return n=e.sent,e.next=5,t(n);case 5:case"end":return e.stop()}}),e)})))}))}function Ki(e){var t=e.onCopy,n=Wi(e,["onCopy"]);return(0,r.jsx)(Hi,Ui({},n,{shortcutKey:"c",asyncFn:Fi(no().mark((function e(){var n;return no().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t(),e.next=3,navigator.clipboard.writeText(n);case 3:case"end":return e.stop()}}),e)})))}))}function Ji(e){var t=e.value,n=e.descriptionName,o=Ao(),i=Q(t);return(0,r.jsxs)("div",{className:"d-flex flex-column",children:[(0,r.jsxs)("div",{className:"d-flex flex-row align-items-center mx-3 mb-2 w-auto",children:[(0,r.jsx)($i,{value:D(t,i),className:"flex-grow-1 form-control form-control-sm",onBlur:function(e){return o.getState().renameNoun(L(e.target.value,i))}}),i!==n&&(0,r.jsxs)("span",{className:"ms-1",children:["@",n]})]}),(0,r.jsx)(Ki,{className:"mb-3 mx-3 btn btn-sm btn-outline-secondary",onCopy:function(){return function(e,t){if("gui"!==e.getState().type)return"";return JSON.stringify({step:{type:"symbol",identifier:t}})}(o,t)},children:"Copy Reference"})]})}function ea(e){var t,n=e.step,o=e.values,i=No(),a=i.operationGuiMap,l=i.operations,s=a[n.identifier];return null!=s?(0,r.jsx)(s,{value:n}):void 0!=(null===(t=l[n.identifier])||void 0===t?void 0:t.defaultParameters)?(0,r.jsx)(ta,{value:n,values:o}):null}function ta(e){var t=e.value,n=e.values,o=Ao();return(0,r.jsxs)("div",{className:"d-flex flex-column mx-3 mb-3",children:[t.children.map((function(e,i){return(0,r.jsxs)("div",{className:"d-flex flex-row align-items-center border-bottom",children:[(0,r.jsx)("div",{className:"flex-grow-1 p-3 pointer",onClick:function(r){return o.getState().selectChildren(t,n,e)},children:Mt(e)}),(0,r.jsx)(Si.Z,{placement:"left",overlay:"Delete",children:(0,r.jsx)("div",{onClick:function(){return o.getState().replace((function(e){e.children.splice(i,1)}),t)},className:"d-flex align-items-center ms-2 btn btn-sm btn-outline-danger",children:(0,r.jsx)(Oi,{})})})]},i)})),(0,r.jsx)("div",{className:"btn btn-outline-success",onClick:function(){return o.getState().replace((function(e){e.children.push({type:"this"})}),t)},children:"Add Parameter"})]})}function na(e){var t=e.step,n=e.values,o=Ao();return(0,r.jsxs)("div",{className:"d-flex flex-column mx-3 mb-3",children:[t.children.map((function(e,i){return(0,r.jsxs)("div",{className:"d-flex flex-row align-items-center border-bottom",children:[(0,r.jsx)($i,{className:"form-control form-control-sm",type:"text",value:100*t.probabilities[i],onBlur:function(e){return o.getState().replace((function(t){var n;t.probabilities[i]=(n=e.target.value,parseFloat(n)/100)}),t)}}),(0,r.jsx)("div",{className:"flex-grow-1 ms-2 p-3 pointer",onClick:function(r){return o.getState().selectChildren(t,n,e)},children:Mt(e)}),(0,r.jsx)(Si.Z,{placement:"left",overlay:"Replace with this",children:(0,r.jsx)("button",{onClick:function(){return o.getState().replace((function(){return e}),t)},className:"btn ms-2 btn-sm btn-outline-primary",children:(0,r.jsx)(Vi,{})})}),(0,r.jsx)(Si.Z,{placement:"left",overlay:"Delete",children:(0,r.jsx)("div",{onClick:function(){return o.getState().replace((function(e){e.children.splice(i,1),e.probabilities.splice(i,1)}),t)},className:"d-flex align-items-center ms-2 btn btn-sm btn-outline-danger",children:(0,r.jsx)(Oi,{})})})]},i)})),(0,r.jsx)("div",{onClick:function(){return o.getState().replace((function(e){e.children.push({type:"this"}),e.probabilities.push(0)}),t)},className:"btn btn-outline-success",children:"Add"})]})}function ra(e){if("true"===e||"false"===e)return"true"===e;var t=parseInt(e);return isNaN(t)?e:t}function oa(e){var t=e.step,n=Ao();return(0,r.jsx)($i,{value:t.value,className:"mx-3 mb-3 w-auto form-control form-control-sm",onBlur:function(e){return n.getState().replace((function(t){t.value=ra(e.target.value)}),t)}})}function ia(e){var t=e.step,n=e.values,o=Ao();return(0,r.jsxs)("div",{className:"d-flex flex-column mb-3 mx-3",children:[(0,r.jsx)(Di,{onClick:function(e){return o.getState().selectChildren(t,n,t.children[0])},value:"Condition",className:"pointer mb-3",children:(0,r.jsx)("div",{className:"flex-grow-1 text-end px-2",children:Mt(t.children[0])})}),t.children.slice(1).map((function(e,i){return(0,r.jsxs)("div",{className:"d-flex flex-row align-items-center border-bottom mb-3",children:[(0,r.jsx)($i,{className:"form-control form-control-sm",type:"text",value:t.cases[i],onBlur:function(e){return o.getState().replace((function(t){t.cases[i]=[ra(e.target.value)]}),t)}}),(0,r.jsx)("div",{className:"flex-grow-1 ms-2 p-3 pointer",onClick:function(r){return o.getState().selectChildren(t,n,e)},children:Mt(e)}),(0,r.jsx)(Si.Z,{placement:"left",overlay:"Replace with this",children:(0,r.jsx)("button",{onClick:function(){return o.getState().replace((function(){return e}),t)},className:"btn btn-sm btn-outline-primary ms-2",children:(0,r.jsx)(Vi,{})})}),(0,r.jsx)(Si.Z,{placement:"left",overlay:"Delete",children:(0,r.jsx)("div",{onClick:function(){o.getState().replace((function(e){e.children.splice(i,1),e.cases.splice(i,1)}),t)},className:"d-flex align-items-center ms-2 btn btn-sm btn-outline-danger",children:(0,r.jsx)(Oi,{})})})]},i)})),(0,r.jsx)("div",{onClick:function(){return o.getState().replace((function(e){e.children.push({type:"this"}),e.cases.push([0])}),t)},className:"btn btn-outline-success",children:"Add Case"})]})}function aa(e){var t=e.step,n=e.description,o=Ao(),i=o((function(e){return"gui"===e.type&&null!=e.selectedDescriptions?D(t.identifier,n):void 0})),a=o((function(e){return"gui"===e.type&&null!=e.selectedDescriptions?e.grammar.map((function(e){return D(e.name,n)})):void 0}));return null==a?null:(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(Di,{value:"Noun",className:"mb-3 mx-3",children:(0,r.jsx)("select",{value:i,onChange:function(e){return o.getState().replace((function(t){t.identifier=e.currentTarget.value}),t)},className:"flex-grow-1 form-select form-select-sm",children:a.map((function(e){return(0,r.jsx)("option",{value:e,children:e},e)}))})}),null!=i&&i.includes("@")&&(0,r.jsxs)("div",{className:"mb-3 mx-3 btn btn-outline-secondary",onClick:function(){return o.getState().pasteNoun(n,t,i)},children:["Paste to ",n]})]})}function la(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function sa(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}function ca(e,t){return"string"==typeof t||"operation"!==t.type||null==e[t.identifier]}function ua(e,t){e.getState().request("create-step",(function(n){var r=n.step,o=n.dependencies,i=n.randomize;return e.getState().insert(t,r,o,i)}))}function pa(e){e.getState().request("create-step",(function(t){var n=t.step,r=t.dependencies,o=t.randomize;return e.getState().replace((function(e,t){return n(t)}),void 0,r,o)}))}function fa(e){e.getState().request("set-name",(function(t){return e.getState().setName(t)}))}function ma(e){var t=e.className,n=sa(e,["className"]),o=Ao(),i=o((function(e){return e.selectedDescriptions})),a=o((function(e){return"gui"===e.type&&null==e.requested?e.selectionsList:void 0}));return null==a||0===a.length||null==i?null:(0,r.jsx)("div",function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){la(e,t,n[t])}))}return e}({},n,{className:"".concat(t," d-flex flex-column px-0 pt-3"),children:(0,r.jsxs)("div",{className:"d-flex flex-column overflow-hidden",children:[(0,r.jsxs)("div",{style:{whiteSpace:"pre"},className:"btn-group mx-3 mb-1 d-flex",children:[(0,r.jsx)("button",{onClick:ua.bind(null,o,"before"),className:"btn btn-sm btn-outline-success flex-grow-1 flex-basis-0",children:"+ Before"}),(0,r.jsx)("button",{onClick:ua.bind(null,o,"parallel"),className:"btn btn-sm btn-outline-success flex-grow-1 flex-basis-0",children:"+ Parllel"}),(0,r.jsx)("button",{onClick:ua.bind(null,o,"after"),className:"btn btn-sm btn-outline-success flex-grow-1 flex-basis-0",children:"+ After"})]}),(0,r.jsxs)("div",{style:{whiteSpace:"pre"},className:"btn-group mx-3 mb-1 d-flex",children:[(0,r.jsx)("button",{onClick:pa.bind(null,o),className:"btn btn-sm btn-outline-secondary flex-grow-1 flex-basis-0",children:"Replace"}),(0,r.jsx)(da,{})]}),(0,r.jsxs)("div",{style:{whiteSpace:"pre"},className:"btn-group mx-3 mb-3 d-flex",children:[(0,r.jsx)("button",{onClick:function(){o.getState().unselectAll()},className:"d-flex align-items-center justify-content-center btn btn-sm btn-outline-primary flex-grow-1 flex-basis-0",children:(0,r.jsx)(Ci,{})}),(0,r.jsx)("button",{onClick:o.getState().removeStep.bind(null,void 0),className:"d-flex align-items-center justify-content-center btn btn-sm btn-outline-danger flex-grow-1 flex-basis-0",children:(0,r.jsx)(Oi,{})})]}),(0,r.jsx)("div",{className:"scroll",children:i.map((function(e){var t=a.filter((function(t){return T(e,pr(t.steps)[0])}));return 0===t.length?null:(0,r.jsxs)("div",{className:"d-flex flex-column",children:[(0,r.jsx)("span",{style:{fontWeight:500},className:"text-bold mx-3 mb-2",children:e}),t.map((function(t){return(0,r.jsx)(ha,{descriptionName:e,selections:t},ur(t.steps))}))]},e)}))})]})}))}function da(){var e=Ao(),t=e((function(e){return 1===e.selectedDescriptions.length}));return(0,r.jsx)("button",{onClick:fa.bind(null,e),className:"".concat(t?"":"disabled"," btn btn-sm btn-outline-secondary flex-grow-1 flex-basis-0"),children:"Set-Name"})}function ha(e){var t=e.selections,n=e.descriptionName,o=Ao(),i=ur(t.steps),a=o((function(e){return"gui"===e.type?e.valueMap:void 0})),l=(0,eo.useMemo)((function(){return null!=a?a[i]:void 0}),[a]);return(0,r.jsxs)("div",{className:"d-flex flex-column",children:[(0,r.jsx)("label",{className:"mb-3 mx-3",children:Rn(t.steps,n)}),(0,r.jsx)(va,{descriptionName:n,step:t.steps,values:t.values}),null!=l&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("button",{onClick:function(){return o.getState().autoSelectPattern(t)},className:"btn mx-3 btn-outline-secondary btn-sm mb-2",children:"auto-select pattern"}),(0,r.jsx)(Ri,{selectAll:function(){return o.getState().select(t.steps,void 0,"add")},unselectAll:function(){return o.getState().select(t.steps,void 0,"remove")},className:"mb-3 mx-3",label:"".concat(t.values.length,"/").concat(l.length," selected"),onChange:function(e,n){o.getState().select(t.steps,e,n?"add":"remove")},values:ya(t,l)})]})]})}function ya(e,t){return t.map((function(t){return["".concat(t.before.index.join(",")," -> ").concat(t.after.index.join(",")),null!=e.values.find((function(e){return U(e.after.index,t.after.index)===Y.Equal})),t]}))}function va(e){var t=e.step,n=e.values,o=e.descriptionName;if("string"===typeof t)return(0,r.jsx)(Ji,{descriptionName:o,value:t});switch(t.type){case"raw":return(0,r.jsx)(oa,{step:t});case"symbol":return(0,r.jsx)(aa,{description:o,step:t});case"operation":return(0,r.jsx)(ea,{step:t,values:n});case"random":return(0,r.jsx)(na,{step:t,values:n});case"switch":return(0,r.jsx)(ia,{step:t,values:n});case"if":return(0,r.jsx)(Bi,{step:t,values:n});default:return null}}function ga(){return(0,r.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",className:"bi bi-card-text",viewBox:"0 0 16 16",children:[(0,r.jsx)("path",{d:"M14.5 3a.5.5 0 0 1 .5.5v9a.5.5 0 0 1-.5.5h-13a.5.5 0 0 1-.5-.5v-9a.5.5 0 0 1 .5-.5h13zm-13-1A1.5 1.5 0 0 0 0 3.5v9A1.5 1.5 0 0 0 1.5 14h13a1.5 1.5 0 0 0 1.5-1.5v-9A1.5 1.5 0 0 0 14.5 2h-13z"}),(0,r.jsx)("path",{d:"M3 5.5a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5zM3 8a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9A.5.5 0 0 1 3 8zm0 2.5a.5.5 0 0 1 .5-.5h6a.5.5 0 0 1 0 1h-6a.5.5 0 0 1-.5-.5z"})]})}function ba(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function xa(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){ba(e,t,n[t])}))}return e}function wa(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}function ja(e){var t=e.className,n=wa(e,["className"]),o=Ao(),i=o((function(e){return e.showTui}));return(0,r.jsx)(Si.Z,{placement:"left",overlay:"Text Interface",children:(0,r.jsx)("div",xa({},n,{onClick:function(){return o.getState().setShowTui(!i)},className:"".concat(t," d-flex align-items-center justify-content-center btn ").concat(i?"btn-primary":"btn-secondary"," btn-sm "),children:(0,r.jsx)(ga,{})}))})}var Sa=n(6974);function Oa(e){var t=e.value,n=e.getSubstep,o=e.className,i=e.defaultValue,a=n(t),l="raw"===a.children[0].type?a.children[0].value:void 0,s="raw"===a.children[1].type?a.children[1].value:void 0,c="raw"===a.children[2].type?a.children[2].value:void 0,u=Ao(),p=function(e,r){return u.getState().replace((function(t){var o=n(t);"operation"===o.type&&(o.children[e]={type:"raw",value:r})}),t)};return(0,r.jsxs)("div",{className:o,children:[(0,r.jsx)($i,{value:null!==l&&void 0!==l?l:i,type:"number",className:"flex-grow-1 me-2 flex-basis-0 form-control form-control-sm",onBlur:function(e){return p(0,e.target.valueAsNumber)}}),(0,r.jsx)($i,{value:null!==s&&void 0!==s?s:i,type:"number",className:"flex-grow-1 me-2 flex-basis-0 form-control form-control-sm",onBlur:function(e){return p(1,e.target.valueAsNumber)}}),(0,r.jsx)($i,{value:null!==c&&void 0!==c?c:i,type:"number",className:"flex-grow-1 flex-basis-0 form-control form-control-sm",onBlur:function(e){return p(2,e.target.valueAsNumber)}})]})}function Ma(e){var t=e.value,n=e.getSubstep,o=e.className,i=e.defaultValue,a=n(t),l="raw"===a.children[0].type?a.children[0].value:void 0,s="raw"===a.children[1].type?a.children[1].value:void 0,c=Ao(),u=function(e,r){return c.getState().replace((function(t){var o=n(t);"operation"===o.type&&(o.children[e]={type:"raw",value:r})}),t)};return(0,r.jsxs)("div",{className:o,children:[(0,r.jsx)($i,{value:null!==l&&void 0!==l?l:i,type:"number",className:"flex-grow-1 me-2 flex-basis-0 form-control form-control-sm",onBlur:function(e){return u(0,e.target.valueAsNumber)}}),(0,r.jsx)($i,{value:null!==s&&void 0!==s?s:i,type:"number",className:"flex-grow-1 flex-basis-0 form-control form-control-sm",onBlur:function(e){return u(1,e.target.valueAsNumber)}})]})}function Pa(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Ea(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i=[],a=!0,l=!1;try{for(n=n.call(e);!(a=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);a=!0);}catch(s){l=!0,o=s}finally{try{a||null==n.return||n.return()}finally{if(l)throw o}}return i}}(e,t)||function(e,t){if(!e)return;if("string"===typeof e)return Pa(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Pa(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Na(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Aa(){return Aa=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},Aa.apply(this,arguments)}function ka(e){var t=Aa({},e);return(0,r.jsxs)("select",function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){Na(e,t,n[t])}))}return e}({},t,{children:[(0,r.jsx)("option",{value:"x",children:"X"}),(0,r.jsx)("option",{value:"y",children:"Y"}),(0,r.jsx)("option",{value:"z",children:"Z"})]}))}function Ca(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Va(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i=[],a=!0,l=!1;try{for(n=n.call(e);!(a=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);a=!0);}catch(s){l=!0,o=s}finally{try{a||null==n.return||n.return()}finally{if(l)throw o}}return i}}(e,t)||function(e,t){if(!e)return;if("string"===typeof e)return Ca(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Ca(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var za=function(){return null},Ta={color:function(e){var t=e.value,n="raw"===t.children[0].type?t.children[0].value:void 0,o=Ao();return(0,r.jsx)("input",{value:null!==n&&void 0!==n?n:16711680,type:"color",className:"mx-3 mb-3 w-auto form-control form-control-sm",onChange:function(e){return o.getState().replace((function(t){t.children[0]={type:"raw",value:e.target.value}}),t)}})},point3:function(e){return Oa({className:"mb-3 d-flex flex-row mx-3",defaultValue:0,getSubstep:function(e){return e},value:e.value})},point2:function(e){return Ma({className:"mb-3 d-flex flex-row mx-3",defaultValue:0,getSubstep:function(e){return e},value:e.value})},line:function(e){var t=e.value;return"operation"!==t.children[0].type||"operation"!==t.children[1].type?null:(0,r.jsxs)(r.Fragment,{children:["point3"===t.children[0].identifier?(0,r.jsx)(Oa,{className:"mb-3 d-flex flex-row mx-3",defaultValue:0,getSubstep:function(e){return H("operation",e.children[0])},value:t}):(0,r.jsx)(Ma,{className:"mb-3 d-flex flex-row mx-3",defaultValue:0,getSubstep:function(e){return H("operation",e.children[0])},value:t}),"point3"===t.children[1].identifier?(0,r.jsx)(Oa,{className:"mb-3 d-flex flex-row mx-3",defaultValue:0,getSubstep:function(e){return H("operation",e.children[1])},value:t}):(0,r.jsx)(Ma,{className:"mb-3 d-flex flex-row mx-3",defaultValue:0,getSubstep:function(e){return H("operation",e.children[1])},value:t})]})},face:function(e){var t=e.value,n=Ao();return(0,r.jsxs)("div",{className:"d-flex flex-column mx-3",children:[t.children.map((function(e,o){return(0,r.jsxs)("div",{className:"d-flex flex-row align-items-center mb-3",children:["operation"===e.type&&(0,r.jsx)(Ma,{className:"d-flex flex-row",defaultValue:0,getSubstep:function(e){return H("operation",e.children[o])},value:t}),(0,r.jsx)(Si.Z,{placement:"left",overlay:"Delete Point",children:(0,r.jsx)("div",{onClick:function(){return n.getState().replace((function(e){e.children.splice(o,1)}),t)},className:"ms-2 d-flex align-items-center btn-sm btn btn-outline-danger",children:(0,r.jsx)(Oi,{})})})]},o)})),(0,r.jsx)("div",{className:"btn btn-outline-success mb-3",onClick:function(){return function(e,t){var n=Ea(ii(oi.getState()),3),r=n[0],o=n[2],i=He(0,18),a=We(Math.round(o*i),18),l=r*i%1*a,s=o*i%1*a;e.getState().replace((function(e){e.children.push({type:"operation",identifier:"point2",children:[{type:"raw",value:l},{type:"raw",value:s}]})}),t)}(n,t)},children:"Add Point"})]})},extrude:function(e){var t=e.value,n="raw"===t.children[0].type?t.children[0].value:void 0,o=Ao();return(0,r.jsx)($i,{value:null!==n&&void 0!==n?n:16711680,type:"number",className:"mx-3 mb-3 w-auto form-control form-control-sm",onBlur:function(e){return o.getState().replace((function(t){t.children[0]={type:"raw",value:e.target.valueAsNumber}}),t)}})},rotate:function(e){return Oa({className:"mb-3 d-flex flex-row mx-3",defaultValue:0,getSubstep:function(e){return e},value:e.value})},translate:function(e){return Oa({className:"mb-3 d-flex flex-row mx-3",defaultValue:0,getSubstep:function(e){return e},value:e.value})},scale:function(e){return Oa({className:"mb-3 d-flex flex-row mx-3",defaultValue:0,getSubstep:function(e){return e},value:e.value})},size:function(e){var t=e.value,n="raw"===t.children[0].type?t.children[0].value:void 0,o=Ao();return(0,r.jsx)(ka,{onChange:function(e){return o.getState().replace((function(t){t.children[0]={type:"raw",value:e.currentTarget.value}}),t)},value:null!==n&&void 0!==n?n:"x",className:"form-select mx-3 mb-3 w-auto form-select-sm"})},toFaces:za,toLines:za,toPoints:za,split:function(e){var t,n=e.value,o=Va(n.children,2),i=o[0],a=o[1],l="raw"===i.type?i.value:void 0,s="raw"===a.type?a.value:void 0,c=Ao(),u=(0,eo.useCallback)((function(e){c.getState().replace((function(t){t.children[1]={type:"raw",value:e}}),n)}),[c,n]);return(0,r.jsxs)("div",{className:"d-flex flex-column mx-3",children:[(0,r.jsx)(Di,{value:"Axis",className:"mb-3 ",children:(0,r.jsx)(ka,{value:l,onChange:function(e){return c.getState().replace((function(t){t.children[0]={type:"raw",value:e.currentTarget.value}}),n)},className:"flex-grow-1 w-auto form-select form-select-sm"})}),(0,r.jsx)(Ii,{value:"Repeat",className:"mb-3",children:(0,r.jsx)("input",{className:"min-w-0 form-check-input",type:"checkbox",checked:!1!==s,onChange:function(e){return u(!!e.target.checked)}})}),!1!==s&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(Ii,{value:"Infinite",className:"mb-3",children:(0,r.jsx)("input",{className:"min-w-0 form-check-input",type:"checkbox",checked:!0===s,onChange:function(e){return u(!!e.target.checked||1)}})}),"number"===typeof s&&(0,r.jsx)(Di,{value:"Repitions",className:"mb-3",children:(0,r.jsx)($i,{className:"min-w-0 form-control form-control-sm",type:"number",value:s,onBlur:function(e){return u(isNaN(e.target.valueAsNumber)?1:e.target.valueAsNumber)}})})]}),n.children.slice(2).map((function(e,o){return(0,r.jsxs)(Di,{value:"Size",className:"mb-3",children:[(0,r.jsx)($i,{className:"min-w-0 form-control form-control-sm",type:"number",value:null!==(t="raw"===e.type?e.value:void 0)&&void 0!==t?t:1,onBlur:function(e){return c.getState().replace((function(t){t.children[o+2]={type:"raw",value:e.target.valueAsNumber}}),n)}}),(0,r.jsx)(Si.Z,{placement:"left",overlay:"Delete",children:(0,r.jsx)("div",{onClick:function(){return c.getState().replace((function(e){e.children.splice(o+2,1)}),n)},className:"d-flex align-items-center btn-sm ms-2 btn btn-outline-danger",children:(0,r.jsx)(Oi,{})})})]},o)})),(0,r.jsx)("div",{className:"btn btn-outline-success mb-3",onClick:function(){return c.getState().replace((function(e){e.children.push({type:"raw",value:1})}),n)},children:"Add"})]})},gableRoof:function(e){var t,n=e.value,o="raw"===(null===(t=n.children[0])||void 0===t?void 0:t.type)?n.children[0].value:void 0,i=Ao();return(0,r.jsx)(Di,{className:"mx-3 mb-3",value:"rotation",children:(0,r.jsx)($i,{value:null!==o&&void 0!==o?o:0,type:"number",className:"mx-3 mb-3 form-control form-control-sm",onBlur:function(e){return i.getState().replace((function(t){t.children[0]={type:"raw",value:e.target.valueAsNumber}}),n)}})})}};function La(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Da(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Ia(e,t,n){return Ia="undefined"!==typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Ba(e)););return e}(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(n):o.value}},Ia(e,t,n||e)}function Ba(e){return Ba=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},Ba(e)}function qa(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ra(e,t)}function Ga(e,t){return!t||"object"!==Za(t)&&"function"!==typeof t?La(e):t}function Ra(e,t){return Ra=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},Ra(e,t)}var Za=function(e){return e&&"undefined"!==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e};function Qa(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Ba(e);if(t){var o=Ba(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Ga(this,n)}}var $a=function(e){qa(n,e);var t=Qa(n);function n(e,r,i){var a,l=arguments.length>3&&void 0!==arguments[3]&&arguments[3];Da(this,n),(a=t.call(this)).isTransformControls=!0,a.visible=!1,a.raycaster=new o.Raycaster,a.tempVector=new o.Vector3,a.tempVector2=new o.Vector3,a.tempQuaternion=new o.Quaternion,a.unit={X:new o.Vector3(1,0,0),Y:new o.Vector3(0,1,0),Z:new o.Vector3(0,0,1)},a.pointStart=new o.Vector3,a.pointEnd=new o.Vector3,a.offset=new o.Vector3,a.rotationAxis=new o.Vector3,a.startNorm=new o.Vector3,a.endNorm=new o.Vector3,a.rotationAngle=0,a.cameraPosition=new o.Vector3,a.cameraQuaternion=new o.Quaternion,a.cameraScale=new o.Vector3,a.parentPosition=new o.Vector3,a.parentQuaternion=new o.Quaternion,a.parentQuaternionInv=new o.Quaternion,a.parentScale=new o.Vector3,a.worldPositionStart=new o.Vector3,a.worldQuaternionStart=new o.Quaternion,a.worldScaleStart=new o.Vector3,a.worldPosition=new o.Vector3,a.worldQuaternion=new o.Quaternion,a.worldQuaternionInv=new o.Quaternion,a.worldScale=new o.Vector3,a.eye=new o.Vector3,a.positionStart=new o.Vector3,a.quaternionStart=new o.Quaternion,a.scaleStart=new o.Vector3,a.enabled=!0,a.axis=null,a.mode="translate",a.translationSnap=null,a.rotationSnap=null,a.scaleSnap=null,a.space="world",a.size=1,a.dragging=!1,a.showX=!0,a.showY=!0,a.showZ=!0,a.changeEvent={type:"change"},a.mouseDownEvent={type:"mouseDown",mode:a.mode},a.mouseUpEvent={type:"mouseUp",mode:a.mode},a.objectChangeEvent={type:"objectChange"},a.intersectObjectWithRay=function(e,t,n){for(var r=t.intersectObject(e,!0),o=0;o<r.length;o++)if(r[o].object.visible||n)return r[o];return!1},a.attach=function(e){return a.object=e,a.visible=!0,La(a)},a.detach=function(){return a.object=void 0,a.visible=!1,a.axis=null,La(a)},a.reset=function(){return a.enabled?(a.dragging&&void 0!==a.object&&(a.object.position.copy(a.positionStart),a.object.quaternion.copy(a.quaternionStart),a.object.scale.copy(a.scaleStart),a.dispatchEvent(a.changeEvent),a.dispatchEvent(a.objectChangeEvent),a.pointStart.copy(a.pointEnd)),La(a)):La(a)},a.updateMatrixWorld=function(){void 0!==a.object&&(a.object.updateMatrixWorld(),null===a.object.parent?console.error("TransformControls: The attached 3D object must be a part of the scene graph."):a.object.parent.matrixWorld.decompose(a.parentPosition,a.parentQuaternion,a.parentScale),a.object.matrixWorld.decompose(a.worldPosition,a.worldQuaternion,a.worldScale),a.parentQuaternionInv.copy(a.parentQuaternion).invert(),a.worldQuaternionInv.copy(a.worldQuaternion).invert()),a.camera.updateMatrixWorld(),a.camera.matrixWorld.decompose(a.cameraPosition,a.cameraQuaternion,a.cameraScale),a.eye.copy(a.cameraPosition).sub(a.worldPosition).normalize(),Ia((La(a),Ba(n.prototype)),"updateMatrixWorld",a).call(a)},a.pointerHover=function(e){if(void 0!==a.object&&!0!==a.dragging){a.raycaster.setFromCamera(e,a.camera);var t=a.intersectObjectWithRay(a.gizmo.picker[a.mode],a.raycaster);a.axis=t?t.object.name:null}},a.pointerDown=function(e){if(void 0!==a.object&&!0!==a.dragging&&0===e.button&&null!==a.axis){a.raycaster.setFromCamera(e,a.camera);var t=a.intersectObjectWithRay(a.plane,a.raycaster,!0);if(t){var n=a.space;if("scale"===a.mode?n="local":"E"!==a.axis&&"XYZE"!==a.axis&&"XYZ"!==a.axis||(n="world"),"local"===n&&"rotate"===a.mode){var r=a.rotationSnap;"X"===a.axis&&r&&(a.object.rotation.x=Math.round(a.object.rotation.x/r)*r),"Y"===a.axis&&r&&(a.object.rotation.y=Math.round(a.object.rotation.y/r)*r),"Z"===a.axis&&r&&(a.object.rotation.z=Math.round(a.object.rotation.z/r)*r)}a.object.updateMatrixWorld(),a.object.parent&&a.object.parent.updateMatrixWorld(),a.positionStart.copy(a.object.position),a.quaternionStart.copy(a.object.quaternion),a.scaleStart.copy(a.object.scale),a.object.matrixWorld.decompose(a.worldPositionStart,a.worldQuaternionStart,a.worldScaleStart),a.pointStart.copy(t.point).sub(a.worldPositionStart)}a.dragging=!0,a.mouseDownEvent.mode=a.mode,a.dispatchEvent(a.mouseDownEvent)}},a.pointerMove=function(e){var t=a.axis,n=a.mode,r=a.object,o=a.space;if("scale"===n?o="local":"E"!==t&&"XYZE"!==t&&"XYZ"!==t||(o="world"),void 0!==r&&null!==t&&!1!==a.dragging&&-1===e.button){a.raycaster.setFromCamera(e,a.camera);var i=a.intersectObjectWithRay(a.plane,a.raycaster,!0);if(i){if(a.pointEnd.copy(i.point).sub(a.worldPositionStart),"translate"===n)a.offset.copy(a.pointEnd).sub(a.pointStart),"local"===o&&"XYZ"!==t&&a.offset.applyQuaternion(a.worldQuaternionInv),-1===t.indexOf("X")&&(a.offset.x=0),-1===t.indexOf("Y")&&(a.offset.y=0),-1===t.indexOf("Z")&&(a.offset.z=0),"local"===o&&"XYZ"!==t?a.offset.applyQuaternion(a.quaternionStart).divide(a.parentScale):a.offset.applyQuaternion(a.parentQuaternionInv).divide(a.parentScale),r.position.copy(a.offset).add(a.positionStart),a.translationSnap&&("local"===o&&(r.position.applyQuaternion(a.tempQuaternion.copy(a.quaternionStart).invert()),-1!==t.search("X")&&(r.position.x=Math.round(r.position.x/a.translationSnap)*a.translationSnap),-1!==t.search("Y")&&(r.position.y=Math.round(r.position.y/a.translationSnap)*a.translationSnap),-1!==t.search("Z")&&(r.position.z=Math.round(r.position.z/a.translationSnap)*a.translationSnap),r.position.applyQuaternion(a.quaternionStart)),"world"===o&&(r.parent&&r.position.add(a.tempVector.setFromMatrixPosition(r.parent.matrixWorld)),-1!==t.search("X")&&(r.position.x=Math.round(r.position.x/a.translationSnap)*a.translationSnap),-1!==t.search("Y")&&(r.position.y=Math.round(r.position.y/a.translationSnap)*a.translationSnap),-1!==t.search("Z")&&(r.position.z=Math.round(r.position.z/a.translationSnap)*a.translationSnap),r.parent&&r.position.sub(a.tempVector.setFromMatrixPosition(r.parent.matrixWorld))));else if("scale"===n){if(-1!==t.search("XYZ")){var l=a.pointEnd.length()/a.pointStart.length();a.pointEnd.dot(a.pointStart)<0&&(l*=-1),a.tempVector2.set(l,l,l)}else a.tempVector.copy(a.pointStart),a.tempVector2.copy(a.pointEnd),a.tempVector.applyQuaternion(a.worldQuaternionInv),a.tempVector2.applyQuaternion(a.worldQuaternionInv),a.tempVector2.divide(a.tempVector),-1===t.search("X")&&(a.tempVector2.x=1),-1===t.search("Y")&&(a.tempVector2.y=1),-1===t.search("Z")&&(a.tempVector2.z=1);r.scale.copy(a.scaleStart).multiply(a.tempVector2),a.scaleSnap&&a.object&&(-1!==t.search("X")&&(a.object.scale.x=Math.round(r.scale.x/a.scaleSnap)*a.scaleSnap||a.scaleSnap),-1!==t.search("Y")&&(r.scale.y=Math.round(r.scale.y/a.scaleSnap)*a.scaleSnap||a.scaleSnap),-1!==t.search("Z")&&(r.scale.z=Math.round(r.scale.z/a.scaleSnap)*a.scaleSnap||a.scaleSnap))}else if("rotate"===n){a.offset.copy(a.pointEnd).sub(a.pointStart);var s=20/a.worldPosition.distanceTo(a.tempVector.setFromMatrixPosition(a.camera.matrixWorld));"E"===t?(a.rotationAxis.copy(a.eye),a.rotationAngle=a.pointEnd.angleTo(a.pointStart),a.startNorm.copy(a.pointStart).normalize(),a.endNorm.copy(a.pointEnd).normalize(),a.rotationAngle*=a.endNorm.cross(a.startNorm).dot(a.eye)<0?1:-1):"XYZE"===t?(a.rotationAxis.copy(a.offset).cross(a.eye).normalize(),a.rotationAngle=a.offset.dot(a.tempVector.copy(a.rotationAxis).cross(a.eye))*s):"X"!==t&&"Y"!==t&&"Z"!==t||(a.rotationAxis.copy(a.unit[t]),a.tempVector.copy(a.unit[t]),"local"===o&&a.tempVector.applyQuaternion(a.worldQuaternion),a.rotationAngle=a.offset.dot(a.tempVector.cross(a.eye).normalize())*s),a.rotationSnap&&(a.rotationAngle=Math.round(a.rotationAngle/a.rotationSnap)*a.rotationSnap),"local"===o&&"E"!==t&&"XYZE"!==t?(r.quaternion.copy(a.quaternionStart),r.quaternion.multiply(a.tempQuaternion.setFromAxisAngle(a.rotationAxis,a.rotationAngle)).normalize()):(a.rotationAxis.applyQuaternion(a.parentQuaternionInv),r.quaternion.copy(a.tempQuaternion.setFromAxisAngle(a.rotationAxis,a.rotationAngle)),r.quaternion.multiply(a.quaternionStart).normalize())}a.dispatchEvent(a.changeEvent),a.dispatchEvent(a.objectChangeEvent)}}},a.pointerUp=function(e){0===e.button&&(a.dragging&&null!==a.axis&&(a.mouseUpEvent.mode=a.mode,a.dispatchEvent(a.mouseUpEvent)),a.dragging=!1,a.axis=null)},a.getPointer=function(e){var t;if(a.domElement&&(null===(t=a.domElement.ownerDocument)||void 0===t?void 0:t.pointerLockElement))return{x:0,y:0,button:e.button};var n,r=e.changedTouches?e.changedTouches[0]:e,o=null===(n=a.domElement)||void 0===n?void 0:n.getBoundingClientRect();return{x:(r.clientX-o.left)/o.width*2-1,y:-(r.clientY-o.top)/o.height*2+1,button:e.button}},a.onPointerHover=function(e){if(a.enabled)switch(e.pointerType){case"mouse":case"pen":a.pointerHover(a.getPointer(e))}},a.onPointerDown=function(e){a.enabled&&a.domElement&&(a.domElement.style.touchAction="none",a.domElement.ownerDocument.addEventListener("pointermove",a.onPointerMove),a.pointerHover(a.getPointer(e)),a.pointerDown(a.getPointer(e)))},a.onPointerMove=function(e){a.enabled&&a.pointerMove(a.getPointer(e))},a.onPointerUp=function(e){a.enabled&&a.domElement&&(a.domElement.style.touchAction="",a.domElement.ownerDocument.removeEventListener("pointermove",a.onPointerMove),a.pointerUp(a.getPointer(e)))},a.getMode=function(){return a.mode},a.setMode=function(e){a.mode=e},a.setTranslationSnap=function(e){a.translationSnap=e},a.setRotationSnap=function(e){a.rotationSnap=e},a.setScaleSnap=function(e){a.scaleSnap=e},a.setSize=function(e){a.size=e},a.setSpace=function(e){a.space=e},a.update=function(){console.warn("THREE.TransformControls: update function has no more functionality and therefore has been deprecated.")},a.connect=function(e){e===document&&console.error('THREE.OrbitControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.'),a.domElement=e,a.domElement.addEventListener("pointerdown",a.onPointerDown),a.domElement.addEventListener("pointermove",a.onPointerHover),a.domElement.ownerDocument.addEventListener("pointerup",a.onPointerUp)},a.dispose=function(){var e,t,n,r,o,i;null===(e=a.domElement)||void 0===e||e.removeEventListener("pointerdown",a.onPointerDown),null===(t=a.domElement)||void 0===t||t.removeEventListener("pointermove",a.onPointerHover),null===(n=a.domElement)||void 0===n||null===(r=n.ownerDocument)||void 0===r||r.removeEventListener("pointermove",a.onPointerMove),null===(o=a.domElement)||void 0===o||null===(i=o.ownerDocument)||void 0===i||i.removeEventListener("pointerup",a.onPointerUp),a.traverse((function(e){var t=e;t.geometry&&t.geometry.dispose(),t.material&&t.material.dispose()}))},a.domElement=i,a.camera=r,a.gizmo=new Xa(e,l),a.add(a.gizmo),a.plane=new Fa,a.add(a.plane);var s=function(e,t){var n=t;Object.defineProperty(La(a),e,{get:function(){return void 0!==n?n:t},set:function(t){n!==t&&(n=t,this.plane[e]=t,this.gizmo[e]=t,this.dispatchEvent({type:e+"-changed",value:t}),this.dispatchEvent(this.changeEvent))}}),a[e]=t,a.plane[e]=t,a.gizmo[e]=t};return s("camera",a.camera),s("object",a.object),s("enabled",a.enabled),s("axis",a.axis),s("mode",a.mode),s("translationSnap",a.translationSnap),s("rotationSnap",a.rotationSnap),s("scaleSnap",a.scaleSnap),s("space",a.space),s("size",a.size),s("dragging",a.dragging),s("showX",a.showX),s("showY",a.showY),s("showZ",a.showZ),s("worldPosition",a.worldPosition),s("worldPositionStart",a.worldPositionStart),s("worldQuaternion",a.worldQuaternion),s("worldQuaternionStart",a.worldQuaternionStart),s("cameraPosition",a.cameraPosition),s("cameraQuaternion",a.cameraQuaternion),s("pointStart",a.pointStart),s("pointEnd",a.pointEnd),s("rotationAxis",a.rotationAxis),s("rotationAngle",a.rotationAngle),s("eye",a.eye),void 0!==i&&a.connect(i),a}return n}(o.Object3D),Xa=function(e){qa(n,e);var t=Qa(n);function n(e,r){var i;Da(this,n),(i=t.call(this)).isTransformControlsGizmo=!0,i.type="TransformControlsGizmo",i.tempVector=new o.Vector3(0,0,0),i.tempEuler=new o.Euler,i.alignVector=new o.Vector3(0,1,0),i.zeroVector=new o.Vector3(0,0,0),i.lookAtMatrix=new o.Matrix4,i.tempQuaternion=new o.Quaternion,i.tempQuaternion2=new o.Quaternion,i.identityQuaternion=new o.Quaternion,i.unitX=new o.Vector3(1,0,0),i.unitY=new o.Vector3(0,1,0),i.unitZ=new o.Vector3(0,0,1),i.rotationAxis=new o.Vector3,i.cameraPosition=new o.Vector3,i.worldPositionStart=new o.Vector3,i.worldQuaternionStart=new o.Quaternion,i.worldPosition=new o.Vector3,i.worldQuaternion=new o.Quaternion,i.eye=new o.Vector3,i.camera=null,i.enabled=!0,i.axis=null,i.mode="translate",i.space="world",i.size=1,i.dragging=!1,i.showX=!0,i.showY=!0,i.showZ=!0,i.updateMatrixWorld=function(){var e=function(e){var t=a[e];t.visible=!0,t.rotation.set(0,0,0),t.position.copy(i.worldPosition);var n=void 0;if(n=i.camera.isOrthographicCamera?(i.camera.top-i.camera.bottom)/i.camera.zoom:i.worldPosition.distanceTo(i.cameraPosition)*Math.min(1.9*Math.tan(Math.PI*i.camera.fov/360)/i.camera.zoom,7),t.scale.set(1,1,1).multiplyScalar(n*i.size/7),"helper"===t.tag)return t.visible=!1,"AXIS"===t.name?(t.position.copy(i.worldPositionStart),t.visible=!!i.axis,"X"===i.axis&&(i.tempQuaternion.setFromEuler(i.tempEuler.set(0,0,0)),t.quaternion.copy(r).multiply(i.tempQuaternion),Math.abs(i.alignVector.copy(i.unitX).applyQuaternion(r).dot(i.eye))>.9&&(t.visible=!1)),"Y"===i.axis&&(i.tempQuaternion.setFromEuler(i.tempEuler.set(0,0,Math.PI/2)),t.quaternion.copy(r).multiply(i.tempQuaternion),Math.abs(i.alignVector.copy(i.unitY).applyQuaternion(r).dot(i.eye))>.9&&(t.visible=!1)),"Z"===i.axis&&(i.tempQuaternion.setFromEuler(i.tempEuler.set(0,Math.PI/2,0)),t.quaternion.copy(r).multiply(i.tempQuaternion),Math.abs(i.alignVector.copy(i.unitZ).applyQuaternion(r).dot(i.eye))>.9&&(t.visible=!1)),"XYZE"===i.axis&&(i.tempQuaternion.setFromEuler(i.tempEuler.set(0,Math.PI/2,0)),i.alignVector.copy(i.rotationAxis),t.quaternion.setFromRotationMatrix(i.lookAtMatrix.lookAt(i.zeroVector,i.alignVector,i.unitY)),t.quaternion.multiply(i.tempQuaternion),t.visible=i.dragging),"E"===i.axis&&(t.visible=!1)):"START"===t.name?(t.position.copy(i.worldPositionStart),t.visible=i.dragging):"END"===t.name?(t.position.copy(i.worldPosition),t.visible=i.dragging):"DELTA"===t.name?(t.position.copy(i.worldPositionStart),t.quaternion.copy(i.worldQuaternionStart),i.tempVector.set(1e-10,1e-10,1e-10).add(i.worldPositionStart).sub(i.worldPosition).multiplyScalar(-1),i.tempVector.applyQuaternion(i.worldQuaternionStart.clone().invert()),t.scale.copy(i.tempVector),t.visible=i.dragging):(t.quaternion.copy(r),i.dragging?t.position.copy(i.worldPositionStart):t.position.copy(i.worldPosition),i.axis&&(t.visible=-1!==i.axis.search(t.name))),"continue";if(t.quaternion.copy(r),"translate"===i.mode||"scale"===i.mode){var l=.99;"X"!==t.name&&"XYZX"!==t.name||Math.abs(i.alignVector.copy(i.unitX).applyQuaternion(r).dot(i.eye))>l&&(t.scale.set(1e-10,1e-10,1e-10),t.visible=!1),"Y"!==t.name&&"XYZY"!==t.name||Math.abs(i.alignVector.copy(i.unitY).applyQuaternion(r).dot(i.eye))>l&&(t.scale.set(1e-10,1e-10,1e-10),t.visible=!1),"Z"!==t.name&&"XYZZ"!==t.name||Math.abs(i.alignVector.copy(i.unitZ).applyQuaternion(r).dot(i.eye))>l&&(t.scale.set(1e-10,1e-10,1e-10),t.visible=!1),"XY"===t.name&&Math.abs(i.alignVector.copy(i.unitZ).applyQuaternion(r).dot(i.eye))<.2&&(t.scale.set(1e-10,1e-10,1e-10),t.visible=!1),"YZ"===t.name&&Math.abs(i.alignVector.copy(i.unitX).applyQuaternion(r).dot(i.eye))<.2&&(t.scale.set(1e-10,1e-10,1e-10),t.visible=!1),"XZ"===t.name&&Math.abs(i.alignVector.copy(i.unitY).applyQuaternion(r).dot(i.eye))<.2&&(t.scale.set(1e-10,1e-10,1e-10),t.visible=!1),-1!==t.name.search("X")&&(i.alignVector.copy(i.unitX).applyQuaternion(r).dot(i.eye)<0?"fwd"===t.tag?t.visible=!1:t.scale.x*=-1:"bwd"===t.tag&&(t.visible=!1)),-1!==t.name.search("Y")&&(i.alignVector.copy(i.unitY).applyQuaternion(r).dot(i.eye)<0?"fwd"===t.tag?t.visible=!1:t.scale.y*=-1:"bwd"===t.tag&&(t.visible=!1)),-1!==t.name.search("Z")&&(i.alignVector.copy(i.unitZ).applyQuaternion(r).dot(i.eye)<0?"fwd"===t.tag?t.visible=!1:t.scale.z*=-1:"bwd"===t.tag&&(t.visible=!1))}else"rotate"===i.mode&&(i.tempQuaternion2.copy(r),i.alignVector.copy(i.eye).applyQuaternion(i.tempQuaternion.copy(r).invert()),-1!==t.name.search("E")&&t.quaternion.setFromRotationMatrix(i.lookAtMatrix.lookAt(i.eye,i.zeroVector,i.unitY)),"X"===t.name&&(i.tempQuaternion.setFromAxisAngle(i.unitX,Math.atan2(-i.alignVector.y,i.alignVector.z)),i.tempQuaternion.multiplyQuaternions(i.tempQuaternion2,i.tempQuaternion),t.quaternion.copy(i.tempQuaternion)),"Y"===t.name&&(i.tempQuaternion.setFromAxisAngle(i.unitY,Math.atan2(i.alignVector.x,i.alignVector.z)),i.tempQuaternion.multiplyQuaternions(i.tempQuaternion2,i.tempQuaternion),t.quaternion.copy(i.tempQuaternion)),"Z"===t.name&&(i.tempQuaternion.setFromAxisAngle(i.unitZ,Math.atan2(i.alignVector.y,i.alignVector.x)),i.tempQuaternion.multiplyQuaternions(i.tempQuaternion2,i.tempQuaternion),t.quaternion.copy(i.tempQuaternion)));t.visible=t.visible&&(-1===t.name.indexOf("X")||i.showX),t.visible=t.visible&&(-1===t.name.indexOf("Y")||i.showY),t.visible=t.visible&&(-1===t.name.indexOf("Z")||i.showZ),t.visible=t.visible&&(-1===t.name.indexOf("E")||i.showX&&i.showY&&i.showZ),t.material.tempOpacity=t.material.tempOpacity||t.material.opacity,t.material.tempColor=t.material.tempColor||t.material.color.clone(),t.material.color.copy(t.material.tempColor),t.material.opacity=t.material.tempOpacity,i.enabled?i.axis&&(t.name===i.axis||i.axis.split("").some((function(e){return t.name===e}))?(t.material.opacity=1,t.material.color.lerp(new o.Color(1,1,1),.5)):(t.material.opacity*=.25,t.material.color.lerp(new o.Color(1,1,1),.5))):(t.material.opacity*=.5,t.material.color.lerp(new o.Color(1,1,1),.5))},t=i.space;"scale"===i.mode&&(t="local");var r="local"===t?i.worldQuaternion:i.identityQuaternion;i.gizmo.translate.visible="translate"===i.mode,i.gizmo.rotate.visible="rotate"===i.mode,i.gizmo.scale.visible="scale"===i.mode,i.helper.translate.visible="translate"===i.mode,i.helper.rotate.visible="rotate"===i.mode,i.helper.scale.visible="scale"===i.mode;var a=[];a=(a=(a=a.concat(i.picker[i.mode].children)).concat(i.gizmo[i.mode].children)).concat(i.helper[i.mode].children);for(var l=0;l<a.length;l++)e(l);Ia((La(i),Ba(n.prototype)),"updateMatrixWorld",i).call(i)};var a=new o.MeshBasicMaterial({depthTest:r,depthWrite:r,transparent:!0,side:o.DoubleSide,fog:!1,toneMapped:!1}),l=new o.LineBasicMaterial({depthTest:r,depthWrite:r,transparent:!0,linewidth:1,fog:!1,toneMapped:!1}),s=a.clone();s.opacity=.15;var c=a.clone();c.opacity=.33;var u=a.clone();u.color.set(16711680);var p=a.clone();p.color.set(65280);var f=a.clone();f.color.set(255);var m=a.clone();m.opacity=.25;var d=m.clone();d.color.set(16776960);var h=m.clone();h.color.set(65535);var y=m.clone();y.color.set(16711935),a.clone().color.set(16776960);var v=l.clone();v.color.set(16711680);var g=l.clone();g.color.set(65280);var b=l.clone();b.color.set(255);var x=l.clone();x.color.set(65535);var w=l.clone();w.color.set(16711935);var j=l.clone();j.color.set(16776960);var S=l.clone();S.color.set(7895160);var O=j.clone();O.opacity=.25;var M=new o.CylinderGeometry(0,.05,.2,12,1,!1),P=new o.SphereGeometry(.035),E=new o.BoxGeometry(.125,.125,.125),N=new o.BufferGeometry;N.setAttribute("position",new o.Float32BufferAttribute([0,0,0,e,0,0],3));var A=function(e,t){for(var n=new o.BufferGeometry,r=[],i=0;i<=64*t;++i)r.push(0,Math.cos(i/32*Math.PI)*e,Math.sin(i/32*Math.PI)*e);return n.setAttribute("position",new o.Float32BufferAttribute(r,3)),n},k={X:[[new o.Mesh(M,u),[e,0,0],[0,0,-Math.PI/2],null,"fwd"],[new o.Mesh(M,u),[e,0,0],[0,0,Math.PI/2],null,"bwd"],[new o.Line(N,v)],[new o.Mesh(P,u)]],Y:[[new o.Mesh(M,p),[0,e,0],null,null,"fwd"],[new o.Mesh(M,p),[0,e,0],[Math.PI,0,0],null,"bwd"],[new o.Line(N,g),null,[0,0,Math.PI/2]],[new o.Mesh(P,p)]],Z:[[new o.Mesh(M,f),[0,0,e],[Math.PI/2,0,0],null,"fwd"],[new o.Mesh(M,f),[0,0,e],[-Math.PI/2,0,0],null,"bwd"],[new o.Line(N,b),null,[0,-Math.PI/2,0]],[new o.Mesh(P,f)]],XYZ:[[new o.Mesh(new o.OctahedronGeometry(.1,0),m.clone()),[0,0,0],[0,0,0]]],XY:[[new o.Mesh(new o.PlaneGeometry(.295,.295),d.clone()),[.15,.15,0]],[new o.Line(N,j),[.18,.3,0],null,[.125,1,1]],[new o.Line(N,j),[.3,.18,0],[0,0,Math.PI/2],[.125,1,1]]],YZ:[[new o.Mesh(new o.PlaneGeometry(.295,.295),h.clone()),[0,.15,.15],[0,Math.PI/2,0]],[new o.Line(N,x),[0,.18,.3],[0,0,Math.PI/2],[.125,1,1]],[new o.Line(N,x),[0,.3,.18],[0,-Math.PI/2,0],[.125,1,1]]],XZ:[[new o.Mesh(new o.PlaneGeometry(.295,.295),y.clone()),[.15,0,.15],[-Math.PI/2,0,0]],[new o.Line(N,w),[.18,0,.3],null,[.125,1,1]],[new o.Line(N,w),[.3,0,.18],[0,-Math.PI/2,0],[.125,1,1]]]},C={X:[[new o.Mesh(new o.CylinderGeometry(.1,0,e,4,1,!1),s),[.6*e,0,0],[0,0,-Math.PI/2]]],Y:[[new o.Mesh(new o.CylinderGeometry(.1,0,e,4,1,!1),s),[0,.6*e,0]]],Z:[[new o.Mesh(new o.CylinderGeometry(.1,0,e,4,1,!1),s),[0,0,.6*e],[Math.PI/2,0,0]]],XYZ:[[new o.Mesh(new o.OctahedronGeometry(.2,0),s)]],XY:[[new o.Mesh(new o.PlaneGeometry(.4,.4),s),[.2,.2,0]]],YZ:[[new o.Mesh(new o.PlaneGeometry(.4,.4),s),[0,.2,.2],[0,Math.PI/2,0]]],XZ:[[new o.Mesh(new o.PlaneGeometry(.4,.4),s),[.2,0,.2],[-Math.PI/2,0,0]]]},V={START:[[new o.Mesh(new o.OctahedronGeometry(.01,2),c),null,null,null,"helper"]],END:[[new o.Mesh(new o.OctahedronGeometry(.01,2),c),null,null,null,"helper"]],DELTA:[[new o.Line(function(){var e=new o.BufferGeometry;return e.setAttribute("position",new o.Float32BufferAttribute([0,0,0,1,1,1],3)),e}(),c),null,null,null,"helper"]],X:[[new o.Line(N,c.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new o.Line(N,c.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new o.Line(N,c.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},z={X:[[new o.Line(A(1,.5),v)],[new o.Mesh(new o.OctahedronGeometry(.04,0),u),[0,0,.99],null,[1,3,1]]],Y:[[new o.Line(A(1,.5),g),null,[0,0,-Math.PI/2]],[new o.Mesh(new o.OctahedronGeometry(.04,0),p),[0,0,.99],null,[3,1,1]]],Z:[[new o.Line(A(1,.5),b),null,[0,Math.PI/2,0]],[new o.Mesh(new o.OctahedronGeometry(.04,0),f),[.99,0,0],null,[1,3,1]]],E:[[new o.Line(A(1.25,1),O),null,[0,Math.PI/2,0]],[new o.Mesh(new o.CylinderGeometry(.03,0,.15,4,1,!1),O),[1.17,0,0],[0,0,-Math.PI/2],[1,1,.001]],[new o.Mesh(new o.CylinderGeometry(.03,0,.15,4,1,!1),O),[-1.17,0,0],[0,0,Math.PI/2],[1,1,.001]],[new o.Mesh(new o.CylinderGeometry(.03,0,.15,4,1,!1),O),[0,-1.17,0],[Math.PI,0,0],[1,1,.001]],[new o.Mesh(new o.CylinderGeometry(.03,0,.15,4,1,!1),O),[0,1.17,0],[0,0,0],[1,1,.001]]],XYZE:[[new o.Line(A(1,1),S),null,[0,Math.PI/2,0]]]},T={AXIS:[[new o.Line(N,c.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]]},L={X:[[new o.Mesh(new o.TorusGeometry(1,.1,4,24),s),[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],Y:[[new o.Mesh(new o.TorusGeometry(1,.1,4,24),s),[0,0,0],[Math.PI/2,0,0]]],Z:[[new o.Mesh(new o.TorusGeometry(1,.1,4,24),s),[0,0,0],[0,0,-Math.PI/2]]],E:[[new o.Mesh(new o.TorusGeometry(1.25,.1,2,24),s)]],XYZE:[[new o.Mesh(new o.SphereGeometry(.7,10,8),s)]]},D={X:[[new o.Mesh(E,u),[.8,0,0],[0,0,-Math.PI/2]],[new o.Line(N,v),null,null,[.8,1,1]]],Y:[[new o.Mesh(E,p),[0,.8,0]],[new o.Line(N,g),null,[0,0,Math.PI/2],[.8,1,1]]],Z:[[new o.Mesh(E,f),[0,0,.8],[Math.PI/2,0,0]],[new o.Line(N,b),null,[0,-Math.PI/2,0],[.8,1,1]]],XY:[[new o.Mesh(E,d),[.85,.85,0],null,[2,2,.2]],[new o.Line(N,j),[.855,.98,0],null,[.125,1,1]],[new o.Line(N,j),[.98,.855,0],[0,0,Math.PI/2],[.125,1,1]]],YZ:[[new o.Mesh(E,h),[0,.85,.85],null,[.2,2,2]],[new o.Line(N,x),[0,.855,.98],[0,0,Math.PI/2],[.125,1,1]],[new o.Line(N,x),[0,.98,.855],[0,-Math.PI/2,0],[.125,1,1]]],XZ:[[new o.Mesh(E,y),[.85,0,.85],null,[2,.2,2]],[new o.Line(N,w),[.855,0,.98],null,[.125,1,1]],[new o.Line(N,w),[.98,0,.855],[0,-Math.PI/2,0],[.125,1,1]]],XYZX:[[new o.Mesh(new o.BoxGeometry(.125,.125,.125),m.clone()),[1.1,0,0]]],XYZY:[[new o.Mesh(new o.BoxGeometry(.125,.125,.125),m.clone()),[0,1.1,0]]],XYZZ:[[new o.Mesh(new o.BoxGeometry(.125,.125,.125),m.clone()),[0,0,1.1]]]},I={X:[[new o.Mesh(new o.CylinderGeometry(.2,0,.8,4,1,!1),s),[.5,0,0],[0,0,-Math.PI/2]]],Y:[[new o.Mesh(new o.CylinderGeometry(.2,0,.8,4,1,!1),s),[0,.5,0]]],Z:[[new o.Mesh(new o.CylinderGeometry(.2,0,.8,4,1,!1),s),[0,0,.5],[Math.PI/2,0,0]]],XY:[[new o.Mesh(E,s),[.85,.85,0],null,[3,3,.2]]],YZ:[[new o.Mesh(E,s),[0,.85,.85],null,[.2,3,3]]],XZ:[[new o.Mesh(E,s),[.85,0,.85],null,[3,.2,3]]],XYZX:[[new o.Mesh(new o.BoxGeometry(.2,.2,.2),s),[1.1,0,0]]],XYZY:[[new o.Mesh(new o.BoxGeometry(.2,.2,.2),s),[0,1.1,0]]],XYZZ:[[new o.Mesh(new o.BoxGeometry(.2,.2,.2),s),[0,0,1.1]]]},B={X:[[new o.Line(N,c.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new o.Line(N,c.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new o.Line(N,c.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},q=function(e){var t=new o.Object3D;for(var n in e)for(var r=e[n].length;r--;){var i=e[n][r][0].clone(),a=e[n][r][1],l=e[n][r][2],s=e[n][r][3],c=e[n][r][4];i.name=n,i.tag=c,a&&i.position.set(a[0],a[1],a[2]),l&&i.rotation.set(l[0],l[1],l[2]),s&&i.scale.set(s[0],s[1],s[2]),i.updateMatrix();var u=i.geometry.clone();u.applyMatrix4(i.matrix),i.geometry=u,i.renderOrder=1/0,i.position.set(0,0,0),i.rotation.set(0,0,0),i.scale.set(1,1,1),t.add(i)}return t};return i.gizmo={},i.picker={},i.helper={},i.add(i.gizmo.translate=q(k)),i.add(i.gizmo.rotate=q(z)),i.add(i.gizmo.scale=q(D)),i.add(i.picker.translate=q(C)),i.add(i.picker.rotate=q(L)),i.add(i.picker.scale=q(I)),i.add(i.helper.translate=q(V)),i.add(i.helper.rotate=q(T)),i.add(i.helper.scale=q(B)),i.picker.translate.visible=!1,i.picker.rotate.visible=!1,i.picker.scale.visible=!1,i}return n}(o.Object3D),Fa=function(e){qa(n,e);var t=Qa(n);function n(){var e;return Da(this,n),(e=t.call(this,new o.PlaneGeometry(1e5,1e5,2,2),new o.MeshBasicMaterial({visible:!1,wireframe:!0,side:o.DoubleSide,transparent:!0,opacity:.1,toneMapped:!1}))).isTransformControlsPlane=!0,e.type="TransformControlsPlane",e.unitX=new o.Vector3(1,0,0),e.unitY=new o.Vector3(0,1,0),e.unitZ=new o.Vector3(0,0,1),e.tempVector=new o.Vector3,e.dirVector=new o.Vector3,e.alignVector=new o.Vector3,e.tempMatrix=new o.Matrix4,e.identityQuaternion=new o.Quaternion,e.cameraQuaternion=new o.Quaternion,e.worldPosition=new o.Vector3,e.worldQuaternion=new o.Quaternion,e.eye=new o.Vector3,e.axis=null,e.mode="translate",e.space="world",e.updateMatrixWorld=function(){var t=e.space;switch(e.position.copy(e.worldPosition),"scale"===e.mode&&(t="local"),e.unitX.set(1,0,0).applyQuaternion("local"===t?e.worldQuaternion:e.identityQuaternion),e.unitY.set(0,1,0).applyQuaternion("local"===t?e.worldQuaternion:e.identityQuaternion),e.unitZ.set(0,0,1).applyQuaternion("local"===t?e.worldQuaternion:e.identityQuaternion),e.alignVector.copy(e.unitY),e.mode){case"translate":case"scale":switch(e.axis){case"X":e.alignVector.copy(e.eye).cross(e.unitX),e.dirVector.copy(e.unitX).cross(e.alignVector);break;case"Y":e.alignVector.copy(e.eye).cross(e.unitY),e.dirVector.copy(e.unitY).cross(e.alignVector);break;case"Z":e.alignVector.copy(e.eye).cross(e.unitZ),e.dirVector.copy(e.unitZ).cross(e.alignVector);break;case"XY":e.dirVector.copy(e.unitZ);break;case"YZ":e.dirVector.copy(e.unitX);break;case"XZ":e.alignVector.copy(e.unitZ),e.dirVector.copy(e.unitY);break;case"XYZ":case"E":e.dirVector.set(0,0,0)}break;default:e.dirVector.set(0,0,0)}0===e.dirVector.length()?e.quaternion.copy(e.cameraQuaternion):(e.tempMatrix.lookAt(e.tempVector.set(0,0,0),e.dirVector,e.alignVector),e.quaternion.setFromRotationMatrix(e.tempMatrix)),Ia((La(e),Ba(n.prototype)),"updateMatrixWorld",e).call(e)},e}return n}(o.Mesh);function Ya(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Ua(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function Wa(e,t,n){return Wa=Ua()?Reflect.construct:function(e,t,n){var r=[null];r.push.apply(r,t);var o=new(Function.bind.apply(e,r));return n&&Ha(o,n.prototype),o},Wa.apply(null,arguments)}function Ha(e,t){return Ha=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},Ha(e,t)}function _a(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i=[],a=!0,l=!1;try{for(n=n.call(e);!(a=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);a=!0);}catch(s){l=!0,o=s}finally{try{a||null==n.return||n.return()}finally{if(l)throw o}}return i}}(e,t)||Ja(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ka(e){return function(e){if(Array.isArray(e))return Ya(e)}(e)||function(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||Ja(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ja(e,t){if(e){if("string"===typeof e)return Ya(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Ya(e,t):void 0}}function el(e){var t=e.mode,n=e.set,o=e.value,i=e.matrix,a=e.axis,l=e.child,s=e.length,c=e.depth,u=(0,yi.w)((function(e){return[e.camera,e.gl.domElement]})),p=(0,eo.useState)(null),f=p[0],m=p[1],d=_a(a,3),h=d[0],y=d[1],v=d[2],g=(0,eo.useMemo)((function(){return Wa($a,[null!==s&&void 0!==s?s:1].concat(Ka(u),[c]))}),[c,s].concat(Ka(u)));(0,eo.useEffect)((function(){if(null!=f)return g.attach(f),function(){g.detach()}}),[f,g]),(0,eo.useEffect)((function(){if(null!=g&&null!=f){var e=function(){oi.getState().setControlling(!0)},r=function(e){setTimeout((function(){return oi.getState().setControlling(!1)}));var r=f[tl[t]],o=r.x,i=r.y,a=r.z;n(o,i,a)};return g.addEventListener("mouseDown",e),g.addEventListener("mouseUp",r),function(){oi.getState().setControlling(!1),g.removeEventListener("mouseUp",e),g.removeEventListener("mouseDown",r)}}}),[n,t,f]),null!=f&&f[tl[t]].fromArray(o);var b=(0,yi.w)((function(e){return e.scene}));return(0,r.jsxs)("group",{matrixAutoUpdate:!1,matrix:i,children:[null!=f&&(0,yi.g)((0,r.jsx)("primitive",{showX:h,showY:y,showZ:v,mode:t,space:"local",object:g}),b),(0,r.jsx)("group",{ref:m,children:null!=l&&(0,r.jsx)("primitive",{object:l})})]})}var tl={rotate:"rotation",scale:"scale",translate:"position"},nl=[!0,!0,!0],rl=[!0,!1,!0];function ol(e){var t=e.substepValue,n=e.getSubstep,o=e.valueRef,i=e.matrix,a=Ao(),l="raw"===t.children[0].type?t.children[0].value:0,s="raw"===t.children[1].type?t.children[1].value:0,c="raw"===t.children[2].type?t.children[2].value:0;return(0,r.jsx)(el,{value:[l,s,c],axis:nl,matrix:i,mode:"translate",set:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return a.getState().replace((function(e){(null==n?e:n(e)).children=t.map((function(e){return{type:"raw",value:e}}))}),o.current)}})}function il(e){var t=e.substepValue,n=e.getSubstep,o=e.valueRef,i=e.matrix,a=Ao(),l="raw"===t.children[0].type?t.children[0].value:0,s="raw"===t.children[1].type?t.children[1].value:0;return(0,r.jsx)(el,{value:[l,0,s],axis:rl,matrix:i,mode:"translate",set:function(e,t,r){return a.getState().replace((function(t){(null==n?t:n(t)).children=[e,r].map((function(e){return{type:"raw",value:e}}))}),o.current)}})}function al(e){var t=e.value,n=e.valueRef,o=e.matrix;return(0,r.jsx)(r.Fragment,{children:t.children.map((function(e,t){return"operation"===e.type&&(0,r.jsx)(ll,{matrix:o,valueRef:n,child:e,index:t},t)}))})}function ll(e){var t=e.index,n=e.child,o=e.valueRef,i=e.matrix,a=(0,eo.useCallback)((function(e){return H("operation",e.children[t])}),[t]);return"point3"===n.identifier?(0,r.jsx)(ol,{matrix:i,valueRef:o,getSubstep:a,substepValue:n}):(0,r.jsx)(il,{matrix:i,valueRef:o,getSubstep:a,substepValue:n})}function sl(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function cl(e){return function(e){if(Array.isArray(e))return sl(e)}(e)||function(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"===typeof e)return sl(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return sl(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var ul=[!1,!0,!1],pl=[!0,!0,!0];function fl(e){var t=e.description,n=Ao()((function(e){return"gui"===e.type&&null==e.requested?e.selectionsList.filter((function(e){return T(t,pr(e.steps)[0])})):void 0}),W);return null==n?null:(0,r.jsx)(r.Fragment,{children:n.map((function(e){return(0,r.jsx)(dl,{values:e.values,step:e.steps},ur(e.steps))}))})}function ml(e){return e}function dl(e){var t=e.step,n=e.values;if("string"==typeof t||"operation"!=t.type)return null;var o=n.map((function(e){return e.before.raw})).filter((function(e,t,n){return n.indexOf(e)===t})).filter(hl),i=(0,eo.useMemo)((function(){return{current:t}}),[]);switch(i.current=t,t.identifier){case"point3":return(0,r.jsx)(r.Fragment,{children:o.map((function(e,n){return(0,r.jsx)(ol,{matrix:e.matrix,valueRef:i,getSubstep:ml,substepValue:t},n)}))});case"point2":return(0,r.jsx)(r.Fragment,{children:o.map((function(e,n){return(0,r.jsx)(il,{matrix:e.matrix,valueRef:i,getSubstep:ml,substepValue:t},n)}))});case"face":case"line":return(0,r.jsx)(r.Fragment,{children:o.map((function(e,n){return(0,r.jsx)(al,{matrix:e.matrix,valueRef:i,value:t},n)}))});case"translate":return(0,r.jsx)(r.Fragment,{children:o.map((function(e,n){return(0,r.jsx)(Sl,{value:e,step:t},n)}))});case"split":return(0,r.jsx)(r.Fragment,{children:o.map((function(e,n){return(0,r.jsx)(gl,{value:e,step:t},n)}))});case"extrude":return(0,r.jsx)(r.Fragment,{children:o.map((function(e,n){return(0,r.jsx)(jl,{value:e,step:t},n)}))});default:return null}}function hl(e){return t=e,null!=(n=Ae)&&"undefined"!==typeof Symbol&&n[Symbol.hasInstance]?!!n[Symbol.hasInstance](t):t instanceof n;var t,n}var yl=new o.Box3,vl=new o.Vector3;function gl(e){for(var t=e.value,n=e.step,o=Ao(),i="raw"===n.children[0].type?n.children[0].value:"x",a=xl[i],l=wl[i],c=n.children.length-2,p=new Array(c),f=new Array(c),m=(0,eo.useMemo)((function(){return t.getBoundingBox(yl),yl.getCenter(vl),vl[i]=yl.min[i],vl.toArray()}),[t]),d=m[0],h=m[1],y=m[2],v=(0,eo.useMemo)((function(){var e=t.getOutline().clone();e.matrix.copy(s(-d,-h,-y));var n=[1,1,1];return n[a]=0,e.matrix.multiply(u.apply(void 0,cl(n))),e}),[t,a,d,h,y]),g=0,b=0;b<n.children.length-2;b++){var x=n.children[b+2],w="raw"===x.type?x.value:0;p[b]=w,f[b]=g,g+=w}var j=(0,eo.useRef)([]);return(0,eo.useEffect)((function(){for(;j.current.length<c;)j.current.push(v.clone());j.current.splice(c,Number.MAX_SAFE_INTEGER)}),[v,c]),(0,r.jsx)(r.Fragment,{children:p.map((function(e,i){return(0,r.jsx)(bl,{index:i,axisEnabled:l,axisIndex:a,matrix:t.matrix,offset:f[i],outline:v,size:e,step:n,store:o,x:d,y:h,z:y},i)}))})}function bl(e){var t=e.size,n=e.offset,o=e.x,i=e.y,a=e.z,l=e.axisEnabled,s=e.axisIndex,c=e.matrix,u=e.outline,p=e.store,f=e.step,m=e.index,d=(0,eo.useMemo)((function(){return u.clone()}),[u]);return(0,eo.useMemo)((function(){var e=[o,i,a];return e[s]+=t+n,(0,r.jsx)(el,{length:.3,value:e,axis:l,matrix:c,depth:!0,child:d,mode:"translate",set:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return p.getState().replace((function(e){e.children[m+2]={type:"raw",value:Math.max(0,t[s]-n)}}),f)}})}),[m,t,n,o,i,a,l,s,c,d,p,f])}var xl={x:0,y:1,z:2},wl={x:[!0,!1,!1],y:[!1,!0,!1],z:[!1,!1,!0]};function jl(e){var t=e.value,n=e.step,o=Ao(),i="raw"===n.children[0].type?n.children[0].value:0,a=(0,eo.useMemo)((function(){return t.getBoundingBox(yl),yl.getCenter(vl),vl.toArray()}),[t]),l=a[0],c=a[1],u=a[2],p=(0,eo.useMemo)((function(){var e=t.getOutline().clone();return e.matrix.copy(s(-l,-c,-u)),e}),[t,l,c,u]);return(0,r.jsx)(el,{value:[l,i+c,u],axis:ul,matrix:t.matrix,mode:"translate",child:p,set:function(e,t,r){return o.getState().replace((function(e){e.children=[{type:"raw",value:t-c}]}),n)}})}function Sl(e){var t=e.value,n=e.step,o=Ao(),i="raw"===n.children[0].type?n.children[0].value:0,a="raw"===n.children[1].type?n.children[1].value:0,l="raw"===n.children[2].type?n.children[2].value:0,c=(0,eo.useMemo)((function(){return t.getBoundingBox(yl),yl.getCenter(vl),vl.toArray()}),[t]),u=c[0],p=c[1],f=c[2],m=(0,eo.useMemo)((function(){var e=t.getOutline().clone();return e.matrix.copy(s(-u,-p,-f)),e}),[t,u,p,f]);return(0,r.jsx)(el,{value:[u+i,p+a,f+l],axis:pl,matrix:t.matrix,mode:"translate",child:m,set:function(e,t,r){return o.getState().replace((function(n){n.children=[{type:"raw",value:e-u},{type:"raw",value:t-p},{type:"raw",value:r-f}]}),n)}})}function Ol(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Ml(e,t){return null!=t&&"undefined"!==typeof Symbol&&t[Symbol.hasInstance]?!!t[Symbol.hasInstance](e):e instanceof t}function Pl(e){return function(e){if(Array.isArray(e))return Ol(e)}(e)||function(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"===typeof e)return Ol(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Ol(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var El=new ke(new o.Matrix4,Se(new o.Color(16711680)));function Nl(e){var t=vs(e.x,e.y),n=ko((function(e){return e.descriptions.filter((function(e){return e.name.endsWith(t)}))}),W);return(0,r.jsx)(r.Fragment,{children:n.map((function(e){var t=e.seed,n=e.name;return(0,r.jsx)(Al,{seed:t,name:n},n)}))})}function Al(e){var t=e.seed,n=e.name,o=Ao(),i=o((function(e){return e.selectedDescriptions.includes(n)})),a=o((function(e){var t;return null===(t=e.grammar.find((function(e){var t=e.name;return T(n,t)})))||void 0===t?void 0:t.name}));return null==a?null:i?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(fl,{description:n}),(0,r.jsx)(Tl,{rootNode:a}),(0,r.jsx)(Ll,{seed:t,name:n}),(0,r.jsx)(kl,{description:n})]}):(0,r.jsx)(zl,{seed:t,name:n})}function kl(e){var t=e.description,n=Ao()((function(e){if("gui"===e.type)return Array.from(new Set((null!=e.hovered?e.selectionsList.concat(e.hovered):e.selectionsList).filter((function(e){var n=e.steps;return T(t,pr(n)[0])})).reduce((function(e,t){return e.concat(t.values.filter((function(e){return null!=e.object})).map((function(e){return e.object})))}),[])))}),W);return null==n?null:(0,r.jsx)(r.Fragment,{children:n.map((function(e){return(0,r.jsx)(Cl,{object:e,colorAdd:.25},e.uuid)}))})}function Cl(e){var t=e.object,n=e.colorAdd;return(0,eo.useEffect)((function(){return t.traverse((function(e){"material"in e&&e.material.color.addScalar(n)})),function(){t.traverse((function(e){"material"in e&&e.material.color.addScalar(-n)}))}}),[t]),null}function Vl(e,t){return e((function(e){return"gui"===e.type?z(e.grammar,e.dependencyMap,t):void 0}),W)}function zl(e){var t=e.name,n=e.seed,o=(0,eo.useRef)(null),i=Ao();return function(e,t,n){var r=Ao();(0,eo.useEffect)((function(){if(null!=n.current&&null!=e){var o=Hr((0,ot.of)(El).pipe(an(),en(e,Wr,{delay:r.getState().interpretationDelay,seed:t})),n.current,(function(e){return oi.getState().setError(void 0),e.raw.getObject()}),(function(e){console.error(e),oi.getState().setError(e.message)}));return function(){var e,t;null===(t=n.current)||void 0===t||(e=t).remove.apply(e,Pl(n.current.children)),o.unsubscribe()}}}),[r,e,t])}(Vl(i,t),n,o),(0,r.jsx)("group",{onClick:function(e){var n;null==e.intersections[0].object.userData.steps&&(e.stopPropagation(),i.getState().selectDescription(t,null!==(n=i.getState().shift)&&void 0!==n&&n))},ref:o})}function Tl(e){var t=e.rootNode,n=Ao()((function(e){var n;if("gui"===e.type)return null===(n=e.valueMap[t])||void 0===n?void 0:n.filter((function(e){return Ml(e.after.raw,Ae)})).map((function(e){return e.after.raw.getOutline()}))}),W);return null==n?null:(0,r.jsx)(r.Fragment,{children:n.map((function(e){return(0,r.jsx)("primitive",{object:e},e.uuid)}))})}function Ll(e){var t=e.name,n=e.seed,o=Ao(),i=Vl(o,t),a=(0,eo.useRef)(null);return function(e,t,n,r){var o=Ao();(0,eo.useEffect)((function(){if(null!=r.current&&null!=e){var i,a=new Map,l=new Map,s=new Sa.x,c=s.pipe(Xt(300)).subscribe((function(e){return o.getState().editIndices(e,!0)}));try{i=Hr((0,ot.of)(El).pipe(an(),en(e,Wr,{delay:o.getState().interpretationDelay,seed:n,listeners:{onAfterStep:function(e,t){var n=a.get(e),r=null===n||void 0===n?void 0:n.find((function(e){var n=U(t.index,e.index);return n===Y.Predecessor||n===Y.Equal}));null!=r&&s.next({steps:e,value:{after:t,before:r,object:Ml(t.raw,Ae)?t.raw.getObject():void 0}});var o=t.index.join(","),i=l.get(o);null!=i&&(i.path[0]!==e.path[0]||function(e,t){if(e===t)return!0;if(e.length<t.length)return!1;for(var n=0;n<t.length;n++)if(e[n]!=t[n])return!1;return!0}(i.path,e.path)&&ca(Ta,e))||l.set(o,e)},onBeforeStep:function(e,t){var n=a.get(e);if(null==n&&(n=[],a.set(e,n)),n.push(t),"symbol"===e.type){var r=t.index.join(",");l.delete(r)}}}})),r.current,(function(e){var t=l.get(e.index.join(",")),n=e.raw.getObject();if(null!=t){var r=a.get(t),o=null===r||void 0===r?void 0:r.find((function(t){var n=U(e.index,t.index);return n===Y.Predecessor||n===Y.Equal}));if(null!=o&&null!=t){var i={after:e,before:o,object:n};n.traverse((function(e){e.userData.steps=t,e.userData.value=i}))}}return n}),(function(e){console.error(e),oi.getState().setError(e.message)}))}catch(u){oi.getState().setError(u.message)}return function(){var e,n;o.getState().clearValueMap(t),null===(n=r.current)||void 0===n||(e=n).remove.apply(e,Pl(r.current.children)),null===i||void 0===i||i.unsubscribe(),null===c||void 0===c||c.unsubscribe()}}}),[o,e,n])}(i,t,n,a),null==i?null:(0,r.jsx)("object3D",{onPointerMove:function(e){if(0!==e.intersections.length){var t=e.intersections[0].object,n=t.userData.steps,r=t.userData.value;null!=n&&null!=r&&(e.stopPropagation(),o.getState().onStartHover(n,[r]))}},onPointerOut:function(e){var t=e.object,n=t.userData.steps,r=t.userData.value;null!=n&&null!=r&&(e.stopPropagation(),o.getState().onEndHover(n))},onClick:function(e){var t=e.intersections[0].object,n=t.userData.steps,r=t.userData.value;if(null!=n&&null!=r){e.stopPropagation();var i=o.getState();"gui"==i.type&&null==i.requested&&o.getState().selectResult(n,r)}},ref:a})}function Dl(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Il(e){return function(e){if(Array.isArray(e))return Dl(e)}(e)||function(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"===typeof e)return Dl(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Dl(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var Bl=Il(Gl(77188,98509,77198,98516,18)).concat(Il(Gl(137374,88769,137385,88778,18))),ql=new Set(Bl.map((function(e){var t=e.x,n=e.y,r=e.zoom;return"".concat(r,"/").concat(t,"/").concat(n)})));function Gl(e,t,n,r,o){var i=r+1-t;return new Array((n+1-e)*i).fill(void 0).map((function(n,r){return{x:e+Math.floor(r/i),y:t+r%i,zoom:o}}))}function Rl(e,t,n,r){if(function(e,t,n){return ql.has("".concat(e,"/").concat(t,"/").concat(n))}(e,t,n))return"/cgv/tiles/_".concat(e,"-").concat(t,"-").concat(n,".").concat(r)}function Zl(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Ql(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i=[],a=!0,l=!1;try{for(n=n.call(e);!(a=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);a=!0);}catch(s){l=!0,o=s}finally{try{a||null==n.return||n.return()}finally{if(l)throw o}}return i}}(e,t)||function(e,t){if(!e)return;if("string"===typeof e)return Zl(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Zl(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function $l(e){var t=e.tile,n=(0,yi.w)().size,o=Ql(oi((function(e){var t=Ql(ii(e),3),r=t[0],o=t[1],i=t[2];if("satelite"!==e.viewType){var a=He(0,18),l=Math.floor(a*r),s=Math.floor(a*i);return[l,s,l-1,s-1,l+1,s+1,18]}return function(e,t,n,r,o){var i=He(0,18),a=Math.tan(r/180*Math.PI/2)*t,l=a*o,s=Math.floor(i*e),c=Math.floor(i*n),u=ei(e-l,0,1),p=ei(e+l,0,1),f=ei(n-a,0,1),m=ei(n+a,0,1);return[s,c,Math.floor(i*u),Math.floor(i*f),Math.floor(i*p),Math.floor(i*m),18]}(r,o,i,60,n.width/n.height)}),W),7),i=o[0],a=o[1],l=o[2],s=o[3],c=o[4],u=o[5],p=o[6],f=c+1-l,m=u+1-s;return(0,r.jsx)(r.Fragment,{children:new Array(f*m).fill(null).map((function(e,n){var o=l+Math.floor(n/m),c=s+n%m;return(0,r.jsx)(t,{highlighted:o===i&&c===a,x:o,y:c,zoom:p},"".concat(o,"/").concat(c))}))})}function Xl(e,t,n){return(0,eo.useMemo)((function(){var r=He(0,n);return{position:[e/r,0,t/r],scale:1/(We(t,n)*r)}}),[e,t,n])}function Fl(e){var t=e.x,n=e.y,o=e.zoom,i=Xl(t,n,o),a=i.position,l=i.scale;return 18!=o?null:(0,eo.useMemo)((function(){return(0,r.jsx)("group",{scale:l,position:a,children:(0,r.jsx)(Nl,{x:t,y:n})})}),[t,n,l,a])}function Yl(e){var t=e.x,n=e.y,o=e.zoom,i=e.highlighted,a=Jo(oi((function(e){return"panorama"!==e.viewType?e.visualType:0}))),l=Xl(t,n,o),s=l.position,c=l.scale,u=Rl(o,t,n,"png");return 0===a||null==u?null:(0,r.jsx)("group",{scale:c,position:s,children:(0,r.jsx)(eo.Suspense,{fallback:null,children:(0,r.jsx)(Wl,{highlighted:i,url:u,y:n,zoom:o})})})}var Ul=new o.PlaneBufferGeometry(1,1);function Wl(e){var t=e.url,n=e.y,i=e.zoom,a=e.highlighted,l=(0,yi.z)(o.TextureLoader,t),s=We(n,i);return(0,r.jsx)("mesh",{scale:[s,1,s],geometry:Ul,position:[0,0,0],children:(0,r.jsx)("meshBasicMaterial",{color:a?16777215:12303291,side:o.DoubleSide,depthWrite:!1,depthTest:!1,map:l})})}Ul.translate(.5,-.5,0),Ul.rotateX(-Math.PI/2);var Hl=n(5769),_l=new o.SphereBufferGeometry(500,60,40);function Kl(){var e=oi((function(e){var t=e.viewType,n=e.panoramaIndex;return"panorama"===t?n:void 0})),t=Jo(oi((function(e){return"panorama"===e.viewType?e.visualType:0}))),n=null!=e?zo[e]:void 0;return null==n||0===t?null:(0,r.jsx)(eo.Suspense,{fallback:null,children:(0,r.jsx)(Jl,{url:n.url,rotationOffset:n.rotationOffset/180*Math.PI})})}function Jl(e){var t=e.url,n=e.rotationOffset,i=(0,Hl.m)(t);return(0,r.jsx)("mesh",{scale:[1,1,-1],geometry:_l,"rotation-y":n,children:(0,r.jsx)("meshBasicMaterial",{depthWrite:!1,depthTest:!1,map:i,side:o.DoubleSide})})}function es(){return(0,r.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",className:"bi bi-download",viewBox:"0 0 16 16",children:[(0,r.jsx)("path",{d:"M.5 9.9a.5.5 0 0 1 .5.5v2.5a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-2.5a.5.5 0 0 1 1 0v2.5a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2v-2.5a.5.5 0 0 1 .5-.5z"}),(0,r.jsx)("path",{d:"M7.646 11.854a.5.5 0 0 0 .708 0l3-3a.5.5 0 0 0-.708-.708L8.5 10.293V1.5a.5.5 0 0 0-1 0v8.793L5.354 8.146a.5.5 0 1 0-.708.708l3 3z"})]})}function ts(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function ns(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}function rs(){var e=new o.BufferGeometry,t=new Float32Array([-1,-1,1,3,-1,1,-1,3,1]),n=new Float32Array([0,0,2,0,0,2]);return e.setAttribute("position",new o.BufferAttribute(t,3)),e.setAttribute("uv",new o.BufferAttribute(n,2)),e}function os(e){var t=e.children,n=ns(e,["children"]),o=(0,eo.useMemo)(rs,[]);return(0,r.jsx)("mesh",function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){ts(e,t,n[t])}))}return e}({geometry:o,frustumCulled:!1},n,{children:t}))}function is(){return(0,r.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",className:"bi bi-image",viewBox:"0 0 16 16",children:[(0,r.jsx)("path",{d:"M6.002 5.5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0z"}),(0,r.jsx)("path",{d:"M2.002 1a2 2 0 0 0-2 2v10a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V3a2 2 0 0 0-2-2h-12zm12 1a1 1 0 0 1 1 1v6.5l-3.777-1.947a.5.5 0 0 0-.577.093l-3.71 3.71-2.66-1.772a.5.5 0 0 0-.63.062L1.002 12V3a1 1 0 0 1 1-1h12z"})]})}function as(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function ls(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}function ss(e){var t=e.className,n=ls(e,["className"]),o=(0,eo.useState)(!1),i=o[0],a=o[1],l=(0,eo.useState)(!1),s=l[0],c=l[1],u=oi((function(e){return e.visualType}));return(0,r.jsxs)("div",function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){as(e,t,n[t])}))}return e}({},n,{className:"".concat(t," d-flex flex-column align-items-center"),children:[i&&(0,r.jsxs)("div",{style:{bottom:45},className:"rounded bg-light text-dark flex-row align-items-center px-2 border d-flex rounded position-absolute text-light",children:["+",(0,r.jsx)("input",{style:{minWidth:50},type:"range",value:u,className:"mb-0 mx-2 form-range",onChange:function(e){return oi.getState().setVisualType(e.target.valueAsNumber)},min:0,step:.01,max:1}),"-"]}),(0,r.jsx)(Si.Z,{placement:"top",onVisibleChange:c,visible:s&&!i,overlay:"Background",children:(0,r.jsx)("div",{onClick:function(){return a((function(e){return!e}))},className:"btn btn-sm ".concat(i?"btn-primary":"btn-secondary"," d-flex align-items-center"),children:(0,r.jsx)(is,{})})})]}))}function cs(){return(0,r.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",className:"bi bi-camera-reels",viewBox:"0 0 16 16",children:[(0,r.jsx)("path",{d:"M6 3a3 3 0 1 1-6 0 3 3 0 0 1 6 0zM1 3a2 2 0 1 0 4 0 2 2 0 0 0-4 0z"}),(0,r.jsx)("path",{d:"M9 6h.5a2 2 0 0 1 1.983 1.738l3.11-1.382A1 1 0 0 1 16 7.269v7.462a1 1 0 0 1-1.406.913l-3.111-1.382A2 2 0 0 1 9.5 16H2a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h7zm6 8.73V7.27l-3.5 1.555v4.35l3.5 1.556zM1 8v6a1 1 0 0 0 1 1h7.5a1 1 0 0 0 1-1V8a1 1 0 0 0-1-1H2a1 1 0 0 0-1 1z"}),(0,r.jsx)("path",{d:"M9 6a3 3 0 1 0 0-6 3 3 0 0 0 0 6zM7 3a2 2 0 1 1 4 0 2 2 0 0 1-4 0z"})]})}function us(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function ps(e,t,n,r,o,i,a){try{var l=e[i](a),s=l.value}catch(c){return void n(c)}l.done?t(s):Promise.resolve(s).then(r,o)}function fs(e){return function(){var t=this,n=arguments;return new Promise((function(r,o){var i=e.apply(t,n);function a(e){ps(i,r,o,a,l,"next",e)}function l(e){ps(i,r,o,a,l,"throw",e)}a(void 0)}))}}function ms(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function ds(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){ms(e,t,n[t])}))}return e}function hs(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}function ys(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i=[],a=!0,l=!1;try{for(n=n.call(e);!(a=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);a=!0);}catch(s){l=!0,o=s}finally{try{a||null==n.return||n.return()}finally{if(l)throw o}}return i}}(e,t)||function(e,t){if(!e)return;if("string"===typeof e)return us(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return us(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function vs(e,t){return"_".concat(e,"_").concat(t)}function gs(e,t){var n;t.stopPropagation(),t.preventDefault(),1===(null===(n=t.dataTransfer)||void 0===n?void 0:n.files.length)&&t.dataTransfer.files[0].text().then((function(t){return e.getState().import(t)}))}function bs(e){var t=e.className,o=e.children,i=hs(e,["className","children"]),a=(0,vo.j)(Eo),l=Ao(),s=(0,eo.useState)(),c=s[0],u=s[1];return(0,r.jsxs)("div",ds({onDragOver:function(e){return e.preventDefault()},onDrop:gs.bind(null,l)},i,{className:"".concat(t," position-relative"),children:[(0,r.jsx)(wo.Xz,{style:{touchAction:"none",userSelect:"none",WebkitUserSelect:"none"},events:function(e){return ds({},(0,wo.U3)(e),{priority:1,filter:function(e){return oi.getState().controlling?[]:e.sort((function(e,t){return e.distance-t.distance}))}})},dpr:null==n.g.window?1:window.devicePixelRatio,children:(0,r.jsxs)(a,{children:[(0,r.jsxs)(go.T,ds({ref:u,attach:"map"},{},{children:[(0,r.jsx)(di,{}),(0,r.jsx)(Kl,{}),(0,r.jsx)(js,{}),(0,r.jsx)($l,{tile:Yl})]})),(0,r.jsx)(bi,{}),(0,r.jsx)("ambientLight",{intensity:.5}),(0,r.jsx)("directionalLight",{position:[10,10,10],intensity:.5}),(0,r.jsx)(Vs,{}),(0,r.jsx)($l,{tile:Fl}),(0,r.jsxs)(di,{children:[null!=c&&(0,r.jsx)(Ms,{texture:c}),null!=c&&(0,r.jsx)(Ps,{texture:c})]})]})}),(0,r.jsxs)("div",{className:"d-flex flex-row justify-content-between position-absolute",style:{pointerEvents:"none",inset:0},children:[(0,r.jsxs)("div",{className:"d-flex flex-column my-3 ms-3",style:{maxWidth:200},children:[(0,r.jsx)(qo,{style:{pointerEvents:"all"},className:"mb-3"}),(0,r.jsx)(ki,{createDescriptionRequestData:function(){var e=ys(ii(oi.getState()),3),t=e[0],n=(e[1],e[2]);return{suffix:vs(Math.floor(t*Ns),Math.floor(n*Ns))}},style:{pointerEvents:"all"},className:"mb-3",children:(0,r.jsxs)("div",{className:"p-2 border-top border-1",children:[(0,r.jsx)("div",{className:"w-100 btn-sm btn btn-outline-secondary",onClick:function(){return function(e){return As.apply(this,arguments)}(l)},children:"Generate Lots"}),(0,r.jsx)("div",{className:"w-100 btn-sm btn mt-2 btn-outline-secondary",onClick:function(){return function(e){return ks.apply(this,arguments)}(l)},children:"Generate Roads"}),(0,r.jsx)(xs,{})]})}),(0,r.jsx)("div",{className:"flex-grow-1"}),(0,r.jsxs)("div",{style:{pointerEvents:"all"},className:"d-flex flex-row",children:[(0,r.jsx)(Ls,{className:"me-2"}),(0,r.jsx)(ss,{className:"me-2"}),(0,r.jsx)(Ds,{className:"me-2"}),(0,r.jsx)(zs,{className:"me-2"}),(0,r.jsx)(Ts,{className:"me-2"}),(0,r.jsx)(Cs,{})]})]}),(0,r.jsxs)("div",{className:"d-flex flex-column align-items-end m-3",children:[(0,r.jsx)(ma,{className:"bg-light border rounded shadow w-100 mb-3 overflow-hidden",style:{maxWidth:"16rem",pointerEvents:"all"}}),(0,r.jsx)("div",{className:"flex-grow-1"}),(0,r.jsx)("div",{className:"d-flex flex-row",style:{pointerEvents:"all"},children:(0,r.jsx)(ja,{className:"me-2"})})]})]}),o]}))}function xs(){var e=Ao(),t=e((function(e){return e.selectedDescriptions.length>1}));return(0,r.jsx)("div",{className:"w-100 btn-sm btn mt-2 btn-outline-secondary ".concat(t?"":"disabled"),onClick:function(){return e.getState().request("summarize",void 0,e.getState().selectedDescriptions)},children:"Summarize"})}function js(){return oi((function(e){return"fly"===e.viewType}))?(0,r.jsx)(bo.q,{turbidity:10,rayleigh:.4,mieCoefficient:.001,mieDirectionalG:.74,inclination:.62,azimuth:.13}):null}var Ss="\nuniform sampler2D map;\nuniform float opacity;\nvarying vec2 vUv;\n\nvec4 fromLinear(vec4 linearRGB)\n{\n    bvec4 cutoff = lessThan(linearRGB, vec4(0.0031308));\n    vec4 higher = vec4(1.055)*pow(linearRGB, vec4(1.0/2.4)) - vec4(0.055);\n    vec4 lower = linearRGB * vec4(12.92);\n\n    return mix(higher, lower, cutoff);\n}\n\nvoid main() {\n    vec4 textureColor = texture2D( map, vUv );\n    gl_FragColor = fromLinear(textureColor);\n    gl_FragColor.a *= opacity;\n}",Os="\nvarying vec2 vUv;\n\nvoid main() {\n    vUv = uv;\n    gl_Position = vec4(position, 1.0);\n}\n";function Ms(e){var t=e.texture,n=Jo(oi((function(e){return e.visualType}))),o=(0,eo.useMemo)((function(){return{map:{value:t},opacity:{value:0}}}),[t]);return o.opacity.value=n,(0,r.jsx)(os,{children:(0,r.jsx)("shaderMaterial",{uniforms:o,vertexShader:Os,fragmentShader:Ss,toneMapped:!0,attach:"material",depthTest:!0,depthWrite:!1,transparent:!0})})}function Ps(e){var t=e.texture,n=function(e){return Math.min(2*e-1,1)}(oi((function(e){return e.visualType}))),o=(0,eo.useMemo)((function(){return{map:{value:t},opacity:{value:0}}}),[t]);return o.opacity.value=n,(0,r.jsx)(os,{renderOrder:2e3,children:(0,r.jsx)("shaderMaterial",{uniforms:o,vertexShader:Os,fragmentShader:Ss,toneMapped:!0,attach:"material",depthTest:!1,opacity:n,depthWrite:!1,transparent:!0})})}var Es=18,Ns=He(0,Es);function As(){return(As=fs(no().mark((function e(t){var n,r,o,i,a,l,s,c,u;return no().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=ys(ii(oi.getState()),3),r=n[0],o=n[2],i=Math.floor(r*Ns),a=Math.floor(o*Ns),null!=(l=Rl(Es,i,a,"mvt"))){e.next=6;break}return e.abrupt("return");case 6:return e.next=8,_e(l,a,Es);case 8:s=e.sent,c=We(a,Es),u=tt(s,vs(i,a),"exclude",c),t.getState().addDescriptions(u);case 12:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ks(){return(ks=fs(no().mark((function e(t){var n,r,o,i,a,l,s,c,u;return no().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=ys(ii(oi.getState()),3),r=n[0],o=n[2],i=Math.floor(r*Ns),a=Math.floor(o*Ns),null!=(l=Rl(Es,i,a,"mvt"))){e.next=6;break}return e.abrupt("return");case 6:return e.next=8,_e(l,a,Es);case 8:s=e.sent,c=We(a,Es),u=Ke(s,vs(i,a),"clip",c),t.getState().addDescriptions(u);case 12:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Cs(){var e=oi((function(e){return e.error}));return null==e?null:(0,r.jsx)(Mo,{message:e,align:"left"})}function Vs(){return(0,r.jsx)(r.Fragment,{children:zo.map((function(e,t){var n=e.position;return(0,r.jsx)(xo.aL,{position:n,onClick:function(e){e.stopPropagation(),oi.getState().changePanoramaView(t)},scale:3e-8,children:(0,r.jsx)("meshBasicMaterial",{color:255})},t)}))})}function zs(e){var t=e.className,n=hs(e,["className"]),o=Ao();return(0,r.jsx)(Si.Z,{placement:"top",overlay:"Download",children:(0,r.jsx)("div",ds({},n,{onClick:function(){return o.getState().download()},className:"".concat(t," d-flex align-items-center justify-content-center btn btn-primary btn-sm "),children:(0,r.jsx)(es,{})}))})}function Ts(e){var t=e.className,n=hs(e,["className"]),o=oi((function(e){return"fly"===e.viewType}));return(0,r.jsx)(Si.Z,{placement:"top",overlay:"Fly Camera",children:(0,r.jsx)("div",ds({},n,{onClick:function(){return o?oi.getState().backToSateliteView():oi.getState().enterFlyCamera()},className:"".concat(t," d-flex align-items-center justify-content-center btn ").concat(o?"btn-secondary":"btn-primary"," btn-sm "),children:(0,r.jsx)(cs,{})}))})}function Ls(e){var t=e.className,n=hs(e,["className"]),o=Ao(),i=o((function(e){return"gui"===e.type&&e.shift}));return(0,r.jsx)(Si.Z,{placement:"topLeft",overlay:"Hold for multiselect",children:(0,r.jsx)("div",ds({},n,{onPointerDown:function(){return o.getState().setShift(!0)},onPointerUp:function(){return o.getState().setShift(!1)},className:"".concat(t," d-flex align-items-center justify-content-center btn ").concat(i?"btn-primary":"btn-secondary"," btn-sm "),children:(0,r.jsx)(ji,{})}))})}function Ds(e){var t=e.className,n=hs(e,["className"]);return"panorama"!=oi((function(e){return e.viewType}))?null:(0,r.jsx)(Si.Z,{placement:"top",overlay:"Exit Street View",children:(0,r.jsx)("div",ds({},n,{className:"".concat(t," d-flex align-items-center justify-content-center btn btn-sm btn-primary"),onClick:function(){return oi.getState().backToSateliteView()},children:(0,r.jsx)(wi,{})}))})}function Is(){return(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",className:"bi bi-pencil",viewBox:"0 0 16 16",children:(0,r.jsx)("path",{d:"M12.146.146a.5.5 0 0 1 .708 0l3 3a.5.5 0 0 1 0 .708l-10 10a.5.5 0 0 1-.168.11l-5 2a.5.5 0 0 1-.65-.65l2-5a.5.5 0 0 1 .11-.168l10-10zM11.207 2.5 13.5 4.793 14.793 3.5 12.5 1.207 11.207 2.5zm1.586 3L10.5 3.207 4 9.707V10h.5a.5.5 0 0 1 .5.5v.5h.5a.5.5 0 0 1 .5.5v.5h.293l6.5-6.5zm-9.761 5.175-.106.106-1.528 3.821 3.821-1.528.106-.106A.5.5 0 0 1 5 12.5V12h-.5a.5.5 0 0 1-.5-.5V11h-.5a.5.5 0 0 1-.468-.325z"})})}function Bs(){return(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",className:"bi bi-diagram-3-fill",viewBox:"0 0 16 16",children:(0,r.jsx)("path",{fillRule:"evenodd",d:"M6 3.5A1.5 1.5 0 0 1 7.5 2h1A1.5 1.5 0 0 1 10 3.5v1A1.5 1.5 0 0 1 8.5 6v1H14a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-1 0V8h-5v.5a.5.5 0 0 1-1 0V8h-5v.5a.5.5 0 0 1-1 0v-1A.5.5 0 0 1 2 7h5.5V6A1.5 1.5 0 0 1 6 4.5v-1zm-6 8A1.5 1.5 0 0 1 1.5 10h1A1.5 1.5 0 0 1 4 11.5v1A1.5 1.5 0 0 1 2.5 14h-1A1.5 1.5 0 0 1 0 12.5v-1zm6 0A1.5 1.5 0 0 1 7.5 10h1a1.5 1.5 0 0 1 1.5 1.5v1A1.5 1.5 0 0 1 8.5 14h-1A1.5 1.5 0 0 1 6 12.5v-1zm6 0a1.5 1.5 0 0 1 1.5-1.5h1a1.5 1.5 0 0 1 1.5 1.5v1a1.5 1.5 0 0 1-1.5 1.5h-1a1.5 1.5 0 0 1-1.5-1.5v-1z"})})}function qs(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Gs(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Rs(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){Gs(e,t,n[t])}))}return e}function Zs(e){return function(e){if(Array.isArray(e))return qs(e)}(e)||function(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"===typeof e)return qs(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return qs(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Qs(){var e=Ao(),t=e((function(e){return e.selectedDescriptions})),n=e((function(e){return"gui"!==e.type||e.graphVisualization||1!==e.selectedDescriptions.length?void 0:z(e.grammar,e.dependencyMap,e.selectedDescriptions[0])}),W);return 1!=t.length?(0,r.jsx)("div",{className:"d-flex align-items-center justify-content-center flex-grow-1",children:(0,r.jsx)("span",{children:0===t.length?"Nothing Selected":"Multiple Descriptions Selected"})}):null==n?null:(0,r.jsx)("div",{className:"position-relative flex-grow-1",children:(0,r.jsxs)("div",{style:{whiteSpace:"pre-wrap",tabSize:2},className:"m-3",children:[dt(n,Ys(t[0]))(0),(0,r.jsxs)("div",{style:{position:"fixed",right:"1rem",bottom:"1rem"},className:"d-flex flex-row align-items-center",children:[(0,r.jsx)(Si.Z,{placement:"top",overlay:"Toggle Graph",children:(0,r.jsx)("button",{className:"d-flex align-items-center btn btn-sm btn-secondary me-2",onClick:function(){return e.getState().setGraphVisualization(!0)},children:(0,r.jsx)(Bs,{})})}),(0,r.jsx)(Si.Z,{placement:"topRight",overlay:"Edit Text",children:(0,r.jsx)("button",{className:"d-flex align-items-center btn btn-sm btn-secondary",onClick:function(){return e.getState().setType("tui")},children:(0,r.jsx)(Is,{})})})]})]})})}function $s(e){var t=e.value,n=e.description,o=e.indentation,i=Ao(),a=(0,eo.useMemo)((function(){var e=i.getState(),n=e.onEndHover,r=e.onStartHover,o=e.select;return{onMouseLeave:n.bind(null,t,void 0),onMouseEnter:r.bind(null,t,void 0),onClick:o.bind(null,t,void 0,void 0)}}),[i,t]),l=No().operationGuiMap,s=i(Us.bind(null,t)),c=Fs(t,n);return c&&(a=void 0,s=(null!==s&&void 0!==s?s:"")+" text-muted"),"string"===typeof t?(0,r.jsx)("span",Rs({},a,{className:s,children:D(t,n)})):"symbol"===t.type?(0,r.jsx)("span",Rs({},a,{className:s,children:D(t.identifier,n)})):!ca(l,t)||c?(0,r.jsx)("span",Rs({},a,{className:s,children:(0,r.jsx)(Xs,{indentation:o,description:n,value:t})})):(0,r.jsx)("span",{className:s,children:ht(t,Ys(n),o)(0,a)})}function Xs(e){var t=e.value,n=e.description,o=e.indentation;return(0,r.jsx)(r.Fragment,{children:Mt(t,o,$.bind(null,n),wt)})}function Fs(e,t){return Q(pr(e)[0])!==t}function Ys(e){return mt((function(t,n){return function(r,o){var i=Fs(n,e);return(0,eo.createElement)("span",Rs({className:i?"text-muted":void 0},i?{}:o,{key:r}),t)}}),(function(t,n){return function(o){return(0,r.jsx)($s,{indentation:t,description:e,value:n},o)}}),(function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(e,n){return(0,r.jsx)(eo.Fragment,{children:t.map((function(e,t){return e(t,n)}))},e)}}),(function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return function(t,r){return(0,eo.createElement)("span",Rs({},r,{key:t}),wt.apply(void 0,[e].concat(Zs(n))))}}))}function Us(e,t){if("gui"==t.type)return-1!=t.selectionsList.findIndex((function(t){return t.steps==e}))?"selected":null!=t.hovered&&t.hovered.steps===e?"hovered":void 0}function Ws(){var e=Ao(),t=e((function(e){return"tui"===e.type?e.text:void 0})),n=e((function(e){return"tui"!==e.type||e.correct?void 0:e.error}));return null==t&&null==n?null:(0,r.jsxs)("div",{className:"d-flex position-relative flex-grow-1",children:[(0,r.jsx)("textarea",{autoFocus:!0,style:{resize:"none",outline:0,tabSize:2},value:t,onKeyDown:function(t){return function(e,t){if("Tab"===e.code){e.preventDefault();var n=e.currentTarget.value,r=e.currentTarget.selectionStart,o=e.currentTarget.selectionEnd;return t(n.substring(0,r)+"\t"+n.substring(o)),!1}}(t,e.getState().setText)},spellCheck:!1,onChange:function(t){return e.getState().setText(t.target.value)},className:"bg-transparent p-3 border-0 flex-basis-0 flex-grow-1 text-light"}),null==n?(0,r.jsx)("button",{className:"d-flex align-items-center btn btn-sm btn-primary",style:{position:"absolute",right:"1rem",bottom:"1rem"},onClick:function(){return e.getState().setType("gui")},children:(0,r.jsx)(Is,{})}):(0,r.jsx)(Mo,{style:{position:"fixed",bottom:"1rem",right:"1rem"},align:"right",message:n})]})}function Hs(){return(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",className:"bi bi-x",viewBox:"0 0 16 16",children:(0,r.jsx)("path",{d:"M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z"})})}function _s(e){var t=e.fulfill,n=e.data,o=Ao(),i=(0,eo.useState)(""),a=i[0],l=i[1],s=(0,eo.useMemo)((function(){if(0===a.length)return!1;var e=o.getState();return"gui"!=e.type||Object.keys(e.grammar).includes(a)}),[a]),c=(0,eo.useCallback)((function(e){var r;null!=t&&t("".concat(e).concat(null!==(r=null===n||void 0===n?void 0:n.suffix)&&void 0!==r?r:""))}),[t,null===n||void 0===n?void 0:n.suffix]);return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("input",{onKeyDown:function(e){return"Enter"===e.key&&c(a)},autoFocus:!0,type:"text",className:"form-control form-control-sm mb-3",onChange:function(e){return l(e.target.value)},value:a,placeholder:"Description name"}),(0,r.jsxs)("div",{className:"d-flex flex-row align-items-center justify-content-end",children:[(0,r.jsx)("button",{className:"d-flex align-items-center ms-3 btn btn-sm btn-outline-secondary",onClick:o.getState().cancelRequest,children:(0,r.jsx)(Hs,{})}),(0,r.jsx)("button",{className:"d-flex align-items-center ms-3 btn btn-sm btn-outline-secondary",onClick:function(){return c(a)},disabled:s,children:(0,r.jsx)(Ci,{})})]})]})}function Ks(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Js(e,t,n,r,o,i,a){try{var l=e[i](a),s=l.value}catch(c){return void n(c)}l.done?t(s):Promise.resolve(s).then(r,o)}function ec(e){return function(e){if(Array.isArray(e))return Ks(e)}(e)||function(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"===typeof e)return Ks(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Ks(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function tc(e,t){return function(e){return[...Object.keys(e).map((e=>({type:"operation",identifier:e}))),...Lr]}(e).filter((function(e){var t=e.type;return"parallel"!=t&&"sequential"!=t})).map((function(e){return{label:"operation"===e.type?e.identifier:e.type,onSelect:t.bind(null,e)}}))}function nc(e){var t=e.fulfill,n=Ao(),o=No().operations,i=(0,eo.useState)(""),a=i[0],l=i[1],s=(0,eo.useMemo)((function(){return tc(o,(function(e){return t({step:function(){return function(e,t){switch(e.type){case"add":case"multiply":case"subtract":case"divide":case"modulo":case"equal":case"unequal":case"greater":case"greaterEqual":case"smaller":case"smallerEqual":return{type:e.type,children:[{type:"raw",value:2},{type:"raw",value:1}]};case"and":case"or":return{type:e.type,children:[{type:"raw",value:!0},{type:"raw",value:!1}]};case"if":return{type:e.type,children:[{type:"raw",value:!0},{type:"this"},{type:"this"}]};case"parallel":case"sequential":case"random":return{type:e.type,children:[],probabilities:[]};case"switch":return{type:e.type,cases:[],children:[{type:"raw",value:0}]};case"operation":{const n=t[e.identifier];if(null==n)throw new Error(`unknown operation "${e.identifier}"`);return{type:e.type,children:n.defaultParameters.map((e=>e())),identifier:e.identifier}}case"raw":return{type:e.type,value:1};case"getVariable":return{type:e.type,identifier:"x"};case"setVariable":return{type:e.type,identifier:"x",children:[{type:"raw",value:1}]};case"not":return{type:e.type,children:[{type:"raw",value:!0}]};case"invert":return{type:e.type,children:[{type:"raw",value:1}]};case"return":case"this":case"null":return{type:e.type}}}(e,o)}})}))}),[t,o]),c=(0,eo.useCallback)(function(){var e,n=(e=no().mark((function e(n){var r;return no().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,navigator.clipboard.readText();case 2:r=e.sent;try{t({randomize:n,step:function(e){return q.apply(void 0,[JSON.parse(r).step,Q(e[0])].concat(ec(e)))},dependencies:function(e){var t=JSON.parse(r);if(null!=t.dependencies)return k(R((0,S.vV)(t.dependencies),e))}})}catch(o){}case 4:case"end":return e.stop()}}),e)})),function(){var t=this,n=arguments;return new Promise((function(r,o){var i=e.apply(t,n);function a(e){Js(i,r,o,a,l,"next",e)}function l(e){Js(i,r,o,a,l,"throw",e)}a(void 0)}))});return function(e){return n.apply(this,arguments)}}(),[n]),u=(0,eo.useMemo)((function(){return s.filter((function(e){return e.label.toLocaleLowerCase().includes(a.toLocaleLowerCase())}))}),[a,s]);return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"d-flex flex-row mb-2",children:[(0,r.jsx)("input",{onKeyDown:function(e){return"Enter"===e.key&&1===u.length&&u[0].onSelect()},autoFocus:!0,type:"text",className:"form-control form-control-sm",onChange:function(e){return l(e.target.value)},value:a,placeholder:"Search"}),(0,r.jsx)("button",{className:"d-flex h-100 align-items-center ms-3 btn btn-sm btn-outline-secondary",onClick:n.getState().cancelRequest,children:(0,r.jsx)(Hs,{})})]}),(0,r.jsxs)("div",{className:"d-flex flex-row",children:[(0,r.jsx)(_i,{className:"mb-2 btn-btn-sm button-secondary btn-outline-secondary flex-grow-1",onPaste:c.bind(null,!1),children:"Paste Unrandomized"}),(0,r.jsx)(_i,{className:"mb-2 btn-btn-sm button-secondary btn-outline-secondary ms-2 flex-grow-1",onPaste:c.bind(null,!0),children:"Paste Randomized"})]}),(0,r.jsx)("div",{className:"d-flex flex-column",style:{overflowY:"auto"},children:u.map((function(e){var t=e.label,n=e.onSelect;return(0,r.jsx)("div",{className:"rounded pointer p-3 border-bottom",onClick:n,children:t},t)}))})]})}function rc(e){var t=e.data,n=t.patterns,o=t.title,i=e.fulfill,a=Ao();return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"d-flex flex-row align-items-center",children:[(0,r.jsx)("h5",{children:o}),(0,r.jsx)("div",{className:"flex-grow-1"}),(0,r.jsx)("button",{className:"d-flex align-items-center ms-3 btn btn-sm btn-outline-secondary",onClick:a.getState().cancelRequest,children:(0,r.jsx)(Hs,{})})]}),(0,r.jsx)("div",{className:"d-flex flex-column",style:{overflowY:"auto"},children:n.map((function(e,t){return(0,r.jsx)("button",{onClick:i.bind(null,e),className:"mt-3 btn btn-outline-primary w-100",children:e.description},t)}))})]})}function oc(e){var t=e.fulfill,n=Ao(),o=(0,eo.useState)(""),i=o[0],a=o[1],l=(0,eo.useMemo)((function(){if(0===i.length)return!1;var e=n.getState();return"gui"!=e.type||Object.keys(e.grammar).includes(i)}),[i]),s=(0,eo.useCallback)((function(e){null!=t&&t(e)}),[t]);return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("input",{onKeyDown:function(e){return"Enter"===e.key&&s(i)},autoFocus:!0,type:"text",className:"form-control form-control-sm mb-3",onChange:function(e){return a(e.target.value)},value:i,placeholder:"Noun name"}),(0,r.jsxs)("div",{className:"d-flex flex-row align-items-center justify-content-end",children:[(0,r.jsx)("button",{className:"d-flex align-items-center ms-3 btn btn-sm btn-outline-secondary",onClick:n.getState().cancelRequest,children:(0,r.jsx)(Hs,{})}),(0,r.jsx)("button",{className:"d-flex align-items-center ms-3 btn btn-sm btn-outline-secondary",onClick:function(){return s(i)},disabled:l,children:(0,r.jsx)(Ci,{})})]})]})}function ic(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function ac(e){return function(e){if(Array.isArray(e))return ic(e)}(e)||function(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"===typeof e)return ic(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return ic(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function lc(e){var t=e.data,n=(0,eo.useState)(void 0),o=n[0],i=n[1];return null==o?(0,r.jsx)(cc,{descriptions:t,onSummary:i}):(0,r.jsx)(sc,{summary:o})}function sc(e){var t=e.summary,n=Ao();return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"d-flex flex-row mb-3",children:[(0,r.jsx)("div",{className:"flex-grow-1"}),(0,r.jsx)("button",{className:"d-flex h-100 align-items-center ms-3 btn btn-sm btn-outline-secondary",onClick:n.getState().cancelRequest,children:(0,r.jsx)(Hs,{})})]}),(0,r.jsx)("span",{style:{overflowY:"auto",whiteSpace:"pre-wrap"},className:"p-3 rounded mb-3 text-light bg-dark text-editor p-1",children:Ot(t,void 0,wt)}),(0,r.jsx)(Ki,{className:"btn btn-sm btn-outline-primary",onCopy:function(){return JSON.stringify({step:{type:"symbol",identifier:t[0].name},dependencies:t})},children:"Copy"})]})}function cc(e){var t=e.descriptions,n=e.onSummary,o=Ao(),i=(0,eo.useState)(""),a=i[0],l=i[1],s=o((function(e){return e.grammar.map((function(e){return e.name}))}),W),c=(0,eo.useState)([]),u=c[0],p=c[1],f=(0,eo.useMemo)((function(){return s.filter((function(e){return t.includes(Q(e))&&e.toLocaleLowerCase().includes(a.toLocaleLowerCase())}))}),[a,s]),m=(0,eo.useCallback)((function(){return p((function(e){var t=ac(e),n=!0,r=!1,o=void 0;try{for(var i,a=f[Symbol.iterator]();!(n=(i=a.next()).done);n=!0){var l=i.value;t.includes(l)||t.push(l)}}catch(s){r=!0,o=s}finally{try{n||null==a.return||a.return()}finally{if(r)throw o}}return t}))}),[f]),d=(0,eo.useCallback)((function(){return p((function(e){return e.filter((function(e){return!f.includes(e)}))}))}),[f]);return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"d-flex flex-row mb-3",children:[(0,r.jsx)("input",{onKeyDown:function(e){return"Enter"===e.key&&u.length>=1&&null},autoFocus:!0,type:"text",className:"form-control form-control-sm",onChange:function(e){return l(e.target.value)},value:a,placeholder:"Search"}),(0,r.jsx)("button",{className:"d-flex h-100 align-items-center ms-3 btn btn-sm btn-outline-secondary",onClick:function(){return n(function(e,t){var n=e.getState();if("gui"!==n.type)return;var r=n.dependencyMap,o=t.map((function(e){return Z(F(e,n.grammar,r),void 0)}));return zn.apply(void 0,ac(o))}(o,u))},children:(0,r.jsx)(Ci,{})}),(0,r.jsx)("button",{className:"d-flex h-100 align-items-center ms-3 btn btn-sm btn-outline-secondary",onClick:o.getState().cancelRequest,children:(0,r.jsx)(Hs,{})})]}),(0,r.jsxs)("div",{className:"d-flex flex-column",style:{overflowY:"auto"},children:[(0,r.jsxs)("div",{className:"btn-group w-100 mb-2",children:[(0,r.jsx)("button",{className:"btn btn-sm btn-outline-secondary",onClick:m,children:"Select All"}),(0,r.jsx)("button",{className:"btn btn-sm btn-outline-secondary",onClick:d,children:"Unselect All"})]}),f.map((function(e){var t=u.includes(e);return(0,r.jsx)("div",{className:"m-2",children:(0,r.jsx)(Ii,{value:e,children:(0,r.jsx)("input",{onChange:function(){return p(t?u.filter((function(t){return t!=e})):u.concat(e))},type:"checkbox",checked:t})})},e)}))]})]})}function uc(){var e=ko((function(e){return"gui"===e.type?e.requested:void 0}));return null==e?null:(0,r.jsx)("div",{className:"position-absolute d-flex flex-column align-items-center overflow-hidden",style:{top:0,right:0,bottom:0,left:0,zIndex:2,background:"rgba(0,0,0,0.3)"},children:(0,r.jsx)("div",{style:{maxWidth:"40rem",margin:"0 auto"},className:"rounded overflow-hidden shadow d-flex flex-column m-3 p-3 w-100 bg-light",children:pc(e.data,e.type,e.fulfill)})})}function pc(e,t,n){switch(t){case"summarize":return(0,r.jsx)(lc,{data:e});case"create-step":return(0,r.jsx)(nc,{fulfill:n});case"create-description":return(0,r.jsx)(_s,{data:e,fulfill:n});case"set-name":return(0,r.jsx)(oc,{fulfill:n});case"select-condition":return(0,r.jsx)(rc,{data:e,fulfill:n})}}var fc=n(9647),mc=n(681);function dc(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function hc(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){dc(e,t,n[t])}))}return e}function yc(e,t,n,r,o,i,a){if("sequential"!==r.type)if("parallel"!==r.type){var l=xc(r,i,a);if(vc(r,"step",{content:qn(r,o),hasParameters:null!=l.find((function(e){return!e.isMain}))},e,n),gc(l,t,n),null!=r.children)for(var s=function(e){return"random"===e.type||"if"===e.type||"switch"===e.type}(r),c=0;c<r.children.length;c++)bc(r,c,i)&&yc(e,t,n,r.children[c],o,i,s?a:void 0)}else{var u=!0,p=!1,f=void 0;try{for(var m,d=r.children[Symbol.iterator]();!(u=(m=d.next()).done);u=!0){yc(e,t,n,m.value,o,i,a)}}catch(v){p=!0,f=v}finally{try{u||null==d.return||d.return()}finally{if(p)throw f}}}else for(var h=0;h<r.children.length;h++){var y;yc(e,t,n,r.children[h],o,i,null!==(y=r.children[h+1])&&void 0!==y?y:a)}}function vc(e,t,n,r,o){var i=Sc(e);r.push({data:hc({},n,{value:e}),type:t,id:i,position:{x:0,y:0},connectable:!1,selectable:!1,draggable:!1}),o.setNode(i,{width:130,height:70})}function gc(e,t,n){var r=!0,o=!1,i=void 0;try{for(var a,l=e[Symbol.iterator]();!(r=(a=l.next()).done);r=!0){var s=a.value,c=s.isMain,u=s.label,p=s.source,f=s.target,m=Sc(p),d=Sc(f);n.setEdge(m,d,{}),t.push({id:jc(m,d),sourceHandle:c?"main":"parameter",source:m,target:d,label:u,animated:!0,style:c?{stroke:"#88f",strokeWidth:4}:{stroke:"#999",strokeWidth:2}})}}catch(h){o=!0,i=h}finally{try{r||null==l.return||l.return()}finally{if(o)throw i}}}function bc(e,t,n){switch(e.type){case"switch":case"if":return t>0;case"operation":return ca(n,e);default:return!0}}function xc(e,t,n){if("name"in e)return wc(e.step).map((function(t){return{isMain:!0,label:void 0,source:e.name,target:t}}));var r=null==n?[]:wc(n).map((function(t){return{isMain:!0,label:void 0,source:e,target:t}}));switch(e.type){case"random":return e.children.reduce((function(t,n,r){return t.concat(wc(n).map((function(t){return{source:e,label:"".concat((100*e.probabilities[r]).toFixed(),"%"),isMain:!0,target:t}})))}),[]);case"if":return wc(e.children[1]).map((function(t){return{source:e,label:"then",isMain:!0,target:t}})).concat(wc(e.children[2]).map((function(t){return{source:e,label:"else",isMain:!0,target:t}})));case"switch":return e.children.slice(1).reduce((function(t,n,r){return t.concat(wc(n).map((function(t){return{source:e,label:"case ".concat(e.cases[r]),isMain:!0,target:t}})))}),[]);default:var o="operation"!==e.type||ca(t,e)?e.children:void 0;return null!=o?r.concat(o.reduce((function(t,n){return t.concat(wc(n).map((function(t){return{isMain:!1,label:void 0,source:e,target:t}})))}),[])):r}}function wc(e){return"parallel"===e.type?e.children.reduce((function(e,t){return e.concat(wc(t))}),[]):"sequential"===e.type?wc(e.children[0]):[e]}function jc(e,t){return"".concat(e,"-").concat(t)}function Sc(e){return"string"===typeof e?"noun-".concat(e):"step-".concat(e.path.join(","))}var Oc={step:function(e){var t=e.data,n=t.value,o=t.content,i=t.hasParameters,a=ko((function(e){return Mc(n,e)}));return(0,r.jsxs)("div",{style:{width:100,height:40,overflow:"hidden"},className:"".concat(a," align-items-center justify-content-center p-2 text-light position-relative border rounded d-flex flex-row align-items-center"),children:[(0,r.jsx)(fc.HH,{type:"target",position:fc.Ly.Left}),(0,r.jsx)("span",{children:o}),(0,r.jsx)(fc.HH,{type:"source",id:"main",position:fc.Ly.Right}),i&&(0,r.jsx)(fc.HH,{type:"source",id:"parameter",position:fc.Ly.Bottom})]})},noun:function(e){var t=e.data,n=t.content,o=t.value,i=ko((function(e){return Mc(o,e)}));return(0,r.jsxs)("div",{style:{padding:8,width:100,height:40,overflow:"hidden"},className:"".concat(i," align-items-center justify-content-center text-light position-relative border rounded scroll d-flex flex-row align-items-center"),children:[(0,r.jsx)("span",{style:{fontSize:16},children:n}),(0,r.jsx)(fc.HH,{type:"source",position:fc.Ly.Right})]})}};function Mc(e,t){if("gui"==t.type)return-1!=t.selectionsList.findIndex((function(t){return t.steps==e}))?"bg-selected":null!=t.hovered&&t.hovered.steps===e?"bg-hovered":void 0}function Pc(){var e=Ao(),t=e((function(e){return e.selectedDescriptions})),n=e((function(e){return"gui"===e.type&&e.graphVisualization&&1===e.selectedDescriptions.length?z(e.grammar,e.dependencyMap,e.selectedDescriptions[0]):void 0}),W),o=No().operationGuiMap,i=(0,eo.useMemo)((function(){if(null==n||1!=t.length)return[];var e=[],r=[];return function(e,t,n,r,o){var i=new mc.graphlib.Graph;i.setGraph({rankdir:"LR"});var a=!0,l=!1,s=void 0;try{for(var c,u=n[Symbol.iterator]();!(a=(c=u.next()).done);a=!0){var p=c.value,f=Gn(p.name,r);vc(p.name,"noun",{content:f},e,i),gc(xc(p,o,void 0),t,i),yc(e,t,i,p.step,r,o,void 0)}}catch(O){l=!0,s=O}finally{try{a||null==u.return||u.return()}finally{if(l)throw s}}(0,mc.layout)(i);var m=!0,d=!1,h=void 0;try{for(var y,v=e[Symbol.iterator]();!(m=(y=v.next()).done);m=!0){var g=y.value,b=i.node(g.id),x=b.x,w=b.y,j=b.width,S=b.height;g.targetPosition=fc.Ly.Left,g.sourcePosition=fc.Ly.Right,g.position.x=x-j/2,g.position.y=w-S/2}}catch(O){d=!0,h=O}finally{try{m||null==v.return||v.return()}finally{if(d)throw h}}}(e,r,n,t[0],o),[e,r]}),[n,t,o]),a=i[0],l=i[1];return 1!=t.length?(0,r.jsx)("div",{className:"d-flex align-items-center justify-content-center flex-grow-1",children:(0,r.jsx)("span",{children:0===t.length?"Nothing Selected":"Multiple Descriptions Selected"})}):null==n?null:(0,r.jsxs)("div",{className:"position-relative flex-grow-1",children:[(0,r.jsx)(fc.ZP,{nodeTypes:Oc,style:{zIndex:0},nodes:a,edges:l,onNodeClick:function(t,n){return e.getState().select(n.data.value,void 0,e.getState().shift?"add":"replace")},onNodeMouseEnter:function(t,n){return e.getState().onStartHover(n.data.value,void 0)},onNodeMouseLeave:function(t,n){return e.getState().onEndHover(n.data.value)},connectionLineType:fc.t8.SmoothStep}),(0,r.jsxs)("div",{style:{position:"fixed",right:"1rem",bottom:"1rem"},className:"d-flex flex-row align-items-center",children:[(0,r.jsx)(Si.Z,{placement:"top",overlay:"Toggle Graph",children:(0,r.jsx)("button",{className:"d-flex align-items-center btn btn-sm btn-primary me-2",onClick:function(){return e.getState().setGraphVisualization(!1)},children:(0,r.jsx)(Bs,{})})}),(0,r.jsx)(Si.Z,{placement:"topRight",overlay:"Edit Text",children:(0,r.jsx)("button",{className:"d-flex align-items-center btn btn-sm btn-secondary",onClick:function(){return e.getState().setType("tui")},children:(0,r.jsx)(Is,{})})})]})]})}function Ec(){var e=Ao();(0,eo.useEffect)((function(){var t=function(t){switch(t.key){case"Shift":case"Control":e.getState().setShift(!1)}},n=function(t){switch(t.key){case"Escape":e.getState().escape();break;case"Delete":t.target==document.body&&e.getState().removeStep();break;case"Shift":case"Control":e.getState().setShift(!0)}};return window.addEventListener("keydown",n),window.addEventListener("keyup",t),function(){window.removeEventListener("keydown",n),window.removeEventListener("keyup",t)}}),[e]);var t=No().Viewer;return(0,r.jsxs)("div",{className:"d-flex responsive-flex-direction overflow-hidden position-absolute noselect",style:{top:0,right:0,left:0,bottom:0},children:[(0,r.jsx)(uc,{}),(0,r.jsx)(t,{style:{whiteSpace:"pre-line",top:0,left:0,right:0,bottom:0},className:"flex-basis-0 flex-grow-1 bg-white"}),(0,r.jsx)(Nc,{})]})}function Nc(){var e=ko((function(e){return e.showTui?"tui"===e.type?Ws:e.graphVisualization?Pc:Qs:void 0}));return null==e?null:(0,r.jsx)("div",{className:"max-responsive-size-35 scroll text-editor text-light flex-basis-0 flex-grow-1 bg-dark d-flex",children:(0,r.jsx)(e,{})})}function Ac(){return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(Jr.default,{children:[(0,r.jsx)("title",{children:"CGV | Shape Editor"}),(0,r.jsx)("meta",{name:"description",content:""}),(0,r.jsx)("meta",{name:"viewport",content:"initial-scale=1.0, width=device-width"})]}),(0,r.jsx)(Co,{store:mo(Wr,Kr),Viewer:bs,operationGuiMap:Ta,operations:Wr,children:(0,r.jsx)(Ec,{})})]})}}},function(e){e.O(0,[429,770,273,774,888,179],(function(){return t=5301,e(e.s=t);var t}));var t=e.O();_N_E=t}]);