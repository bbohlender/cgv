"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[476],{8223:function(t,e,r){r.d(e,{Jn:function(){return n.Jn},Js:function(){return n.Js},Yh:function(){return n.Yh},vk:function(){return n.vk},i7:function(){return n.i7},A1:function(){return v},HR:function(){return U},Jy:function(){return _}});var n=r(2910),i=r(6173),o=(r(1135),r(9621));const a=new i.Vector3,s=new i.Vector3;new i.Matrix4;var c;!function(t){t[t.X=0]="X",t[t.Y=1]="Y",t[t.Z=2]="Z"}(c||(c={}));const u={[c.X]:"x",[c.Y]:"y",[c.Z]:"z"};function l(t,e){return t[u[e]]}function m(t,e,r){t[u[e]]=r}const h=new i.Vector3;function p(t,e,r){t.getGeometrySize(h);let n=0;const i=[];for(s.set(0,0,0);l(h,e)>0;){const c=t.matrix.clone();c.multiply((0,o.Nh)(s.x,s.y,s.z));const u=r(c,n,h.x,h.y,h.z);u.getGeometrySize(a),i.push(u),n++;const p=l(a,e);m(h,e,l(h,e)-p),m(s,e,l(s,e)+p)}return i}new i.Vector3;var f;!function(t){t[t.Float=0]="Float",t[t.Enum=1]="Enum",t[t.Int=2]="Int"}(f||(f={}));var x=r(7340),g=r(4917),w=r(8882),d=r.n(w),y=function(t,e,r,n){return new(r||(r=Promise))((function(i,o){function a(t){try{c(n.next(t))}catch(e){o(e)}}function s(t){try{c(n.throw(t))}catch(e){o(e)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(a,s)}c((n=n.apply(t,e||[])).next())}))};function v(){return y(this,void 0,void 0,(function*(){const t=yield function(){return y(this,void 0,void 0,(function*(){const t=yield fetch("/cgv/22545.mvt"),e=yield t.arrayBuffer(),r=new g.VectorTile(new(d())(e));return Object.entries(r.layers).reduce(((t,[e,r])=>Object.assign(Object.assign({},t),{[e]:new Array(r.length).fill(null).map(((t,e)=>{const n=r.feature(e);return{properties:n.properties,geometry:n.loadGeometry()}}))})),{})}))}();return[function(t){return t.road.filter((t=>"street"===t.properties.class)).reduce(((t,e)=>t.concat(e.geometry.map((t=>[new n.Jn(new i.Matrix4,t.slice(0,-1).map(((e,r)=>{const o=t[(r+1)%t.length];return n.Yh.fromPoints(new i.Matrix4,new i.Vector2(e.x,e.y),new i.Vector2(o.x,o.y),G)}))),b])))),[])}(t),function(t){return t.building.reduce(((t,e)=>t.concat(e.geometry.map((t=>[new n.Js(new i.Matrix4,new i.Shape(t.map((({x:t,y:e})=>new i.Vector2(t,e)))),G),M])))),[])}(t)]}))}const b={layer:(0,x.of)("road")},M={layer:(0,x.of)("building")},G=(0,n.i7)(new i.Color(16711680));var P=r(8816),j=r(598),S=r(892),V=r(5770),O=r(2253);const T=(0,n.i7)(new i.Color(16711680));function z(){return(0,P.D)(v()).pipe((0,j.U)((([t,e])=>{const r=[...t,...e].map((([t,e],r)=>({terminated:!1,eventDepthMap:{},parameters:e,value:{path:[r],attributes:{},primitive:t}})));return(0,V.a_)(r,r.length)})),(0,S.d)({bufferSize:1,refCount:!0}))}function A([t,e,r]){return(0,x.of)({attributes:{},primitive:new n.vk((0,o.Nh)(t,e,r,new i.Matrix4),T)})}const N=new i.Vector3;function k(t){const e=t.map((t=>(N.setFromMatrixPosition(t.primitive.matrix),new i.Vector2(N.x,N.z))));return console.log(e),(0,x.of)({attributes:{},primitive:new n.Js(new i.Matrix4,new i.Shape(e),T)})}function X(t){const[e,r]=t.map((t=>(N.setFromMatrixPosition(t.primitive.matrix),new i.Vector2(N.x,N.z))));return(0,x.of)({attributes:{},primitive:n.Yh.fromPoints(new i.Matrix4,e,r,T)})}const C=new i.Vector3;function J([t,e]){return t.primitive.getGeometrySize(C),(0,x.of)(C[e])}function L([t,e,r,n]){return(0,x.of)({attributes:Object.assign({},t.attributes),primitive:t.primitive.multiplyMatrix((0,o.gN)(e,r,n))})}function E(t){return Math.PI*t/180}function B([t,e,r,n]){return(0,x.of)({attributes:Object.assign({},t.attributes),primitive:t.primitive.multiplyMatrix((0,o.ae)(E(e),E(r),E(n)))})}function F([t,e,r,n]){return(0,x.of)({attributes:Object.assign({},t.attributes),primitive:t.primitive.multiplyMatrix((0,o.Nh)(e,r,n))})}function H([t,e]){return(0,x.of)({attributes:Object.assign({},t.attributes),primitive:t.primitive.changeMaterialGenerator((0,n.i7)(e))})}function I([t,e]){return(0,x.of)({attributes:Object.assign({},t.attributes),primitive:t.primitive.extrude(e)})}function D(t,e){const r=e.reduce(((e,r)=>[...e,...r.primitive.components(t).map((t=>({attributes:Object.assign({},r.attributes),primitive:t})))]),[]);return(0,x.of)((0,V.a_)(r,r.length))}function Z(t,[e,r,i]){const o=p(e.primitive,t,((o,a,s,u,l)=>{if(null==i||a<i){const i=t===c.X?Math.min(r,s):s,a=t===c.Z?Math.min(r,l):l;return n.Js.fromLengthAndHeight(o,i,a,!1,e.primitive.materialGenerator)}return n.Js.fromLengthAndHeight(o,s,l,!1,e.primitive.materialGenerator)})).map((t=>({attributes:Object.assign({},e.attributes),primitive:t})));return(0,x.of)((0,V.a_)(o,o.length))}function Y(t,[e,...r]){const i=p(e.primitive,t,((i,o,a,s,u)=>{const l=t===c.X&&null!=r[o]?Math.min(r[o],a):a,m=t===c.Z&&null!=r[o]?Math.min(r[o],u):u;return n.Js.fromLengthAndHeight(i,l,m,!1,e.primitive.materialGenerator)})).map((t=>({attributes:Object.assign({},e.attributes),primitive:t})));return(0,x.of)((0,V.a_)(i,i.length))}const _=Object.assign(Object.assign({},O.J),{translate:t=>e=>e.pipe((0,V.PM)(F,(t=>t),[V.fT,...t])),scale:t=>e=>e.pipe((0,V.PM)(L,(t=>t),[V.fT,...t])),rotate:t=>e=>e.pipe((0,V.PM)(B,(t=>t),[V.fT,...t])),extrude:t=>e=>e.pipe((0,V.PM)(I,(t=>t),[V.fT,...t])),splitX:t=>e=>e.pipe((0,V.PM)(Z.bind(null,c.X),(t=>t),[V.fT,...t])),splitZ:t=>e=>e.pipe((0,V.PM)(Z.bind(null,c.Z),(t=>t),[V.fT,...t])),multiSplitX:t=>e=>e.pipe((0,V.PM)(Y.bind(null,c.X),(t=>t),[V.fT,...t])),multiSplitZ:t=>e=>e.pipe((0,V.PM)(Y.bind(null,c.Z),(t=>t),[V.fT,...t])),toPoints:t=>e=>e.pipe((0,V.PM)(D.bind(null,"points"),(t=>t),[V.fT,...t])),toLines:t=>e=>e.pipe((0,V.PM)(D.bind(null,"lines"),(t=>t),[V.fT,...t])),toFaces:t=>e=>e.pipe((0,V.PM)(D.bind(null,"faces"),(t=>t),[V.fT,...t])),color:t=>e=>e.pipe((0,V.PM)(H,(t=>t),[V.fT,...t])),size:t=>e=>e.pipe((0,V.PM)(J,(t=>t),[V.fT,...t])),mapbox:t=>e=>e.pipe((0,V.dF)(z,(t=>t),t)),point:t=>e=>e.pipe((0,V.PM)(A,(t=>t),t)),line:t=>e=>e.pipe((0,V.PM)(X,(t=>t),t)),face:t=>e=>e.pipe((0,V.PM)(k,(t=>t),t))});var R=r(2598);function U(){return t=>t.pipe((0,V.PA)(),(0,V.Tr)(),(0,R.R)(((t,e)=>{if(Array.isArray(e))for(const r of e)q(t,r);else q(t,e);return t}),new i.Object3D))}function q(t,e){var r;let n;if(e.type===V.u4.UNSET)n=t.children.splice(e.index,e.deleteAmount);else{const i=e.value.value.primitive.getObject();null===(r=i.parent)||void 0===r||r.remove(i),i.parent=t,n=t.children.splice(e.index,e.deleteAmount,i)}for(const i of n)i.parent=null}},9621:function(t,e,r){r.d(e,{pT:function(){return s},Nh:function(){return c},ae:function(){return u},gN:function(){return l}});var n=r(6173);new n.Box3,new n.Vector3,new n.Vector3;const i=new n.Matrix4,o=new n.Vector3,a=new n.Euler;function s(t,e,r=i){return o.crossVectors(t,e),r.makeBasis(t,e,o)}function c(t,e,r,n=i){return n.makeTranslation(t,e,r)}function u(t,e,r,n=i){return n.makeRotationFromEuler(a.set(t,e,r))}function l(t,e,r,n=i){return n.makeScale(t,e,r)}},2910:function(t,e,r){r.d(e,{i7:function(){return a},vk:function(){return h},Yh:function(){return f},Js:function(){return d},Jn:function(){return v}});var n=r(6173),i=r(766),o=r(9621);function a(t){return e=>{switch(e){case l.Point:return new n.PointsMaterial({color:t});case l.Line:return new n.LineBasicMaterial({color:t});case l.Mesh:return new n.MeshPhongMaterial({color:t})}}}const s=new n.Matrix4,c=new n.Vector3;function u(t,e){return t.matrixAutoUpdate=!1,t.matrix=e,t}var l;!function(t){t[t.Point=0]="Point",t[t.Line=1]="Line",t[t.Mesh=2]="Mesh"}(l||(l={}));class m{constructor(){this.geometryCache=null,this.objectCache=null}getGeometry(){return null===this.geometryCache&&(this.geometryCache=this.computeGeometry()),this.geometryCache}getObject(){return null===this.objectCache&&(this.objectCache=this.computeObject3D()),this.objectCache}dispose(){var t;null===(t=this.geometryCache)||void 0===t||t.dispose()}multiplyMatrix(t){return this.changeMatrix(this.matrix.clone().multiply(t))}premultiplyMatrix(t){return this.changeMatrix(this.matrix.clone().premultiply(t))}}class h extends m{constructor(t,e){super(),this.matrix=t,this.materialGenerator=e}changeMaterialGenerator(t){return new h(this.matrix,t)}changeMatrix(t){return new h(t,this.materialGenerator)}multiplyMatrix(t){return new h(this.matrix.clone().multiply(t),this.materialGenerator)}getGeometrySize(t){t.set(0,0,0)}extrude(t){return new f(this.matrix,t,this.materialGenerator)}components(t){return"points"===t?[this.clone()]:[]}computeObject3D(){return u(new n.Points((new n.BufferGeometry).setFromPoints([new n.Vector3]),this.materialGenerator(l.Point)),this.matrix)}clone(){return new h(this.matrix,this.materialGenerator)}computeGeometry(){}}const p=new n.Vector3(0,1,0);class f extends m{constructor(t,e,r){super(),this.matrix=t,this.length=e,this.materialGenerator=r}changeMaterialGenerator(t){return new f(this.matrix,this.length,t)}changeMatrix(t){return new f(t,this.length,this.materialGenerator)}static fromPoints(t,e,r,n){t.multiply((0,o.Nh)(e.x,0,e.y)),g.copy(r).sub(e);const i=g.length();return t.multiply((0,o.pT)(c.set(g.x,0,g.y).normalize(),p)),new f(t,i,n)}getGeometrySize(t){t.set(0,this.length,0)}clone(){return new f(this.matrix,this.length,this.materialGenerator)}extrude(t){return d.fromLengthAndHeight(this.matrix,this.length,t,!0,this.materialGenerator)}components(t){switch(t){case"faces":return[];case"lines":return[this.clone()];case"points":{const t=new h(this.matrix.clone().multiply(s.makeTranslation(this.length,0,0)),this.materialGenerator);return[new h(this.matrix,this.materialGenerator),t]}}}computeObject3D(){return u(new n.Line((new n.BufferGeometry).setFromPoints([new n.Vector3,new n.Vector3(this.length,0,0)]),this.materialGenerator(l.Line)),this.matrix)}computeGeometry(){}}const x=new n.Box2,g=new n.Vector2,w=new n.Matrix4;class d extends m{constructor(t,e,r){super(),this.matrix=t,this.shape=e,this.materialGenerator=r}changeMaterialGenerator(t){return new d(this.matrix,this.shape,t)}changeMatrix(t){return new d(t,this.shape,this.materialGenerator)}static fromLengthAndHeight(t,e,r,i,o){i&&t.multiply(s.makeRotationX(-Math.PI/2));const a=[new n.Vector2(e,0),new n.Vector2(e,r),new n.Vector2(0,r),new n.Vector2(0,0)],c=new n.Shape(a);return new d(t,c,o)}getGeometrySize(t){x.setFromPoints(this.shape.getPoints()).getSize(g),t.set(g.x,0,g.y)}computeGeometry(){const t=new n.ShapeBufferGeometry(this.shape);let e;for(let r=0;r<t.index.count;r+=3)e=t.index.getX(r),t.index.setX(r,t.index.getX(r+2)),t.index.setX(r+2,e);return t.rotateX(Math.PI/2),t}invert(){const t=this.matrix.clone();t.multiply((0,o.ae)(Math.PI,0,0));const e=this.shape.getPoints(5),r=this.shape.holes,i=new n.Shape(e.map((({x:t,y:e})=>new n.Vector2(t,-e))));return i.holes=r.map((t=>new n.Path(t.getPoints().map((({x:t,y:e})=>new n.Vector2(t,-e)))))),new d(t,i,this.materialGenerator)}extrude(t){w.copy(this.matrix).invert();const e=this.multiplyMatrix(w.multiply((0,o.Nh)(0,t,0))),r=this.shape.extractPoints(5).shape;return new v(this.matrix,[...r.map(((e,i)=>{const a=r[(i+1)%r.length];c.set(a.x-e.x,0,a.y-e.y);const s=c.length(),u=(0,o.Nh)(e.x,0,e.y,new n.Matrix4);u.multiply((0,o.pT)(c.normalize(),p));const l=d.fromLengthAndHeight(u,s,t,!0,this.materialGenerator);return t<0?l.invert():l})),e])}components(t){switch(t){case"points":return this.shape.extractPoints(5).shape.map((t=>new h(this.matrix.clone().multiply((0,o.Nh)(t.x,0,t.y)),this.materialGenerator)));case"lines":{const t=this.shape.extractPoints(5).shape;return t.map(((e,r)=>f.fromPoints(this.matrix.clone(),e,t[(r+1)%t.length],this.materialGenerator)))}case"faces":return[this]}}computeObject3D(){return u(new n.Mesh(this.getGeometry(),this.materialGenerator(l.Mesh)),this.matrix)}}const y=new n.Box3;class v extends m{constructor(t,e){super(),this.matrix=t,this.primitives=e}changeMaterialGenerator(t){return new v(this.matrix,this.primitives.map((e=>e.changeMaterialGenerator(t))))}changeMatrix(t){return new v(t,this.primitives)}extrude(t){return new v(this.matrix,this.primitives.map((e=>e.extrude(t))))}components(t){return this.primitives.map((e=>e.components(t))).reduce(((t,e)=>t.concat(e))).map((t=>t.premultiplyMatrix(this.matrix)))}computeObject3D(){const t=u(new n.Object3D,this.matrix);return this.primitives.forEach((e=>t.add(e.getObject()))),t}getGeometrySize(t){y.makeEmpty(),this.primitives.forEach((t=>{t.getGeometrySize(c),c.applyMatrix4(t.matrix),y.expandByPoint(c)})),y.getSize(t)}computeGeometry(){const t=this.primitives.map((t=>{var e;return null===(e=t.getGeometry())||void 0===e?void 0:e.applyMatrix4(t.matrix)})).filter(b),e=(0,i.qf)(t);return t.forEach((t=>t.dispose())),e}}function b(t){return null!=t}},7939:function(t,e,r){r.d(e,{T:function(){return l}});var n=r(5893),i=r(406),o=r(6447),a=r(8223),s=r(7294);function c(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function u(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var r=null==t?null:"undefined"!==typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var n,i,o=[],a=!0,s=!1;try{for(r=r.call(t);!(a=(n=r.next()).done)&&(o.push(n.value),!e||o.length!==e);a=!0);}catch(c){s=!0,i=c}finally{try{a||null==r.return||r.return()}finally{if(s)throw i}}return o}}(t,e)||function(t,e){if(!t)return;if("string"===typeof t)return c(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(r);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return c(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function l(t){var e=t.matrix,r=(0,s.useState)([void 0,void 0]),c=u(r[0],2),l=c[0],m=c[1],h=r[1];return(0,s.useEffect)((function(){if(null!=e){var t=e.pipe((0,a.HR)()).subscribe({next:function(t){return h([t,void 0])},error:function(t){console.error(t),h([void 0,t.message])}});return function(){return t.unsubscribe()}}}),[e]),(0,n.jsxs)("div",{style:{whiteSpace:"pre-line"},className:"flex-basis-0 d-flex flex-column flex-grow-1 bg-white h3 mb-0",children:[(0,n.jsx)("div",{className:"flex-basis-0 flex-grow-1 overflow-hidden position-relative",children:(0,n.jsxs)(o.Xz,{children:[(0,n.jsx)(i.o,{}),(0,n.jsx)("gridHelper",{}),(0,n.jsx)("pointLight",{position:[3,3,3]}),(0,n.jsx)("ambientLight",{}),(0,n.jsx)("group",{scale:.01,children:null!=l&&(0,n.jsx)("primitive",{object:l})})]})}),(0,n.jsx)("div",{className:"overflow-auto mb-0 border-top flex-basis-0 h5 bg-light flex-grow-1",style:{whiteSpace:"pre-line",maxHeight:300,height:300},children:null==m?null==e?(0,n.jsx)("div",{className:"text-primary p-3",children:"waiting ..."}):(0,n.jsx)("div",{className:"text-success p-3",children:"ok"}):(0,n.jsx)("div",{className:"text-danger p-3",children:m})})]})}},8377:function(t,e,r){r.d(e,{c:function(){return o}});var n=r(5770),i=r(7294);function o(t,e,r){return(0,i.useMemo)((function(){try{var i=(0,n.Qc)(t);return[e.pipe((0,n.Ii)(i,r)),void 0]}catch(o){return[void 0,JSON.stringify(o.message)]}}),[t,e])}}}]);